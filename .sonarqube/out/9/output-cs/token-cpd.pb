ƒ
s/Users/a1/Documents/GitHub/turn-based-prototype/Server/Framework/Deterministic.GameFramework.Client/Utils/Locker.cs
	namespace 	
Deterministic
 
. 
GameFramework %
.% &
Client& ,
., -
Utils- 2
;2 3
public		 
class		 
Locker		 
{

 
private 
int 

_lockCount 
; 
public 

bool 
IsLocked 
=> 

_lockCount &
>' (
$num) *
;* +
public 

IDisposable 
Lock 
( 
) 
{ 

_lockCount 
++ 
; 
return 
new 
LockerDisposable #
(# $
this$ (
)( )
;) *
} 
private 
void 
Unlock 
( 
) 
{ 
if 

( 

_lockCount 
> 
$num 
) 

_lockCount 
-- 
; 
} 
private 
class 
LockerDisposable "
:# $
IDisposable% 0
{ 
private 
readonly 
Locker 
_locker  '
;' (
private 
bool 
	_disposed 
; 
public   
LockerDisposable   
(    
Locker    &
locker  ' -
)  - .
{!! 	
_locker"" 
="" 
locker"" 
;"" 
}## 	
public%% 
void%% 
Dispose%% 
(%% 
)%% 
{&& 	
if'' 
('' 
	_disposed'' 
)'' 
return'' !
;''! "
	_disposed(( 
=(( 
true(( 
;(( 
_locker)) 
.)) 
Unlock)) 
()) 
))) 
;)) 
}** 	
}++ 
},, ®‹
v/Users/a1/Documents/GitHub/turn-based-prototype/Server/Framework/Deterministic.GameFramework.Client/SignalR/SignalR.cs
	namespace 	
Deterministic
 
. 
GameFramework %
.% &
Client& ,
{ 
public 

class 
ConnectionEventArgs $
:% &
	EventArgs' 0
{		 
public

 
string

 
ConnectionId

 "
{

# $
get

% (
;

( )
set

* -
;

- .
}

/ 0
} 
public 

class 
SignalR 
{ 
private 
static 
SignalR 
instance #
;# $
public 

SignalR 
( 
) 
{ 
instance 
= 
this 
; 
} 
private 
static 
void 
OnConnectionStarted +
(+ ,
string, 2
connectionId3 ?
)? @
{ 
var 
args 
= 
new 
ConnectionEventArgs *
{ 	
ConnectionId 
= 
connectionId '
} 	
;	 

instance 
. 
ConnectionStarted "
?" #
.# $
Invoke$ *
(* +
instance+ 3
,3 4
args5 9
)9 :
;: ;
} 
public 

event 
EventHandler 
< 
ConnectionEventArgs 1
>1 2
ConnectionStarted3 D
;D E
private   
static   
void   
OnConnectionClosed   *
(  * +
string  + 1
connectionId  2 >
)  > ?
{!! 
var"" 
args"" 
="" 
new"" 
ConnectionEventArgs"" *
{## 	
ConnectionId$$ 
=$$ 
connectionId$$ '
}%% 	
;%%	 

instance'' 
.'' 
ConnectionClosed'' !
?''! "
.''" #
Invoke''# )
('') *
instance''* 2
,''2 3
args''4 8
)''8 9
;''9 :
}(( 
public)) 

event)) 
EventHandler)) 
<)) 
ConnectionEventArgs)) 1
>))1 2
ConnectionClosed))3 C
;))C D
private++ 
HubConnection++ 

connection++ $
;++$ %
private,, 
static,, 
string,, 
lastConnectionId,, *
;,,* +
public.. 

void.. 
Init.. 
(.. 
string.. 
url.. 
)..  
{// 
try00 
{11 	

connection22 
=22 
new22  
HubConnectionBuilder22 1
(221 2
)222 3
.33 
WithUrl33 
(33 
url33 
)33 
.44 "
WithAutomaticReconnect44 #
(44# $
)44$ %
.55 
WithServerTimeout55 
(55 
TimeSpan55 '
.55' (
FromMinutes55( 3
(553 4
$num554 5
)555 6
)556 7
.66 !
WithKeepAliveInterval66 "
(66" #
TimeSpan66# +
.66+ ,
FromSeconds66, 7
(667 8
$num668 :
)66: ;
)66; <
.77 
Build77 
(77 
)77 
;77 
}88 	
catch99 
(99 
	Exception99 
ex99 
)99 
{:: 	
NetworkLogger;; 
.;; 
LogError;; "
(;;" #
$";;# %
$str;;% ;
{;;; <
ex;;< >
.;;> ?
Message;;? F
};;F G
";;G H
);;H I
;;;I J
}<< 	
}== 
public?? 

async?? 
void?? 
Connect?? 
(?? 
)?? 
{@@ 
tryAA 
{BB 	
awaitCC 

connectionCC 
.CC 

StartAsyncCC '
(CC' (
)CC( )
;CC) *
lastConnectionIdEE 
=EE 

connectionEE )
.EE) *
ConnectionIdEE* 6
;EE6 7

connectionGG 
.GG 
ClosedGG 
-=GG  #
OnConnectionClosedEventGG! 8
;GG8 9

connectionHH 
.HH 
ReconnectingHH #
-=HH$ &)
OnConnectionReconnectingEventHH' D
;HHD E

connectionII 
.II 
ReconnectedII "
-=II# %(
OnConnectionReconnectedEventII& B
;IIB C

connectionKK 
.KK 
ClosedKK 
+=KK  #
OnConnectionClosedEventKK! 8
;KK8 9

connectionLL 
.LL 
ReconnectingLL #
+=LL$ &)
OnConnectionReconnectingEventLL' D
;LLD E

connectionMM 
.MM 
ReconnectedMM "
+=MM# %(
OnConnectionReconnectedEventMM& B
;MMB C
OnConnectionStartedOO 
(OO  
lastConnectionIdOO  0
)OO0 1
;OO1 2
}PP 	
catchQQ 
(QQ 
	ExceptionQQ 
exQQ 
)QQ 
{RR 	
NetworkLoggerSS 
.SS 
LogErrorSS "
(SS" #
$"SS# %
$strSS% >
{SS> ?
exSS? A
}SSA B
"SSB C
)SSC D
;SSD E
}TT 	
}UU 
publicWW 

asyncWW 
voidWW 
StopWW 
(WW 
)WW 
{XX 
tryYY 
{ZZ 	
await[[ 

connection[[ 
.[[ 
	StopAsync[[ &
([[& '
)[[' (
;[[( )
}\\ 	
catch]] 
(]] 
	Exception]] 
e]] 
)]] 
{^^ 	
NetworkLogger__ 
.__ 
LogError__ "
(__" #
$"__# %
$str__% ;
{__; <
e__< =
}__= >
"__> ?
)__? @
;__@ A
}`` 	
}aa 
privatecc 
staticcc 
Taskcc #
OnConnectionClosedEventcc /
(cc/ 0
	Exceptioncc0 9
	exceptioncc: C
)ccC D
{dd 
ifee 

(ee 
	exceptionee 
!=ee 
nullee 
)ee 
{ff 	
NetworkLoggergg 
.gg 
LogErrorgg "
(gg" #
$"gg# %
$strgg% B
{ggB C
	exceptionggC L
.ggL M
MessageggM T
}ggT U
"ggU V
)ggV W
;ggW X
}hh 	
OnConnectionClosedjj 
(jj 
lastConnectionIdjj +
)jj+ ,
;jj, -
returnll 
Taskll 
.ll 
CompletedTaskll !
;ll! "
}mm 
privateoo 
staticoo 
Taskoo )
OnConnectionReconnectingEventoo 5
(oo5 6
	Exceptionoo6 ?
	exceptionoo@ I
)ooI J
{pp 
NetworkLoggerqq 
.qq 
Logqq 
(qq 
$"qq 
$strqq A
{qqA B
	exceptionqqB K
.qqK L
MessageqqL S
}qqS T
"qqT U
)qqU V
;qqV W
returnss 
Taskss 
.ss 
CompletedTaskss !
;ss! "
}tt 
privatevv 
staticvv 
Taskvv (
OnConnectionReconnectedEventvv 4
(vv4 5
stringvv5 ;
connectionIdvv< H
)vvH I
{ww 
NetworkLoggerxx 
.xx 
Logxx 
(xx 
$"xx 
$strxx A
{xxA B
connectionIdxxB N
}xxN O
"xxO P
)xxP Q
;xxQ R
lastConnectionIdzz 
=zz 
connectionIdzz '
;zz' (
OnConnectionStarted|| 
(|| 
lastConnectionId|| ,
)||, -
;||- .
return~~ 
Task~~ 
.~~ 
CompletedTask~~ !
;~~! "
} 
public
ÇÇ 

async
ÇÇ 
void
ÇÇ 
Invoke
ÇÇ 
(
ÇÇ 
string
ÇÇ #

methodName
ÇÇ$ .
)
ÇÇ. /
=>
ÇÇ0 2
await
ÉÉ 

connection
ÉÉ 
.
ÉÉ 
InvokeAsync
ÉÉ $
(
ÉÉ$ %

methodName
ÉÉ% /
)
ÉÉ/ 0
;
ÉÉ0 1
public
ÑÑ 

async
ÑÑ 
void
ÑÑ 
Invoke
ÑÑ 
(
ÑÑ 
string
ÑÑ #

methodName
ÑÑ$ .
,
ÑÑ. /
object
ÑÑ0 6
arg1
ÑÑ7 ;
)
ÑÑ; <
=>
ÑÑ= ?
await
ÖÖ 

connection
ÖÖ 
.
ÖÖ 
InvokeAsync
ÖÖ $
(
ÖÖ$ %

methodName
ÖÖ% /
,
ÖÖ/ 0
arg1
ÖÖ1 5
)
ÖÖ5 6
;
ÖÖ6 7
public
ÜÜ 

async
ÜÜ 
void
ÜÜ 
Invoke
ÜÜ 
(
ÜÜ 
string
ÜÜ #

methodName
ÜÜ$ .
,
ÜÜ. /
object
ÜÜ0 6
arg1
ÜÜ7 ;
,
ÜÜ; <
object
ÜÜ= C
arg2
ÜÜD H
)
ÜÜH I
=>
ÜÜJ L
await
áá 

connection
áá 
.
áá 
InvokeAsync
áá $
(
áá$ %

methodName
áá% /
,
áá/ 0
arg1
áá1 5
,
áá5 6
arg2
áá7 ;
)
áá; <
;
áá< =
public
àà 

async
àà 
void
àà 
Invoke
àà 
(
àà 
string
àà #

methodName
àà$ .
,
àà. /
object
àà0 6
arg1
àà7 ;
,
àà; <
object
àà= C
arg2
ààD H
,
ààH I
object
ààJ P
arg3
ààQ U
)
ààU V
=>
ààW Y
await
ââ 

connection
ââ 
.
ââ 
InvokeAsync
ââ $
(
ââ$ %

methodName
ââ% /
,
ââ/ 0
arg1
ââ1 5
,
ââ5 6
arg2
ââ7 ;
,
ââ; <
arg3
ââ= A
)
ââA B
;
ââB C
public
ää 

async
ää 
void
ää 
Invoke
ää 
(
ää 
string
ää #

methodName
ää$ .
,
ää. /
object
ää0 6
arg1
ää7 ;
,
ää; <
object
ää= C
arg2
ääD H
,
ääH I
object
ääJ P
arg3
ääQ U
,
ääU V
object
ääW ]
arg4
ää^ b
)
ääb c
=>
ääd f
await
ãã 

connection
ãã 
.
ãã 
InvokeAsync
ãã $
(
ãã$ %

methodName
ãã% /
,
ãã/ 0
arg1
ãã1 5
,
ãã5 6
arg2
ãã7 ;
,
ãã; <
arg3
ãã= A
,
ããA B
arg4
ããC G
)
ããG H
;
ããH I
public
åå 

async
åå 
void
åå 
Invoke
åå 
(
åå 
string
åå #

methodName
åå$ .
,
åå. /
object
åå0 6
arg1
åå7 ;
,
åå; <
object
åå= C
arg2
ååD H
,
ååH I
object
ååJ P
arg3
ååQ U
,
ååU V
object
ååW ]
arg4
åå^ b
,
ååb c
object
ååd j
arg5
ååk o
)
ååo p
=>
ååq s
await
çç 

connection
çç 
.
çç 
InvokeAsync
çç $
(
çç$ %

methodName
çç% /
,
çç/ 0
arg1
çç1 5
,
çç5 6
arg2
çç7 ;
,
çç; <
arg3
çç= A
,
ççA B
arg4
ççC G
,
ççG H
arg5
ççI M
)
ççM N
;
ççN O
public
éé 

async
éé 
void
éé 
Invoke
éé 
(
éé 
string
éé #

methodName
éé$ .
,
éé. /
object
éé0 6
arg1
éé7 ;
,
éé; <
object
éé= C
arg2
ééD H
,
ééH I
object
ééJ P
arg3
ééQ U
,
ééU V
object
ééW ]
arg4
éé^ b
,
ééb c
object
ééd j
arg5
éék o
,
ééo p
object
ééq w
arg6
ééx |
)
éé| }
=>éé~ Ä
await
èè 

connection
èè 
.
èè 
InvokeAsync
èè $
(
èè$ %

methodName
èè% /
,
èè/ 0
arg1
èè1 5
,
èè5 6
arg2
èè7 ;
,
èè; <
arg3
èè= A
,
èèA B
arg4
èèC G
,
èèG H
arg5
èèI M
,
èèM N
arg6
èèO S
)
èèS T
;
èèT U
public
êê 

async
êê 
void
êê 
Invoke
êê 
(
êê 
string
êê #

methodName
êê$ .
,
êê. /
object
êê0 6
arg1
êê7 ;
,
êê; <
object
êê= C
arg2
êêD H
,
êêH I
object
êêJ P
arg3
êêQ U
,
êêU V
object
êêW ]
arg4
êê^ b
,
êêb c
object
êêd j
arg5
êêk o
,
êêo p
object
êêq w
arg6
êêx |
,
êê| }
objectêê~ Ñ
arg7êêÖ â
)êêâ ä
=>êêã ç
await
ëë 

connection
ëë 
.
ëë 
InvokeAsync
ëë $
(
ëë$ %

methodName
ëë% /
,
ëë/ 0
arg1
ëë1 5
,
ëë5 6
arg2
ëë7 ;
,
ëë; <
arg3
ëë= A
,
ëëA B
arg4
ëëC G
,
ëëG H
arg5
ëëI M
,
ëëM N
arg6
ëëO S
,
ëëS T
arg7
ëëU Y
)
ëëY Z
;
ëëZ [
public
íí 

async
íí 
void
íí 
Invoke
íí 
(
íí 
string
íí #

methodName
íí$ .
,
íí. /
object
íí0 6
arg1
íí7 ;
,
íí; <
object
íí= C
arg2
ííD H
,
ííH I
object
ííJ P
arg3
ííQ U
,
ííU V
object
ííW ]
arg4
íí^ b
,
ííb c
object
ííd j
arg5
íík o
,
íío p
object
ííq w
arg6
ííx |
,
íí| }
objectíí~ Ñ
arg7ííÖ â
,ííâ ä
objectííã ë
arg8ííí ñ
)ííñ ó
=>ííò ö
await
ìì 

connection
ìì 
.
ìì 
InvokeAsync
ìì $
(
ìì$ %

methodName
ìì% /
,
ìì/ 0
arg1
ìì1 5
,
ìì5 6
arg2
ìì7 ;
,
ìì; <
arg3
ìì= A
,
ììA B
arg4
ììC G
,
ììG H
arg5
ììI M
,
ììM N
arg6
ììO S
,
ììS T
arg7
ììU Y
,
ììY Z
arg8
ìì[ _
)
ìì_ `
;
ìì` a
public
îî 

async
îî 
void
îî 
Invoke
îî 
(
îî 
string
îî #

methodName
îî$ .
,
îî. /
object
îî0 6
arg1
îî7 ;
,
îî; <
object
îî= C
arg2
îîD H
,
îîH I
object
îîJ P
arg3
îîQ U
,
îîU V
object
îîW ]
arg4
îî^ b
,
îîb c
object
îîd j
arg5
îîk o
,
îîo p
object
îîq w
arg6
îîx |
,
îî| }
objectîî~ Ñ
arg7îîÖ â
,îîâ ä
objectîîã ë
arg8îîí ñ
,îîñ ó
objectîîò û
arg9îîü £
)îî£ §
=>îî• ß
await
ïï 

connection
ïï 
.
ïï 
InvokeAsync
ïï $
(
ïï$ %

methodName
ïï% /
,
ïï/ 0
arg1
ïï1 5
,
ïï5 6
arg2
ïï7 ;
,
ïï; <
arg3
ïï= A
,
ïïA B
arg4
ïïC G
,
ïïG H
arg5
ïïI M
,
ïïM N
arg6
ïïO S
,
ïïS T
arg7
ïïU Y
,
ïïY Z
arg8
ïï[ _
,
ïï_ `
arg9
ïïa e
)
ïïe f
;
ïïf g
public
ññ 

async
ññ 
void
ññ 
Invoke
ññ 
(
ññ 
string
ññ #

methodName
ññ$ .
,
ññ. /
object
ññ0 6
arg1
ññ7 ;
,
ññ; <
object
ññ= C
arg2
ññD H
,
ññH I
object
ññJ P
arg3
ññQ U
,
ññU V
object
ññW ]
arg4
ññ^ b
,
ññb c
object
ññd j
arg5
ññk o
,
ñño p
object
ññq w
arg6
ññx |
,
ññ| }
objectññ~ Ñ
arg7ññÖ â
,ññâ ä
objectññã ë
arg8ññí ñ
,ñññ ó
objectññò û
arg9ññü £
,ññ£ §
objectññ• ´
arg10ññ¨ ±
)ññ± ≤
=>ññ≥ µ
await
óó 

connection
óó 
.
óó 
InvokeAsync
óó $
(
óó$ %

methodName
óó% /
,
óó/ 0
arg1
óó1 5
,
óó5 6
arg2
óó7 ;
,
óó; <
arg3
óó= A
,
óóA B
arg4
óóC G
,
óóG H
arg5
óóI M
,
óóM N
arg6
óóO S
,
óóS T
arg7
óóU Y
,
óóY Z
arg8
óó[ _
,
óó_ `
arg9
óóa e
,
óóe f
arg10
óóg l
)
óól m
;
óóm n
public
õõ 

IDisposable
õõ 
On
õõ 
(
õõ 
string
õõ  

methodName
õõ! +
,
õõ+ ,
Action
õõ- 3
handler
õõ4 ;
)
õõ; <
=>
õõ= ?

connection
úú 
.
úú 
On
úú 
(
úú 

methodName
úú  
,
úú  !
handler
úú" )
.
úú) *
Invoke
úú* 0
)
úú0 1
;
úú1 2
public
ùù 

IDisposable
ùù 
On
ùù 
<
ùù 
T1
ùù 
>
ùù 
(
ùù 
string
ùù $

methodName
ùù% /
,
ùù/ 0
Action
ùù1 7
<
ùù7 8
T1
ùù8 :
>
ùù: ;
handler
ùù< C
)
ùùC D
=>
ùùE G

connection
ûû 
.
ûû 
On
ûû 
(
ûû 

methodName
ûû  
,
ûû  !
(
ûû" #
T1
ûû# %
arg1
ûû& *
)
ûû* +
=>
ûû, .
handler
ûû/ 6
.
ûû6 7
Invoke
ûû7 =
(
ûû= >
arg1
ûû> B
)
ûûB C
)
ûûC D
;
ûûD E
public
üü 

IDisposable
üü 
On
üü 
<
üü 
T1
üü 
,
üü 
T2
üü  
>
üü  !
(
üü! "
string
üü" (

methodName
üü) 3
,
üü3 4
Action
üü5 ;
<
üü; <
T1
üü< >
,
üü> ?
T2
üü@ B
>
üüB C
handler
üüD K
)
üüK L
=>
üüM O

connection
†† 
.
†† 
On
†† 
(
†† 

methodName
††  
,
††  !
(
††" #
T1
††# %
arg1
††& *
,
††* +
T2
††, .
arg2
††/ 3
)
††3 4
=>
††5 7
handler
††8 ?
.
††? @
Invoke
††@ F
(
††F G
arg1
††G K
,
††K L
arg2
††M Q
)
††Q R
)
††R S
;
††S T
public
°° 

IDisposable
°° 
On
°° 
<
°° 
T1
°° 
,
°° 
T2
°°  
,
°°  !
T3
°°" $
>
°°$ %
(
°°% &
string
°°& ,

methodName
°°- 7
,
°°7 8
Action
°°9 ?
<
°°? @
T1
°°@ B
,
°°B C
T2
°°D F
,
°°F G
T3
°°H J
>
°°J K
handler
°°L S
)
°°S T
=>
°°U W

connection
¢¢ 
.
¢¢ 
On
¢¢ 
(
¢¢ 

methodName
¢¢  
,
¢¢  !
(
¢¢" #
T1
¢¢# %
arg1
¢¢& *
,
¢¢* +
T2
¢¢, .
arg2
¢¢/ 3
,
¢¢3 4
T3
¢¢5 7
arg3
¢¢8 <
)
¢¢< =
=>
¢¢> @
handler
¢¢A H
.
¢¢H I
Invoke
¢¢I O
(
¢¢O P
arg1
¢¢P T
,
¢¢T U
arg2
¢¢V Z
,
¢¢Z [
arg3
¢¢\ `
)
¢¢` a
)
¢¢a b
;
¢¢b c
public
££ 

IDisposable
££ 
On
££ 
<
££ 
T1
££ 
,
££ 
T2
££  
,
££  !
T3
££" $
,
££$ %
T4
££& (
>
££( )
(
££) *
string
££* 0

methodName
££1 ;
,
££; <
Action
££= C
<
££C D
T1
££D F
,
££F G
T2
££H J
,
££J K
T3
££L N
,
££N O
T4
££P R
>
££R S
handler
££T [
)
££[ \
=>
££] _

connection
§§ 
.
§§ 
On
§§ 
(
§§ 

methodName
§§  
,
§§  !
(
§§" #
T1
§§# %
arg1
§§& *
,
§§* +
T2
§§, .
arg2
§§/ 3
,
§§3 4
T3
§§5 7
arg3
§§8 <
,
§§< =
T4
§§> @
arg4
§§A E
)
§§E F
=>
§§G I
handler
§§J Q
.
§§Q R
Invoke
§§R X
(
§§X Y
arg1
§§Y ]
,
§§] ^
arg2
§§_ c
,
§§c d
arg3
§§e i
,
§§i j
arg4
§§k o
)
§§o p
)
§§p q
;
§§q r
public
•• 

IDisposable
•• 
On
•• 
<
•• 
T1
•• 
,
•• 
T2
••  
,
••  !
T3
••" $
,
••$ %
T4
••& (
,
••( )
T5
••* ,
>
••, -
(
••- .
string
••. 4

methodName
••5 ?
,
••? @
Action
••A G
<
••G H
T1
••H J
,
••J K
T2
••L N
,
••N O
T3
••P R
,
••R S
T4
••T V
,
••V W
T5
••X Z
>
••Z [
handler
••\ c
)
••c d
=>
••e g

connection
¶¶ 
.
¶¶ 
On
¶¶ 
(
¶¶ 

methodName
¶¶  
,
¶¶  !
(
¶¶" #
T1
¶¶# %
arg1
¶¶& *
,
¶¶* +
T2
¶¶, .
arg2
¶¶/ 3
,
¶¶3 4
T3
¶¶5 7
arg3
¶¶8 <
,
¶¶< =
T4
¶¶> @
arg4
¶¶A E
,
¶¶E F
T5
¶¶G I
arg5
¶¶J N
)
¶¶N O
=>
¶¶P R
handler
¶¶S Z
.
¶¶Z [
Invoke
¶¶[ a
(
¶¶a b
arg1
¶¶b f
,
¶¶f g
arg2
¶¶h l
,
¶¶l m
arg3
¶¶n r
,
¶¶r s
arg4
¶¶t x
,
¶¶x y
arg5
¶¶z ~
)
¶¶~ 
)¶¶ Ä
;¶¶Ä Å
public
ßß 

IDisposable
ßß 
On
ßß 
<
ßß 
T1
ßß 
,
ßß 
T2
ßß  
,
ßß  !
T3
ßß" $
,
ßß$ %
T4
ßß& (
,
ßß( )
T5
ßß* ,
,
ßß, -
T6
ßß. 0
>
ßß0 1
(
ßß1 2
string
ßß2 8

methodName
ßß9 C
,
ßßC D
Action
ßßE K
<
ßßK L
T1
ßßL N
,
ßßN O
T2
ßßP R
,
ßßR S
T3
ßßT V
,
ßßV W
T4
ßßX Z
,
ßßZ [
T5
ßß\ ^
,
ßß^ _
T6
ßß` b
>
ßßb c
handler
ßßd k
)
ßßk l
=>
ßßm o

connection
®® 
.
®® 
On
®® 
(
®® 

methodName
®®  
,
®®  !
(
®®" #
T1
®®# %
arg1
®®& *
,
®®* +
T2
®®, .
arg2
®®/ 3
,
®®3 4
T3
®®5 7
arg3
®®8 <
,
®®< =
T4
®®> @
arg4
®®A E
,
®®E F
T5
®®G I
arg5
®®J N
,
®®N O
T6
®®P R
arg6
®®S W
)
®®W X
=>
®®Y [
handler
®®\ c
.
®®c d
Invoke
®®d j
(
®®j k
arg1
®®k o
,
®®o p
arg2
®®q u
,
®®u v
arg3
®®w {
,
®®{ |
arg4®®} Å
,®®Å Ç
arg5®®É á
,®®á à
arg6®®â ç
)®®ç é
)®®é è
;®®è ê
public
©© 

IDisposable
©© 
On
©© 
<
©© 
T1
©© 
,
©© 
T2
©©  
,
©©  !
T3
©©" $
,
©©$ %
T4
©©& (
,
©©( )
T5
©©* ,
,
©©, -
T6
©©. 0
,
©©0 1
T7
©©2 4
>
©©4 5
(
©©5 6
string
©©6 <

methodName
©©= G
,
©©G H
Action
©©I O
<
©©O P
T1
©©P R
,
©©R S
T2
©©T V
,
©©V W
T3
©©X Z
,
©©Z [
T4
©©\ ^
,
©©^ _
T5
©©` b
,
©©b c
T6
©©d f
,
©©f g
T7
©©h j
>
©©j k
handler
©©l s
)
©©s t
=>
©©u w

connection
™™ 
.
™™ 
On
™™ 
(
™™ 

methodName
™™  
,
™™  !
(
™™" #
T1
™™# %
arg1
™™& *
,
™™* +
T2
™™, .
arg2
™™/ 3
,
™™3 4
T3
™™5 7
arg3
™™8 <
,
™™< =
T4
™™> @
arg4
™™A E
,
™™E F
T5
™™G I
arg5
™™J N
,
™™N O
T6
™™P R
arg6
™™S W
,
™™W X
T7
™™Y [
arg7
™™\ `
)
™™` a
=>
™™b d
handler
™™e l
.
™™l m
Invoke
™™m s
(
™™s t
arg1
™™t x
,
™™x y
arg2
™™z ~
,
™™~ 
arg3™™Ä Ñ
,™™Ñ Ö
arg4™™Ü ä
,™™ä ã
arg5™™å ê
,™™ê ë
arg6™™í ñ
,™™ñ ó
arg7™™ò ú
)™™ú ù
)™™ù û
;™™û ü
public
´´ 

IDisposable
´´ 
On
´´ 
<
´´ 
T1
´´ 
,
´´ 
T2
´´  
,
´´  !
T3
´´" $
,
´´$ %
T4
´´& (
,
´´( )
T5
´´* ,
,
´´, -
T6
´´. 0
,
´´0 1
T7
´´2 4
,
´´4 5
T8
´´6 8
>
´´8 9
(
´´9 :
string
´´: @

methodName
´´A K
,
´´K L
Action
´´M S
<
´´S T
T1
´´T V
,
´´V W
T2
´´X Z
,
´´Z [
T3
´´\ ^
,
´´^ _
T4
´´` b
,
´´b c
T5
´´d f
,
´´f g
T6
´´h j
,
´´j k
T7
´´l n
,
´´n o
T8
´´p r
>
´´r s
handler
´´t {
)
´´{ |
=>
´´} 

connection
¨¨ 
.
¨¨ 
On
¨¨ 
(
¨¨ 

methodName
¨¨  
,
¨¨  !
(
¨¨" #
T1
¨¨# %
arg1
¨¨& *
,
¨¨* +
T2
¨¨, .
arg2
¨¨/ 3
,
¨¨3 4
T3
¨¨5 7
arg3
¨¨8 <
,
¨¨< =
T4
¨¨> @
arg4
¨¨A E
,
¨¨E F
T5
¨¨G I
arg5
¨¨J N
,
¨¨N O
T6
¨¨P R
arg6
¨¨S W
,
¨¨W X
T7
¨¨Y [
arg7
¨¨\ `
,
¨¨` a
T8
¨¨b d
arg8
¨¨e i
)
¨¨i j
=>
¨¨k m
handler
¨¨n u
.
¨¨u v
Invoke
¨¨v |
(
¨¨| }
arg1¨¨} Å
,¨¨Å Ç
arg2¨¨É á
,¨¨á à
arg3¨¨â ç
,¨¨ç é
arg4¨¨è ì
,¨¨ì î
arg5¨¨ï ô
,¨¨ô ö
arg6¨¨õ ü
,¨¨ü †
arg7¨¨° •
,¨¨• ¶
arg8¨¨ß ´
)¨¨´ ¨
)¨¨¨ ≠
;¨¨≠ Æ
}
ÆÆ 
}ØØ °(
r/Users/a1/Documents/GitHub/turn-based-prototype/Server/Framework/Deterministic.GameFramework.Client/NetworkTime.cs
	namespace 	
Deterministic
 
. 
GameFramework %
.% &
Client& ,
{ 
public 

class 
NetworkTime 
: 
IDisposable *
{ 
private 
readonly 
NetworkClient &
_networkClient' 5
;5 6
private 
readonly 
IDisposable $!
_timeSyncSubscription% :
;: ;
private 
readonly 
IDisposable $%
_periodicSyncSubscription% >
;> ?
private 
long 
_lastRequestTicks &
;& '
public 
long 
TimeOffsetTicks #
{$ %
get& )
;) *
private+ 2
set3 6
;6 7
}8 9
public 
bool 
IsSynced 
{ 
get "
;" #
private$ +
set, /
;/ 0
}1 2
public   
Subject   
<   
long   
>   
OnTimeSynced   )
{  * +
get  , /
;  / 0
}  1 2
=  3 4
new  5 8
(  8 9
)  9 :
;  : ;
public%% 
DateTime%% 
UtcNow%% 
=>%% !
new%%" %
DateTime%%& .
(%%. /
DateTime%%/ 7
.%%7 8
UtcNow%%8 >
.%%> ?
Ticks%%? D
+%%E F
TimeOffsetTicks%%G V
,%%V W
DateTimeKind%%X d
.%%d e
Utc%%e h
)%%h i
;%%i j
public,, 
NetworkTime,, 
(,, 
NetworkClient,, (
networkClient,,) 6
,,,6 7
TimeSpan,,8 @
?,,@ A
syncInterval,,B N
=,,O P
null,,Q U
),,U V
{-- 	
_networkClient.. 
=.. 
networkClient.. *
;..* +!
_timeSyncSubscription11 !
=11" #
_networkClient11$ 2
.112 3

OnTimeSync113 =
.11= >
	Subscribe11> G
(11G H
OnServerTime11H T
)11T U
;11U V
var44 
interval44 
=44 
syncInterval44 '
??44( *
TimeSpan44+ 3
.443 4
FromSeconds444 ?
(44? @
$num44@ B
)44B C
;44C D%
_periodicSyncSubscription55 %
=55& '

Observable55( 2
.66 
Interval66 
(66 
interval66 "
)66" #
.77 
	Subscribe77 
(77 
_77 
=>77 
SyncNow77  '
(77' (
)77( )
)77) *
;77* +
SyncNow:: 
(:: 
):: 
;:: 
};; 	
public@@ 
void@@ 
SyncNow@@ 
(@@ 
)@@ 
{AA 	
_lastRequestTicksBB 
=BB 
DateTimeBB  (
.BB( )
UtcNowBB) /
.BB/ 0
TicksBB0 5
;BB5 6
_networkClientCC 
.CC 
RequestTimeSyncCC *
(CC* +
_lastRequestTicksCC+ <
)CC< =
;CC= >
}DD 	
privateFF 
voidFF 
OnServerTimeFF !
(FF! "
longFF" &
serverTicksFF' 2
)FF2 3
{GG 	
varHH 
t1HH 
=HH 
DateTimeHH 
.HH 
UtcNowHH $
.HH$ %
TicksHH% *
;HH* +
varII 
offsetII 
=II 
serverTicksII $
-II% &
(II' (
(II( )
_lastRequestTicksII) :
+II; <
t1II= ?
)II? @
/IIA B
$numIIC D
)IID E
;IIE F
TimeOffsetTicksJJ 
=JJ 
offsetJJ $
;JJ$ %
IsSyncedKK 
=KK 
trueKK 
;KK 
OnTimeSyncedLL 
.LL 
OnNextLL 
(LL  
offsetLL  &
)LL& '
;LL' (
NetworkLoggerMM 
.MM 
LogMM 
(MM 
$"MM  
$strMM  7
{MM7 8
offsetMM8 >
/MM? @
(MMA B
doubleMMB H
)MMH I
TimeSpanMMI Q
.MMQ R
TicksPerMillisecondMMR e
:MMe f
$strMMf h
}MMh i
$strMMi l
"MMl m
)MMm n
;MMn o
}NN 	
publicPP 
voidPP 
DisposePP 
(PP 
)PP 
{QQ 	!
_timeSyncSubscriptionRR !
.RR! "
DisposeRR" )
(RR) *
)RR* +
;RR+ ,%
_periodicSyncSubscriptionSS %
.SS% &
DisposeSS& -
(SS- .
)SS. /
;SS/ 0
OnTimeSyncedTT 
.TT 
OnCompletedTT $
(TT$ %
)TT% &
;TT& '
}UU 	
}VV 
}WW Ï

t/Users/a1/Documents/GitHub/turn-based-prototype/Server/Framework/Deterministic.GameFramework.Client/NetworkLogger.cs
	namespace 	
Deterministic
 
. 
GameFramework %
.% &
Client& ,
{ 
public 

static 
class 
NetworkLogger %
{ 
private		 
static		 
INetworkLogger		 %
	_instance		& /
;		/ 0
public 
static 
void 
	SetLogger $
($ %
INetworkLogger% 3
logger4 :
): ;
{ 	
	_instance 
= 
logger 
; 
} 	
public 
static 
void 
Log 
( 
string %
message& -
)- .
{ 	
	_instance 
? 
. 
Log 
( 
message "
)" #
;# $
} 	
public   
static   
void   
LogError   #
(  # $
string  $ *
message  + 2
)  2 3
{!! 	
	_instance"" 
?"" 
."" 
LogError"" 
(""  
message""  '
)""' (
;""( )
}## 	
}$$ 
}%% æn
t/Users/a1/Documents/GitHub/turn-based-prototype/Server/Framework/Deterministic.GameFramework.Client/NetworkClient.cs
	namespace 	
Deterministic
 
. 
GameFramework %
.% &
Client& ,
{ 
public 

class 
NetworkClient 
{ 
public 
SignalR 
SignalR 
{  
get! $
;$ %
private& -
set. 1
;1 2
}3 4
public 
Subject 
< 
Unit 
> 
OnConnected (
{) *
get+ .
;. /
}0 1
=2 3
new4 7
(7 8
)8 9
;9 :
public 
Subject 
< 
Unit 
> 
OnDisconnected +
{, -
get. 1
;1 2
}3 4
=5 6
new7 :
(: ;
); <
;< =
public 
Subject 
< 
long 
> 

OnTimeSync '
{( )
get* -
;- .
}/ 0
=1 2
new3 6
(6 7
)7 8
;8 9
public 

Dictionary 
< 
NetworkThread '
,' (
Queue) .
<. /
INetworkAction/ =
>= >
>> ?
ActionsByThread@ O
{P Q
getR U
;U V
}W X
public 
long 
TotalBytesReceived &
{' (
get) ,
;, -
private. 5
set6 9
;9 :
}; <
public 
NetworkClient 
( 
string #
hubUrl$ *
)* +
{   	
ActionsByThread"" 
="" 
new"" !

Dictionary""" ,
<"", -
NetworkThread""- :
,"": ;
Queue""< A
<""A B
INetworkAction""B P
>""P Q
>""Q R
(""R S
)""S T
;""T U
foreach## 
(## 
NetworkThread## "
thread### )
in##* ,
NetworkThread##- :
.##: ;
GetAll##; A
(##A B
)##B C
)##C D
{$$ 
ActionsByThread%% 
[%%  
thread%%  &
]%%& '
=%%( )
new%%* -
Queue%%. 3
<%%3 4
INetworkAction%%4 B
>%%B C
(%%C D
)%%D E
;%%E F
}&& 
SignalR(( 
=(( 
new(( 
SignalR(( !
(((! "
)((" #
;((# $
SignalR)) 
.)) 
Init)) 
()) 
hubUrl)) 
)))  
;))  !
SignalR,, 
.,, 
On,, 
<,, 
string,, 
>,, 
(,, 
$str,, ,
,,,, -
(,,. /
actionsJson,,/ :
),,: ;
=>,,< >
{-- 
try.. 
{// 
var00 
bytes00 
=00 
System00  &
.00& '
Text00' +
.00+ ,
Encoding00, 4
.004 5
UTF8005 9
.009 :
GetByteCount00: F
(00F G
actionsJson00G R
)00R S
;00S T
TotalBytesReceived11 &
+=11' )
bytes11* /
;11/ 0
NetworkLogger33 !
.33! "
Log33" %
(33% &
$"33& (
$str33( ;
{33; <
bytes33< A
/33B C
$num33D J
:33J K
$str33K M
}33M N
$str33N [
{33[ \
TotalBytesReceived33\ n
/33o p
$num33q w
:33w x
$str33x z
}33z {
$str	33{ Ä
"
33Ä Å
)
33Å Ç
;
33Ç É
var66 
actions66 
=66  !
JsonSerializer66" 0
.660 1
FromJson661 9
<669 :
List66: >
<66> ?
INetworkAction66? M
>66M N
>66N O
(66O P
actionsJson66P [
)66[ \
;66\ ]
if77 
(77 
actions77 
!=77  "
null77# '
)77' (
{88 
foreach99 
(99  !
var99! $
action99% +
in99, .
actions99/ 6
)996 7
{:: 
if<< 
(<<  
ActionsByThread<<  /
.<</ 0
TryGetValue<<0 ;
(<<; <
action<<< B
.<<B C
Thread<<C I
,<<I J
out<<K N
var<<O R
queue<<S X
)<<X Y
)<<Y Z
{== 
queue>>  %
.>>% &
Enqueue>>& -
(>>- .
action>>. 4
)>>4 5
;>>5 6
}?? 
else@@  
{AA 
ActionsByThreadCC  /
[CC/ 0
NetworkThreadCC0 =
.CC= >
MainCC> B
]CCB C
.CCC D
EnqueueCCD K
(CCK L
actionCCL R
)CCR S
;CCS T
}DD 
}EE 
}FF 
}GG 
catchHH 
(HH 
	ExceptionHH  
eHH! "
)HH" #
{II 
NetworkLoggerJJ !
.JJ! "
LogErrorJJ" *
(JJ* +
$"JJ+ -
$strJJ- T
{JJT U
eJJU V
.JJV W
MessageJJW ^
}JJ^ _
"JJ_ `
)JJ` a
;JJa b
}KK 
}LL 
)LL 
;LL 
SignalROO 
.OO 
OnOO 
<OO 
stringOO 
>OO 
(OO 
$strOO .
,OO. /
(OO0 1

actionJsonOO1 ;
)OO; <
=>OO= ?
{PP 
tryQQ 
{RR 
NetworkLoggerSS !
.SS! "
LogSS" %
(SS% &
$"SS& (
$strSS( H
"SSH I
)SSI J
;SSJ K
varVV 
actionVV 
=VV  
JsonSerializerVV! /
.VV/ 0
FromJsonVV0 8
<VV8 9
INetworkActionVV9 G
>VVG H
(VVH I

actionJsonVVI S
)VVS T
;VVT U
ifWW 
(WW 
actionWW 
!=WW !
nullWW" &
)WW& '
{XX 
ifZZ 
(ZZ 
ActionsByThreadZZ +
.ZZ+ ,
TryGetValueZZ, 7
(ZZ7 8
actionZZ8 >
.ZZ> ?
ThreadZZ? E
,ZZE F
outZZG J
varZZK N
queueZZO T
)ZZT U
)ZZU V
{[[ 
queue\\ !
.\\! "
Enqueue\\" )
(\\) *
action\\* 0
)\\0 1
;\\1 2
}]] 
else^^ 
{__ 
ActionsByThreadaa +
[aa+ ,
NetworkThreadaa, 9
.aa9 :
Mainaa: >
]aa> ?
.aa? @
Enqueueaa@ G
(aaG H
actionaaH N
)aaN O
;aaO P
}bb 
}cc 
}dd 
catchee 
(ee 
	Exceptionee  
eee! "
)ee" #
{ff 
NetworkLoggergg !
.gg! "
LogErrorgg" *
(gg* +
$"gg+ -
$strgg- S
{ggS T
eggT U
.ggU V
MessageggV ]
}gg] ^
"gg^ _
)gg_ `
;gg` a
}hh 
}ii 
)ii 
;ii 
SignalRll 
.ll 
Onll 
<ll 
longll 
>ll 
(ll 
$strll #
,ll# $
(ll% &
timell& *
)ll* +
=>ll, .
{mm 
varnn 
latencynn 
=nn 
DateTimeOffsetnn ,
.nn, -
UtcNownn- 3
.nn3 4"
ToUnixTimeMillisecondsnn4 J
(nnJ K
)nnK L
-nnM N
timennO S
;nnS T
NetworkLoggeroo 
.oo 
Logoo !
(oo! "
$"oo" $
$stroo$ =
{oo= >
latencyoo> E
}ooE F
$strooF H
"ooH I
)ooI J
;ooJ K
}pp 
)pp 
;pp 
SignalRss 
.ss 
Onss 
<ss 
longss 
>ss 
(ss 
$strss '
,ss' (
serverTicksss) 4
=>ss5 7
{tt 

OnTimeSyncuu 
.uu 
OnNextuu !
(uu! "
serverTicksuu" -
)uu- .
;uu. /
}vv 
)vv 
;vv 
SignalRyy 
.yy 
ConnectionStartedyy %
+=yy& (
(yy) *
_yy* +
,yy+ ,
_yy- .
)yy. /
=>yy0 2
{zz 
NetworkLogger{{ 
.{{ 
Log{{ !
({{! "
$str{{" B
){{B C
;{{C D
OnConnected|| 
.|| 
OnNext|| "
(||" #
Unit||# '
.||' (
Default||( /
)||/ 0
;||0 1
}}} 
;}} 
SignalR 
. 
ConnectionClosed $
+=% '
(( )
_) *
,* +
_, -
)- .
=>/ 1
{
ÄÄ 
NetworkLogger
ÅÅ 
.
ÅÅ 
Log
ÅÅ !
(
ÅÅ! "
$str
ÅÅ" G
)
ÅÅG H
;
ÅÅH I
OnDisconnected
ÇÇ 
.
ÇÇ 
OnNext
ÇÇ %
(
ÇÇ% &
Unit
ÇÇ& *
.
ÇÇ* +
Default
ÇÇ+ 2
)
ÇÇ2 3
;
ÇÇ3 4
}
ÉÉ 
;
ÉÉ 
SignalR
ÖÖ 
.
ÖÖ 
Connect
ÖÖ 
(
ÖÖ 
)
ÖÖ 
;
ÖÖ 
}
ÜÜ 	
public
ãã 
void
ãã 
Close
ãã 
(
ãã 
)
ãã 
=>
ãã 
SignalR
ãã &
.
ãã& '
Stop
ãã' +
(
ãã+ ,
)
ãã, -
;
ãã- .
public
êê 
void
êê 
Ping
êê 
(
êê 
long
êê 

clientTime
êê (
)
êê( )
=>
êê* ,
SignalR
êê- 4
.
êê4 5
Invoke
êê5 ;
(
êê; <
$str
êê< B
,
êêB C

clientTime
êêD N
)
êêN O
;
êêO P
public
ññ 
void
ññ 
RequestTimeSync
ññ #
(
ññ# $
long
ññ$ (
clientTicks
ññ) 4
)
ññ4 5
=>
óó 
SignalR
óó 
.
óó 
Invoke
óó 
(
óó 
$str
óó (
,
óó( )
clientTicks
óó* 5
)
óó5 6
;
óó6 7
public
úú 
void
úú 
Invoke
úú 
(
úú 
string
úú !

methodName
úú" ,
,
úú, -
params
úú. 4
object
úú5 ;
[
úú; <
]
úú< =
args
úú> B
)
úúB C
{
ùù 	
switch
ûû 
(
ûû 
args
ûû 
.
ûû 
Length
ûû 
)
ûû  
{
üü 
case
†† 
$num
†† 
:
†† 
SignalR
†† 
.
††  
Invoke
††  &
(
††& '

methodName
††' 1
)
††1 2
;
††2 3
break
††4 9
;
††9 :
case
°° 
$num
°° 
:
°° 
SignalR
°° 
.
°°  
Invoke
°°  &
(
°°& '

methodName
°°' 1
,
°°1 2
args
°°3 7
[
°°7 8
$num
°°8 9
]
°°9 :
)
°°: ;
;
°°; <
break
°°= B
;
°°B C
case
¢¢ 
$num
¢¢ 
:
¢¢ 
SignalR
¢¢ 
.
¢¢  
Invoke
¢¢  &
(
¢¢& '

methodName
¢¢' 1
,
¢¢1 2
args
¢¢3 7
[
¢¢7 8
$num
¢¢8 9
]
¢¢9 :
,
¢¢: ;
args
¢¢< @
[
¢¢@ A
$num
¢¢A B
]
¢¢B C
)
¢¢C D
;
¢¢D E
break
¢¢F K
;
¢¢K L
case
££ 
$num
££ 
:
££ 
SignalR
££ 
.
££  
Invoke
££  &
(
££& '

methodName
££' 1
,
££1 2
args
££3 7
[
££7 8
$num
££8 9
]
££9 :
,
££: ;
args
££< @
[
££@ A
$num
££A B
]
££B C
,
££C D
args
££E I
[
££I J
$num
££J K
]
££K L
)
££L M
;
££M N
break
££O T
;
££T U
case
§§ 
$num
§§ 
:
§§ 
SignalR
§§ 
.
§§  
Invoke
§§  &
(
§§& '

methodName
§§' 1
,
§§1 2
args
§§3 7
[
§§7 8
$num
§§8 9
]
§§9 :
,
§§: ;
args
§§< @
[
§§@ A
$num
§§A B
]
§§B C
,
§§C D
args
§§E I
[
§§I J
$num
§§J K
]
§§K L
,
§§L M
args
§§N R
[
§§R S
$num
§§S T
]
§§T U
)
§§U V
;
§§V W
break
§§X ]
;
§§] ^
case
•• 
$num
•• 
:
•• 
SignalR
•• 
.
••  
Invoke
••  &
(
••& '

methodName
••' 1
,
••1 2
args
••3 7
[
••7 8
$num
••8 9
]
••9 :
,
••: ;
args
••< @
[
••@ A
$num
••A B
]
••B C
,
••C D
args
••E I
[
••I J
$num
••J K
]
••K L
,
••L M
args
••N R
[
••R S
$num
••S T
]
••T U
,
••U V
args
••W [
[
••[ \
$num
••\ ]
]
••] ^
)
••^ _
;
••_ `
break
••a f
;
••f g
default
¶¶ 
:
¶¶ 
throw
¶¶ 
new
¶¶ "
ArgumentException
¶¶# 4
(
¶¶4 5
$str
¶¶5 _
)
¶¶_ `
;
¶¶` a
}
ßß 
}
®® 	
}
©© 
}™™ æ
u/Users/a1/Documents/GitHub/turn-based-prototype/Server/Framework/Deterministic.GameFramework.Client/JsonSerializer.cs
	namespace 	
Deterministic
 
. 
GameFramework %
.% &
Client& ,
{ 
public 

static 
class 
JsonSerializer &
{ 
internal		 
sealed		 
class		 /
#DotNetCompatibleSerializationBinder		 A
:		B C&
DefaultSerializationBinder		D ^
{

 	
private 
const 
string  
CoreLibAssembly! 0
=1 2
$str3 K
;K L
private 
const 
string  
MscorlibAssembly! 1
=2 3
$str4 >
;> ?
public 
override 
Type  

BindToType! +
(+ ,
string, 2
assemblyName3 ?
,? @
stringA G
typeNameH P
)P Q
{ 
if 
( 
assemblyName  
==! #
CoreLibAssembly$ 3
)3 4
{ 
assemblyName  
=! "
MscorlibAssembly# 3
;3 4
typeName 
= 
typeName '
.' (
Replace( /
(/ 0
CoreLibAssembly0 ?
,? @
MscorlibAssemblyA Q
)Q R
;R S
} 
return 
base 
. 

BindToType &
(& '
assemblyName' 3
,3 4
typeName5 =
)= >
;> ?
} 
} 	
private 
static "
JsonSerializerSettings -
	_settings. 7
=8 9
new: =
(= >
)> ?
{ 	 
DefaultValueHandling  
=! " 
DefaultValueHandling# 7
.7 8
Ignore8 >
,> ?
NullValueHandling 
= 
NullValueHandling  1
.1 2
Ignore2 8
,8 9
TypeNameHandling 
= 
TypeNameHandling /
./ 0
All0 3
,3 4
ConstructorHandling 
=  !
ConstructorHandling" 5
.5 6,
 AllowNonPublicDefaultConstructor6 V
,V W&
PreserveReferencesHandling   &
=  ' (&
PreserveReferencesHandling  ) C
.  C D
All  D G
,  G H"
ObjectCreationHandling!! "
=!!# $"
ObjectCreationHandling!!% ;
.!!; <
Auto!!< @
,!!@ A!
ReferenceLoopHandling"" !
=""" #!
ReferenceLoopHandling""$ 9
.""9 :
	Serialize"": C
,""C D
SerializationBinder## 
=##  !
new##" %/
#DotNetCompatibleSerializationBinder##& I
(##I J
)##J K
}$$ 	
;$$	 

public&& 
static&& 
string&& 
ToJson&& #
(&&# $
object&&$ *
?&&* +
obj&&, /
)&&/ 0
=>&&1 3
JsonConvert&&4 ?
.&&? @
SerializeObject&&@ O
(&&O P
obj&&P S
,&&S T

Formatting&&U _
.&&_ `
Indented&&` h
,&&h i
	_settings&&j s
)&&s t
;&&t u
public'' 
static'' 
T'' 
?'' 
FromJson'' !
<''! "
T''" #
>''# $
(''$ %
string''% +
json'', 0
)''0 1
=>''2 4
JsonConvert''5 @
.''@ A
DeserializeObject''A R
<''R S
T''S T
>''T U
(''U V
json''V Z
,''Z [
	_settings''\ e
)''e f
;''f g
}(( 
})) Í
u/Users/a1/Documents/GitHub/turn-based-prototype/Server/Framework/Deterministic.GameFramework.Client/INetworkLogger.cs
	namespace 	
Deterministic
 
. 
GameFramework %
.% &
Client& ,
{ 
public 

	interface 
INetworkLogger #
{ 
void 
Log 
( 
string 
message 
)  
;  !
void 
LogError 
( 
string 
message $
)$ %
;% &
} 
} M
j/Users/a1/Documents/GitHub/turn-based-prototype/Server/Framework/Deterministic.GameFramework.Client/Api.cs
	namespace 	
Deterministic
 
. 
GameFramework %
.% &
Client& ,
{ 
public 

class 
Api 
{ 
private 
readonly 

RestClient #
_client$ +
;+ ,
public 
string 
BaseUrl 
{ 
get  #
;# $
}% &
public 
Api 
( 
string 
baseUrl !
)! "
{ 	
BaseUrl 
= 
baseUrl 
; 
_client 
= 
new 

RestClient $
($ %
baseUrl% ,
), -
;- .
} 	
public 
async 
Task 
< 
T 
> 
Get  
<  !
T! "
>" #
(# $
string$ *
url+ .
). /
{ 	
var 
request 
= 
new 
RestRequest )
() *
url* -
,- .
Method/ 5
.5 6
Get6 9
)9 :
;: ;
NetworkLogger 
. 
Log 
( 
$"  
$str  *
{* +
BaseUrl+ 2
}2 3
{3 4
url4 7
}7 8
"8 9
)9 :
;: ;
try 
{   
var!! 
response!! 
=!! 
await!! $
_client!!% ,
.!!, -
ExecuteAsync!!- 9
<!!9 :
T!!: ;
>!!; <
(!!< =
request!!= D
)!!D E
;!!E F
if## 
(## 
!## 
response## 
.## 
IsSuccessful## *
)##* +
{$$ 
NetworkLogger%% !
.%%! "
LogError%%" *
(%%* +
$"%%+ -
$str%%- :
{%%: ;
response%%; C
.%%C D

StatusCode%%D N
}%%N O
$str%%O R
{%%R S
response%%S [
.%%[ \
ErrorMessage%%\ h
}%%h i
"%%i j
)%%j k
;%%k l
return&& 
default&& "
;&&" #
}'' 
return)) 
response)) 
.))  
Data))  $
;))$ %
}** 
catch++ 
(++ 
	Exception++ 
ex++ 
)++  
{,, 
NetworkLogger-- 
.-- 
LogError-- &
(--& '
$"--' )
$str--) :
{--: ;
ex--; =
.--= >
Message--> E
}--E F
"--F G
)--G H
;--H I
return.. 
default.. 
;.. 
}// 
}00 	
public33 
async33 
Task33 
<33 
T33 
>33 
Post33 !
<33! "
T33" #
>33# $
(33$ %
string33% +
url33, /
,33/ 0
object331 7
body338 <
=33= >
null33? C
)33C D
{44 	
var55 
request55 
=55 
new55 
RestRequest55 )
(55) *
url55* -
,55- .
Method55/ 5
.555 6
Post556 :
)55: ;
;55; <
if66 
(66 
body66 
!=66 
null66 
)66 
request77 
.77 
AddJsonBody77 #
(77# $
body77$ (
)77( )
;77) *
NetworkLogger99 
.99 
Log99 
(99 
$"99  
$str99  +
{99+ ,
BaseUrl99, 3
}993 4
{994 5
url995 8
}998 9
"999 :
)99: ;
;99; <
try;; 
{<< 
var== 
response== 
=== 
await== $
_client==% ,
.==, -
ExecuteAsync==- 9
<==9 :
T==: ;
>==; <
(==< =
request=== D
)==D E
;==E F
if?? 
(?? 
!?? 
response?? 
.?? 
IsSuccessful?? *
)??* +
{@@ 
NetworkLoggerAA !
.AA! "
LogErrorAA" *
(AA* +
$"AA+ -
$strAA- :
{AA: ;
responseAA; C
.AAC D

StatusCodeAAD N
}AAN O
$strAAO R
{AAR S
responseAAS [
.AA[ \
ErrorMessageAA\ h
}AAh i
"AAi j
)AAj k
;AAk l
returnBB 
defaultBB "
;BB" #
}CC 
returnEE 
responseEE 
.EE  
DataEE  $
;EE$ %
}FF 
catchGG 
(GG 
	ExceptionGG 
exGG 
)GG  
{HH 
NetworkLoggerII 
.II 
LogErrorII &
(II& '
$"II' )
$strII) :
{II: ;
exII; =
.II= >
MessageII> E
}IIE F
"IIF G
)IIG H
;IIH I
returnJJ 
defaultJJ 
;JJ 
}KK 
}LL 	
publicOO 
asyncOO 
TaskOO 
<OO 
TOO 
>OO 
PutOO  
<OO  !
TOO! "
>OO" #
(OO# $
stringOO$ *
urlOO+ .
,OO. /
objectOO0 6
bodyOO7 ;
=OO< =
nullOO> B
)OOB C
{PP 	
varQQ 
requestQQ 
=QQ 
newQQ 
RestRequestQQ )
(QQ) *
urlQQ* -
,QQ- .
MethodQQ/ 5
.QQ5 6
PutQQ6 9
)QQ9 :
;QQ: ;
ifRR 
(RR 
bodyRR 
!=RR 
nullRR 
)RR 
requestSS 
.SS 
AddJsonBodySS #
(SS# $
bodySS$ (
)SS( )
;SS) *
NetworkLoggerUU 
.UU 
LogUU 
(UU 
$"UU  
$strUU  *
{UU* +
BaseUrlUU+ 2
}UU2 3
{UU3 4
urlUU4 7
}UU7 8
"UU8 9
)UU9 :
;UU: ;
tryWW 
{XX 
varYY 
responseYY 
=YY 
awaitYY $
_clientYY% ,
.YY, -
ExecuteAsyncYY- 9
<YY9 :
TYY: ;
>YY; <
(YY< =
requestYY= D
)YYD E
;YYE F
if[[ 
([[ 
![[ 
response[[ 
.[[ 
IsSuccessful[[ *
)[[* +
{\\ 
NetworkLogger]] !
.]]! "
LogError]]" *
(]]* +
$"]]+ -
$str]]- :
{]]: ;
response]]; C
.]]C D

StatusCode]]D N
}]]N O
$str]]O R
{]]R S
response]]S [
.]][ \
ErrorMessage]]\ h
}]]h i
"]]i j
)]]j k
;]]k l
return^^ 
default^^ "
;^^" #
}__ 
returnaa 
responseaa 
.aa  
Dataaa  $
;aa$ %
}bb 
catchcc 
(cc 
	Exceptioncc 
excc 
)cc  
{dd 
NetworkLoggeree 
.ee 
LogErroree &
(ee& '
$"ee' )
$stree) :
{ee: ;
exee; =
.ee= >
Messageee> E
}eeE F
"eeF G
)eeG H
;eeH I
returnff 
defaultff 
;ff 
}gg 
}hh 	
publickk 
asynckk 
Taskkk 
<kk 
Tkk 
>kk 
Deletekk #
<kk# $
Tkk$ %
>kk% &
(kk& '
stringkk' -
urlkk. 1
)kk1 2
{ll 	
varmm 
requestmm 
=mm 
newmm 
RestRequestmm )
(mm) *
urlmm* -
,mm- .
Methodmm/ 5
.mm5 6
Deletemm6 <
)mm< =
;mm= >
NetworkLoggernn 
.nn 
Lognn 
(nn 
$"nn  
$strnn  -
{nn- .
BaseUrlnn. 5
}nn5 6
{nn6 7
urlnn7 :
}nn: ;
"nn; <
)nn< =
;nn= >
trypp 
{qq 
varrr 
responserr 
=rr 
awaitrr $
_clientrr% ,
.rr, -
ExecuteAsyncrr- 9
<rr9 :
Trr: ;
>rr; <
(rr< =
requestrr= D
)rrD E
;rrE F
iftt 
(tt 
!tt 
responsett 
.tt 
IsSuccessfultt *
)tt* +
{uu 
NetworkLoggervv !
.vv! "
LogErrorvv" *
(vv* +
$"vv+ -
$strvv- :
{vv: ;
responsevv; C
.vvC D

StatusCodevvD N
}vvN O
$strvvO R
{vvR S
responsevvS [
.vv[ \
ErrorMessagevv\ h
}vvh i
"vvi j
)vvj k
;vvk l
returnww 
defaultww "
;ww" #
}xx 
returnzz 
responsezz 
.zz  
Datazz  $
;zz$ %
}{{ 
catch|| 
(|| 
	Exception|| 
ex|| 
)||  
{}} 
NetworkLogger~~ 
.~~ 
LogError~~ &
(~~& '
$"~~' )
$str~~) :
{~~: ;
ex~~; =
.~~= >
Message~~> E
}~~E F
"~~F G
)~~G H
;~~H I
return 
default 
; 
}
ÄÄ 
}
ÅÅ 	
}
ÇÇ 
}ÉÉ «G
v/Users/a1/Documents/GitHub/turn-based-prototype/Server/Framework/Deterministic.GameFramework.Client/ActionProcessor.cs
	namespace		 	
Deterministic		
 
.		 
GameFramework		 %
.		% &
Client		& ,
{

 
public 

class 
ActionProcessor  
<  !

TGameState! +
>+ ,
where- 2

TGameState3 =
:> ?
BranchDomain@ L
{ 
public 
NetworkClient 
NetworkClient *
{+ ,
get- 0
;0 1
set2 5
;5 6
}7 8
public 
readonly 

Dictionary "
<" #
NetworkThread# 0
,0 1
Subject2 9
<9 :
INetworkAction: H
>H I
>I J
OnActionByThreadK [
=\ ]
new^ a
(a b
)b c
;c d
public 
Subject 
< 
INetworkAction %
>% &
OnAction' /
=>0 2
OnActionByThread3 C
[C D
NetworkThreadD Q
.Q R
MainR V
]V W
;W X
private 
readonly 

Dictionary #
<# $
NetworkThread$ 1
,1 2
Locker3 9
>9 :
_lockers; C
=D E
newF I
(I J
)J K
;K L
private !
NetworkActionExecutor %
	_executor& /
;/ 0
private   

TGameState   

_gameState   %
;  % &
private## 
readonly## 
List## 
<## 
IDisposable## )
>##) *
_disposables##+ 7
=##8 9
new##: =
(##= >
)##> ?
;##? @
public%% 
ActionProcessor%% 
(%% 
NetworkClient%% ,
networkClient%%- :
)%%: ;
{&& 	
NetworkClient'' 
='' 
networkClient'' )
;'') *
foreach** 
(** 
NetworkThread** "
thread**# )
in*** ,
NetworkThread**- :
.**: ;
GetAll**; A
(**A B
)**B C
)**C D
{++ 
OnActionByThread,,  
[,,  !
thread,,! '
],,' (
=,,) *
new,,+ .
Subject,,/ 6
<,,6 7
INetworkAction,,7 E
>,,E F
(,,F G
),,G H
;,,H I
_lockers00 
[00 
thread00 
]00  
=00! "
thread00# )
==00* ,
NetworkThread00- :
.00: ;
Main00; ?
?00@ A
new00B E
Locker00F L
(00L M
)00M N
:00O P
null00Q U
;00U V
}11 
_disposables44 
.44 
Add44 
(44 

Observable44 '
.44' (
IntervalFrame44( 5
(445 6
$num446 7
)447 8
.448 9
	Subscribe449 B
(44B C
_44C D
=>44E G
Update44H N
(44N O
)44O P
)44P Q
)44Q R
;44R S
}55 	
public;; 
void;; 
SetGameState;;  
(;;  !

TGameState;;! +
	gameState;;, 5
,;;5 6
DomainRegistry;;7 E
registry;;F N
);;N O
{<< 	

_gameState== 
=== 
	gameState== "
;==" #
	_executor>> 
=>> 
new>> !
NetworkActionExecutor>> 1
(>>1 2
registry>>2 :
)>>: ;
;>>; <
}?? 	
publicDD 
voidDD 
DisposeDD 
(DD 
)DD 
{EE 	
foreachFF 
(FF 
varFF 

disposableFF #
inFF$ &
_disposablesFF' 3
)FF3 4
{GG 

disposableHH 
?HH 
.HH 
DisposeHH #
(HH# $
)HH$ %
;HH% &
}II 
_disposablesJJ 
.JJ 
ClearJJ 
(JJ 
)JJ  
;JJ  !
}KK 	
publicQQ 
IDisposableQQ 
LockQQ 
(QQ  
)QQ  !
{RR 	
returnSS 
LockSS 
(SS 
NetworkThreadSS %
.SS% &
MainSS& *
)SS* +
;SS+ ,
}TT 	
public[[ 
IDisposable[[ 
Lock[[ 
([[  
NetworkThread[[  -
thread[[. 4
)[[4 5
{\\ 	
var]] 
locker]] 
=]] 
_lockers]] !
[]]! "
thread]]" (
]]]( )
;]]) *
if^^ 
(^^ 
locker^^ 
==^^ 
null^^ 
)^^ 
throw__ 
new__ %
InvalidOperationException__ 3
(__3 4
$"__4 6
$str__6 =
{__= >
thread__> D
}__D E
$str	__E à
"
__à â
)
__â ä
;
__ä ã
returnaa 
lockeraa 
.aa 
Lockaa 
(aa 
)aa  
;aa  !
}bb 	
publicgg 
boolgg 
IsThreadLockedgg "
(gg" #
NetworkThreadgg# 0
threadgg1 7
)gg7 8
{hh 	
varii 
lockerii 
=ii 
_lockersii !
[ii! "
threadii" (
]ii( )
;ii) *
returnjj 
lockerjj 
!=jj 
nulljj !
&&jj" $
lockerjj% +
.jj+ ,
IsLockedjj, 4
;jj4 5
}kk 	
privatemm 
voidmm 
Updatemm 
(mm 
)mm 
{nn 	
foreachpp 
(pp 
varpp 
threadpp 
inpp  "
NetworkClientpp# 0
.pp0 1
ActionsByThreadpp1 @
.pp@ A
KeysppA E
)ppE F
{qq 
varrr 
queuerr 
=rr 
NetworkClientrr )
.rr) *
ActionsByThreadrr* 9
[rr9 :
threadrr: @
]rr@ A
;rrA B
varss 
lockerss 
=ss 
_lockersss %
[ss% &
threadss& ,
]ss, -
;ss- .
ifvv 
(vv 
queuevv 
.vv 
Countvv 
<=vv  "
$numvv# $
)vv$ %
continueww 
;ww 
ifyy 
(yy 
lockeryy 
!=yy 
nullyy "
&&yy# %
lockeryy& ,
.yy, -
IsLockedyy- 5
)yy5 6
continuezz 
;zz 
var}} 
action}} 
=}} 
queue}} "
.}}" #
Dequeue}}# *
(}}* +
)}}+ ,
;}}, -
if
ÄÄ 
(
ÄÄ 
action
ÄÄ 
.
ÄÄ 
	CurrentId
ÄÄ $
>
ÄÄ% &
$num
ÄÄ' (
&&
ÄÄ) +

_gameState
ÄÄ, 6
!=
ÄÄ7 9
null
ÄÄ: >
)
ÄÄ> ?
{
ÅÅ 
var
ÇÇ 

idProvider
ÇÇ "
=
ÇÇ# $

_gameState
ÇÇ% /
.
ÇÇ/ 0
GetFirst
ÇÇ0 8
<
ÇÇ8 9
IdProviderDomain
ÇÇ9 I
>
ÇÇI J
(
ÇÇJ K
)
ÇÇK L
;
ÇÇL M
if
ÉÉ 
(
ÉÉ 

idProvider
ÉÉ "
!=
ÉÉ# %
null
ÉÉ& *
&&
ÉÉ+ -

idProvider
ÉÉ. 8
.
ÉÉ8 9
CurrentCounter
ÉÉ9 G
!=
ÉÉH J
action
ÉÉK Q
.
ÉÉQ R
	CurrentId
ÉÉR [
)
ÉÉ[ \
{
ÑÑ 
NetworkLogger
ÖÖ %
.
ÖÖ% &
LogError
ÖÖ& .
(
ÖÖ. /
$"
ÖÖ/ 1
$str
ÖÖ1 ^
{
ÖÖ^ _
action
ÖÖ_ e
.
ÖÖe f
GetType
ÖÖf m
(
ÖÖm n
)
ÖÖn o
.
ÖÖo p
Name
ÖÖp t
}
ÖÖt u
$strÖÖu ä
{ÖÖä ã
actionÖÖã ë
.ÖÖë í
	CurrentIdÖÖí õ
}ÖÖõ ú
$strÖÖú ≥
{ÖÖ≥ ¥

idProviderÖÖ¥ æ
.ÖÖæ ø
CurrentCounterÖÖø Õ
}ÖÖÕ Œ
"ÖÖŒ œ
)ÖÖœ –
;ÖÖ– —
}
ÜÜ 
}
áá 
	_executor
ää 
?
ää 
.
ää 
ExecuteAction
ää (
(
ää( )
action
ää) /
,
ää/ 0
null
ää1 5
,
ää5 6
error
ää7 <
=>
ää= ?
NetworkLogger
ää@ M
.
ääM N
LogError
ääN V
(
ääV W
$"
ääW Y
$str
ääY k
{
ääk l
error
ääl q
}
ääq r
"
äär s
)
ääs t
)
äät u
;
ääu v
OnActionByThread
çç  
[
çç  !
thread
çç! '
]
çç' (
.
çç( )
OnNext
çç) /
(
çç/ 0
action
çç0 6
)
çç6 7
;
çç7 8
}
éé 
}
èè 	
}
êê 
}ëë 