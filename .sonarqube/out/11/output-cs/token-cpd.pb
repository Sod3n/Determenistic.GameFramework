«0
y/Users/a1/Documents/GitHub/turn-based-prototype/Server/Framework/Deterministic.GameFramework.Core/Utils/JsonSerializer.cs
	namespace 	
Deterministic
 
. 
GameFramework %
.% &
Core& *
.* +
Utils+ 0
;0 1
public		 
static		 
class		 
JsonSerializer		 "
{

 
internal 
sealed 
class #
SafeSerializationBinder 1
:2 3&
DefaultSerializationBinder4 N
{ 
private 
const 
string 
CoreLibAssembly ,
=- .
$str/ G
;G H
private 
const 
string 
MscorlibAssembly -
=. /
$str0 :
;: ;
private 
static 
readonly 
HashSet  '
<' (
string( .
>. /
AllowedNamespaces0 A
=B C
newD G
(G H
)H I
{ 	
$str .
,. /
$str 0
,0 1
$str 0
,0 1
$str 2
,2 3
$str *
,* +
$str (
,( )
$str 
} 	
;	 

private!! 
static!! 
readonly!! 
HashSet!!  '
<!!' (
string!!( .
>!!. /
DangerousTypes!!0 >
=!!? @
new!!A D
(!!D E
)!!E F
{"" 	
$str## 
,## 
$str$$  
,$$  !
$str%% !
,%%! "
$str&& (
,&&( )
$str'' (
,''( )
$str(( 5
})) 	
;))	 

public++ 
override++ 
Type++ 

BindToType++ '
(++' (
string++( .
assemblyName++/ ;
,++; <
string++= C
typeName++D L
)++L M
{,, 	
if.. 
(.. 
assemblyName.. 
==.. 
CoreLibAssembly..  /
)../ 0
{// 
assemblyName00 
=00 
MscorlibAssembly00 /
;00/ 0
typeName11 
=11 
typeName11 #
.11# $
Replace11$ +
(11+ ,
CoreLibAssembly11, ;
,11; <
MscorlibAssembly11= M
)11M N
;11N O
}22 
if55 
(55 
DangerousTypes55 
.55 
Any55 "
(55" #
	dangerous55# ,
=>55- /
typeName550 8
.558 9

StartsWith559 C
(55C D
	dangerous55D M
)55M N
)55N O
)55O P
{66 
throw77 
new77 &
JsonSerializationException77 4
(774 5
$"88 
$str88 /
{88/ 0
typeName880 8
}888 9
$str889 _
"88_ `
)88` a
;88a b
}99 
var<< 
	isAllowed<< 
=<< 
AllowedNamespaces<< -
.<<- .
Any<<. 1
(<<1 2
ns<<2 4
=><<5 7
typeName<<8 @
.<<@ A

StartsWith<<A K
(<<K L
ns<<L N
)<<N O
)<<O P
;<<P Q
if== 
(== 
!== 
	isAllowed== 
)== 
{>> 
throw?? 
new?? &
JsonSerializationException?? 4
(??4 5
$"@@ 
$str@@ /
{@@/ 0
typeName@@0 8
}@@8 9
$str@@9 K
"@@K L
+@@M N
$"AA 
$strAA Q
"AAQ R
)AAR S
;AAS T
}BB 
returnDD 
baseDD 
.DD 

BindToTypeDD "
(DD" #
assemblyNameDD# /
,DD/ 0
typeNameDD1 9
)DD9 :
;DD: ;
}EE 	
}FF 
privateHH 
staticHH "
JsonSerializerSettingsHH )
	_settingsHH* 3
=HH4 5
newHH6 9
(HH9 :
)HH: ;
{II  
DefaultValueHandlingJJ 
=JJ  
DefaultValueHandlingJJ 3
.JJ3 4
IgnoreJJ4 :
,JJ: ;
NullValueHandlingKK 
=KK 
NullValueHandlingKK -
.KK- .
IgnoreKK. 4
,KK4 5
TypeNameHandlingLL 
=LL 
TypeNameHandlingLL +
.LL+ ,
AllLL, /
,LL/ 0
ConstructorHandlingMM 
=MM 
ConstructorHandlingMM 1
.MM1 2,
 AllowNonPublicDefaultConstructorMM2 R
,MMR S&
PreserveReferencesHandlingNN "
=NN# $&
PreserveReferencesHandlingNN% ?
.NN? @
ObjectsNN@ G
,NNG H"
ObjectCreationHandlingOO 
=OO  "
ObjectCreationHandlingOO! 7
.OO7 8
AutoOO8 <
,OO< =!
ReferenceLoopHandlingPP 
=PP !
ReferenceLoopHandlingPP  5
.PP5 6
IgnorePP6 <
,PP< =
MaxDepthQQ 
=QQ 
$numQQ 
,QQ 
SerializationBinderRR 
=RR 
newRR !#
SafeSerializationBinderRR" 9
(RR9 :
)RR: ;
}SS 
;SS 
publicUU 

staticUU 
stringUU 
ToJsonUU 
(UU  
objectUU  &
?UU& '
objUU( +
)UU+ ,
=>UU- /
JsonConvertUU0 ;
.UU; <
SerializeObjectUU< K
(UUK L
objUUL O
,UUO P

FormattingUUQ [
.UU[ \
IndentedUU\ d
,UUd e
	_settingsUUf o
)UUo p
;UUp q
publicVV 

staticVV 
TVV 
?VV 
FromJsonVV 
<VV 
TVV 
>VV  
(VV  !
stringVV! '
jsonVV( ,
)VV, -
=>VV. 0
JsonConvertVV1 <
.VV< =
DeserializeObjectVV= N
<VVN O
TVVO P
>VVP Q
(VVQ R
jsonVVR V
,VVV W
	_settingsVVX a
)VVa b
;VVb c
}WW ü
/Users/a1/Documents/GitHub/turn-based-prototype/Server/Framework/Deterministic.GameFramework.Core/Utils/DisposableExtensions.cs
	namespace 	
Deterministic
 
. 
GameFramework %
.% &
Core& *
.* +

Extensions+ 5
;5 6
public 
static 
class  
DisposableExtensions (
{ 
public 

static 
IDisposable 
AddTo #
(# $
this$ (
IDisposable) 4

disposable5 ?
,? @
CompositeDisposableA T
disposablesU `
)` a
{ 
disposables		 
.		 
Add		 
(		 

disposable		 "
)		" #
;		# $
return

 

disposable

 
;

 
} 
} Ö
~/Users/a1/Documents/GitHub/turn-based-prototype/Server/Framework/Deterministic.GameFramework.Core/Utils/CompositeDisposable.cs
	namespace 	
Deterministic
 
. 
GameFramework %
.% &
Core& *
.* +
Utils+ 0
;0 1
[ 

JsonObject 
( 
MemberSerialization 
.  
OptIn  %
)% &
]& '
public 
class 
CompositeDisposable  
:! "
IDisposable# .
{ 
private 
List 
< 
IDisposable 
> 
_disposables *
=+ ,
new- 0
(0 1
)1 2
;2 3
private		 
bool		 
	_disposed		 
;		 
public 

List 
< 
IDisposable 
> 
Disposables (
=>) +
_disposables, 8
;8 9
public 

void 
Add 
( 
IDisposable 

disposable  *
)* +
{ 
if 

( 
	_disposed 
) 
{ 	

disposable 
? 
. 
Dispose 
(  
)  !
;! "
return 
; 
} 	
_disposables 
. 
Add 
( 

disposable #
)# $
;$ %
} 
public 

void 
Dispose 
( 
) 
{ 
if 

( 
	_disposed 
) 
return 
; 
	_disposed 
= 
true 
; 
foreach 
( 
var 

disposable 
in  "
_disposables# /
)/ 0
{ 	

disposable 
? 
. 
Dispose 
(  
)  !
;! "
} 	
_disposables   
.   
Clear   
(   
)   
;   
}!! 
}"" ¼
€/Users/a1/Documents/GitHub/turn-based-prototype/Server/Framework/Deterministic.GameFramework.Core/Random/RandomProviderDomain.cs
	namespace 	
Deterministic
 
. 
GameFramework %
.% &
Core& *
;* +
public 
class  
RandomProviderDomain !
:" #
BranchDomain$ 0
{		 
public

 

Random

 
Random

 
{

 
get

 
;

 
private

  '
set

( +
;

+ ,
}

- .
public 

int 
Seed 
{ 
get 
; 
private "
set# &
;& '
}( )
public 
 
RandomProviderDomain 
(  
BranchDomain  ,
targetDomain- 9
,9 :
int; >
?> ?
initialSeed@ K
=L M
nullN R
)R S
:T U
baseV Z
(Z [
targetDomain[ g
)g h
{ 
var 
seed 
= 
initialSeed 
?? !
System" (
.( )
Random) /
./ 0
Shared0 6
.6 7
Next7 ;
(; <
)< =
;= >
Random 
= 
new 
Random 
( 
seed  
)  !
;! "
Seed 
= 
seed 
; 
new !
ProvideRandomReaction !
(! "
this" &
,& '
targetDomain( 4
)4 5
.5 6
AddTo6 ;
(; <
Disposables< G
)G H
;H I
} 
public 

void 
Reset 
( 
int 
seed 
) 
{ 
Random 
= 
new 
Random 
( 
seed  
)  !
;! "
} 
private 
class !
ProvideRandomReaction '
:( )
Reaction* 2
,2 3
IBeforeReaction4 C
<C D

LeafDomainD N
,N O
IRequireRandomP ^
>^ _
{ 
private 
readonly  
RandomProviderDomain -
	_provider. 7
;7 8
public !
ProvideRandomReaction $
($ % 
RandomProviderDomain% 9
provider: B
,B C

LeafDomainD N
targetO U
)U V
:W X
baseY ]
(] ^
target^ d
)d e
{   	
	_provider!! 
=!! 
provider!!  
;!!  !
}"" 	
public$$ 
void$$ 
OnBefore$$ 
($$ 

LeafDomain$$ '
domain$$( .
,$$. /
IRequireRandom$$0 >
action$$? E
)$$E F
{%% 	
action&& 
.&& 
Random&& 
=&& 
	_provider&& %
.&&% &
Random&&& ,
;&&, -
}'' 	
}(( 
})) ¦
z/Users/a1/Documents/GitHub/turn-based-prototype/Server/Framework/Deterministic.GameFramework.Core/Random/IRequireRandom.cs
	namespace 	
Deterministic
 
. 
GameFramework %
.% &
Core& *
;* +
public 
	interface 
IRequireRandom 
:  !

IDARAction" ,
{ 
public 

Random 
Random 
{ 
get 
; 
set  #
;# $
}% &
} „
Œ/Users/a1/Documents/GitHub/turn-based-prototype/Server/Framework/Deterministic.GameFramework.Core/ObservableAttribute/ObservableAttribute.cs
	namespace 	
Deterministic
 
. 
GameFramework %
.% &
Core& *
;* +
public 
class 
ObservableAttribute  
<  !
TValue! '
>' (
(( )
TValue) /
initialValue0 <
== >
default? F
)F G
{ 
private 
TValue 
_value 
= 
initialValue (
;( )
private 
event 
Action 
< 
TValue 
>  
OnChangeAction! /
;/ 0
public

 

TValue

 
Value

 
{ 
get 
=> 
_value 
; 
set 
{ 	
if 
( 
EqualityComparer  
<  !
TValue! '
>' (
.( )
Default) 0
.0 1
Equals1 7
(7 8
_value8 >
,> ?
value@ E
)E F
)F G
returnH N
;N O
_value 
= 
value 
; 
OnChangeAction 
? 
. 
Invoke "
(" #
value# (
)( )
;) *
} 	
} 
public 

IDisposable 
Observe 
( 

LeafDomain )
observer* 2
,2 3
Action4 :
<: ;
TValue; A
>A B
callbackC K
,K L
boolM Q
fireImmediatelyR a
=b c
trued h
)h i
{ 
if 

( 
fireImmediately 
) 
callback %
(% &
_value& ,
), -
;- .
OnChangeAction 
+= 
callback "
;" #
var 

disposable 
= 
new 
ActionDisposable -
(- .
(. /
)/ 0
=>1 3
OnChangeAction4 B
-=C E
callbackF N
)N O
;O P
observer 
. 
Disposables 
. 
Add  
(  !

disposable! +
)+ ,
;, -
return 

disposable 
; 
} 
} 
public   
class   
ActionDisposable   
(   
Action   $
action  % +
)  + ,
:  - .
IDisposable  / :
{!! 
public"" 

void"" 
Dispose"" 
("" 
)"" 
{## 
action$$ 
?$$ 
.$$ 
Invoke$$ 
($$ 
)$$ 
;$$ 
}%% 
}&& Å	
…/Users/a1/Documents/GitHub/turn-based-prototype/Server/Framework/Deterministic.GameFramework.Core/ObservableAttribute/List/Shuffle.cs
	namespace 	
Deterministic
 
. 
GameFramework %
.% &
Core& *
;* +
public 
class 
Shuffle 
< 
T 
> 
( #
ObservableAttributeList /
</ 0
T0 1
>1 2
target3 9
)9 :
:; <
	DARAction= F
<F G

LeafDomainG Q
,Q R
ShuffleS Z
<Z [
T[ \
>\ ]
>] ^
,^ _
IRequireRandom` n
{ 
public		 

Random		 
Random		 
{		 
get		 
;		 
set		  #
;		# $
}		% &
	protected 
override 
void 
ExecuteProcess *
(* +

LeafDomain+ 5
domain6 <
)< =
{ 
target 
. 
Shuffle 
( 
Random 
) 
; 
} 
} üÃ
•/Users/a1/Documents/GitHub/turn-based-prototype/Server/Framework/Deterministic.GameFramework.Core/ObservableAttribute/List/ObservableAttributeList.cs
	namespace 	
Deterministic
 
. 
GameFramework %
.% &
Core& *
;* +
public 
readonly 
struct 
ListAddEventArgs '
<' (
TValue( .
>. /
(/ 0
TValue0 6
item7 ;
,; <
int= @
indexA F
)F G
{ 
public 

TValue 
Item 
{ 
get 
; 
} 
=  !
item" &
;& '
public 

int 
Index 
{ 
get 
; 
} 
= 
index  %
;% &
} 
public 
readonly 
struct 
ListRemoveEventArgs *
<* +
TValue+ 1
>1 2
(2 3
TValue3 9
item: >
,> ?
int@ C
indexD I
)I J
{ 
public 

TValue 
Item 
{ 
get 
; 
} 
=  !
item" &
;& '
public 

int 
Index 
{ 
get 
; 
} 
= 
index  %
;% &
} 
public 
readonly 
struct 
ListSetEventArgs '
<' (
TValue( .
>. /
(/ 0
TValue0 6
oldValue7 ?
,? @
TValueA G
newValueH P
,P Q
intR U
indexV [
)[ \
{ 
public   

TValue   
OldValue   
{   
get    
;    !
}  " #
=  $ %
oldValue  & .
;  . /
public!! 

TValue!! 
NewValue!! 
{!! 
get!!  
;!!  !
}!!" #
=!!$ %
newValue!!& .
;!!. /
public"" 

int"" 
Index"" 
{"" 
get"" 
;"" 
}"" 
="" 
index""  %
;""% &
}## 
public%% 
class%% #
ObservableAttributeList%% $
<%%$ %
TValue%%% +
>%%+ ,
:%%- .
IList%%/ 4
<%%4 5
TValue%%5 ;
>%%; <
{&& 
private'' 
List'' 
<'' 
TValue'' 
>'' 
_list'' 
=''  
new''! $
(''$ %
)''% &
;''& '
private** 
event** 
Action** 
<** 
ListAddEventArgs** )
<**) *
TValue*** 0
>**0 1
>**1 2
?**2 3
OnAdd**4 9
;**9 :
private++ 
event++ 
Action++ 
<++ 
ListRemoveEventArgs++ ,
<++, -
TValue++- 3
>++3 4
>++4 5
?++5 6
OnBeforeRemove++7 E
;++E F
private,, 
event,, 
Action,, 
<,, 
ListRemoveEventArgs,, ,
<,,, -
TValue,,- 3
>,,3 4
>,,4 5
?,,5 6
OnRemove,,7 ?
;,,? @
private-- 
event-- 
Action-- 
<-- 
ListAddEventArgs-- )
<--) *
TValue--* 0
>--0 1
>--1 2
?--2 3
OnInsert--4 <
;--< =
private.. 
event.. 
Action.. 
<.. 
ListSetEventArgs.. )
<..) *
TValue..* 0
>..0 1
>..1 2
?..2 3
OnSet..4 9
;..9 :
private// 
event// 
Action// 
?// 
OnBeforeClear// '
;//' (
private11 
event11 
Action11 
?11 
OnClear11 !
;11! "
private22 
event22 
Action22 
?22 
OnSort22  
;22  !
public44 

TValue44 
this44 
[44 
int44 
index44  
]44  !
{55 
get66 
=>66 
_list66 
[66 
index66 
]66 
;66 
set77 
{88 	
var99 
oldValue99 
=99 
_list99  
[99  !
index99! &
]99& '
;99' (
if:: 
(:: 
EqualityComparer::  
<::  !
TValue::! '
>::' (
.::( )
Default::) 0
.::0 1
Equals::1 7
(::7 8
oldValue::8 @
,::@ A
value::B G
)::G H
)::H I
return::J P
;::P Q
_list;; 
[;; 
index;; 
];; 
=;; 
value;;  
;;;  !
OnSet<< 
?<< 
.<< 
Invoke<< 
(<< 
new<< 
ListSetEventArgs<< .
<<<. /
TValue<</ 5
><<5 6
(<<6 7
oldValue<<7 ?
,<<? @
value<<A F
,<<F G
index<<H M
)<<M N
)<<N O
;<<O P
}== 	
}>> 
public@@ 

int@@ 
Count@@ 
=>@@ 
_list@@ 
.@@ 
Count@@ #
;@@# $
publicAA 

boolAA 

IsReadOnlyAA 
=>AA 
falseAA #
;AA# $
publicCC 
#
ObservableAttributeListCC "
(CC" #
)CC# $
{CC% &
}CC' (
publicEE 
#
ObservableAttributeListEE "
(EE" #
IEnumerableEE# .
<EE. /
TValueEE/ 5
>EE5 6

collectionEE7 A
)EEA B
{FF 
_listGG 
.GG 
AddRangeGG 
(GG 

collectionGG !
)GG! "
;GG" #
}HH 
publicJJ 

voidJJ 
AddJJ 
(JJ 
TValueJJ 
itemJJ 
)JJ  
{KK 
_listLL 
.LL 
AddLL 
(LL 
itemLL 
)LL 
;LL 
OnAddMM 
?MM 
.MM 
InvokeMM 
(MM 
newMM 
ListAddEventArgsMM *
<MM* +
TValueMM+ 1
>MM1 2
(MM2 3
itemMM3 7
,MM7 8
_listMM9 >
.MM> ?
CountMM? D
-MME F
$numMMG H
)MMH I
)MMI J
;MMJ K
}NN 
publicPP 

voidPP 
AddRangePP 
(PP 
IEnumerablePP $
<PP$ %
TValuePP% +
>PP+ ,
itemsPP- 2
)PP2 3
{QQ 
foreachRR 
(RR 
varRR 
itemRR 
inRR 
itemsRR "
)RR" #
AddSS 
(SS 
itemSS 
)SS 
;SS 
}TT 
publicVV 

boolVV 
RemoveVV 
(VV 
TValueVV 
itemVV "
)VV" #
{WW 
varXX 
indexXX 
=XX 
_listXX 
.XX 
IndexOfXX !
(XX! "
itemXX" &
)XX& '
;XX' (
ifYY 

(YY 
indexYY 
<YY 
$numYY 
)YY 
returnYY 
falseYY #
;YY# $
RemoveAtZZ 
(ZZ 
indexZZ 
)ZZ 
;ZZ 
return[[ 
true[[ 
;[[ 
}\\ 
public^^ 

void^^ 
RemoveAt^^ 
(^^ 
int^^ 
index^^ "
)^^" #
{__ 
var`` 
item`` 
=`` 
_list`` 
[`` 
index`` 
]`` 
;``  
OnBeforeRemoveaa 
?aa 
.aa 
Invokeaa 
(aa 
newaa "
ListRemoveEventArgsaa# 6
<aa6 7
TValueaa7 =
>aa= >
(aa> ?
itemaa? C
,aaC D
indexaaE J
)aaJ K
)aaK L
;aaL M
_listbb 
.bb 
RemoveAtbb 
(bb 
indexbb 
)bb 
;bb 
OnRemovecc 
?cc 
.cc 
Invokecc 
(cc 
newcc 
ListRemoveEventArgscc 0
<cc0 1
TValuecc1 7
>cc7 8
(cc8 9
itemcc9 =
,cc= >
indexcc? D
)ccD E
)ccE F
;ccF G
}dd 
publicff 

voidff 
Insertff 
(ff 
intff 
indexff  
,ff  !
TValueff" (
itemff) -
)ff- .
{gg 
_listhh 
.hh 
Inserthh 
(hh 
indexhh 
,hh 
itemhh  
)hh  !
;hh! "
OnInsertii 
?ii 
.ii 
Invokeii 
(ii 
newii 
ListAddEventArgsii -
<ii- .
TValueii. 4
>ii4 5
(ii5 6
itemii6 :
,ii: ;
indexii< A
)iiA B
)iiB C
;iiC D
}jj 
publicll 

voidll 
Clearll 
(ll 
)ll 
{mm 
OnBeforeClearnn 
?nn 
.nn 
Invokenn 
(nn 
)nn 
;nn  
_listoo 
.oo 
Clearoo 
(oo 
)oo 
;oo 
OnClearpp 
?pp 
.pp 
Invokepp 
(pp 
)pp 
;pp 
}qq 
publicss 

voidss 
Sortss 
(ss 
)ss 
{tt 
_listuu 
.uu 
Sortuu 
(uu 
)uu 
;uu 
OnSortvv 
?vv 
.vv 
Invokevv 
(vv 
)vv 
;vv 
}ww 
publicyy 

voidyy 
Sortyy 
(yy 
	ICompareryy 
<yy 
TValueyy %
>yy% &
compareryy' /
)yy/ 0
{zz 
_list{{ 
.{{ 
Sort{{ 
({{ 
comparer{{ 
){{ 
;{{ 
OnSort|| 
?|| 
.|| 
Invoke|| 
(|| 
)|| 
;|| 
}}} 
public 

void 
Sort 
( 

Comparison 
<  
TValue  &
>& '

comparison( 2
)2 3
{
€€ 
_list
 
.
 
Sort
 
(
 

comparison
 
)
 
;
 
OnSort
‚‚ 
?
‚‚ 
.
‚‚ 
Invoke
‚‚ 
(
‚‚ 
)
‚‚ 
;
‚‚ 
}
ƒƒ 
public
ˆˆ 

void
ˆˆ 
Shuffle
ˆˆ 
(
ˆˆ 
Random
ˆˆ 
random
ˆˆ %
)
ˆˆ% &
{
‰‰ 
for
ŠŠ 
(
ŠŠ 
int
ŠŠ 
i
ŠŠ 
=
ŠŠ 
_list
ŠŠ 
.
ŠŠ 
Count
ŠŠ  
-
ŠŠ! "
$num
ŠŠ# $
;
ŠŠ$ %
i
ŠŠ& '
>
ŠŠ( )
$num
ŠŠ* +
;
ŠŠ+ ,
i
ŠŠ- .
--
ŠŠ. 0
)
ŠŠ0 1
{
‹‹ 	
int
ŒŒ 
j
ŒŒ 
=
ŒŒ 
random
ŒŒ 
.
ŒŒ 
Next
ŒŒ 
(
ŒŒ  
i
ŒŒ  !
+
ŒŒ" #
$num
ŒŒ$ %
)
ŒŒ% &
;
ŒŒ& '
(
 
_list
 
[
 
i
 
]
 
,
 
_list
 
[
 
j
 
]
 
)
  
=
! "
(
# $
_list
$ )
[
) *
j
* +
]
+ ,
,
, -
_list
. 3
[
3 4
i
4 5
]
5 6
)
6 7
;
7 8
}
ŽŽ 	
OnSort
 
?
 
.
 
Invoke
 
(
 
)
 
;
 
}
 
public
’’ 

bool
’’ 
Contains
’’ 
(
’’ 
TValue
’’ 
item
’’  $
)
’’$ %
=>
’’& (
_list
’’) .
.
’’. /
Contains
’’/ 7
(
’’7 8
item
’’8 <
)
’’< =
;
’’= >
public
““ 

int
““ 
IndexOf
““ 
(
““ 
TValue
““ 
item
““ "
)
““" #
=>
““$ &
_list
““' ,
.
““, -
IndexOf
““- 4
(
““4 5
item
““5 9
)
““9 :
;
““: ;
public
”” 

void
”” 
CopyTo
”” 
(
”” 
TValue
”” 
[
”” 
]
”” 
array
””  %
,
””% &
int
””' *

arrayIndex
””+ 5
)
””5 6
=>
””7 9
_list
””: ?
.
””? @
CopyTo
””@ F
(
””F G
array
””G L
,
””L M

arrayIndex
””N X
)
””X Y
;
””Y Z
public
•• 

IEnumerator
•• 
<
•• 
TValue
•• 
>
•• 
GetEnumerator
•• ,
(
••, -
)
••- .
=>
••/ 1
_list
••2 7
.
••7 8
GetEnumerator
••8 E
(
••E F
)
••F G
;
••G H
IEnumerator
–– 
IEnumerable
–– 
.
–– 
GetEnumerator
–– )
(
––) *
)
––* +
=>
––, .
GetEnumerator
––/ <
(
––< =
)
––= >
;
––> ?
public
™™ 

IDisposable
™™ 

ObserveAdd
™™ !
(
™™! "

LeafDomain
™™" ,
observer
™™- 5
,
™™5 6
Action
™™7 =
<
™™= >
ListAddEventArgs
™™> N
<
™™N O
TValue
™™O U
>
™™U V
>
™™V W
callback
™™X `
)
™™` a
{
šš 
OnAdd
›› 
+=
›› 
callback
›› 
;
›› 
var
œœ 

disposable
œœ 
=
œœ 
new
œœ 
ActionDisposable
œœ -
(
œœ- .
(
œœ. /
)
œœ/ 0
=>
œœ1 3
OnAdd
œœ4 9
-=
œœ: <
callback
œœ= E
)
œœE F
;
œœF G
observer
 
.
 
Disposables
 
.
 
Add
  
(
  !

disposable
! +
)
+ ,
;
, -
return
žž 

disposable
žž 
;
žž 
}
ŸŸ 
public
¡¡ 

IDisposable
¡¡ 
ObserveRemove
¡¡ $
(
¡¡$ %

LeafDomain
¡¡% /
observer
¡¡0 8
,
¡¡8 9
Action
¡¡: @
<
¡¡@ A!
ListRemoveEventArgs
¡¡A T
<
¡¡T U
TValue
¡¡U [
>
¡¡[ \
>
¡¡\ ]
callback
¡¡^ f
)
¡¡f g
{
¢¢ 
OnRemove
££ 
+=
££ 
callback
££ 
;
££ 
var
¤¤ 

disposable
¤¤ 
=
¤¤ 
new
¤¤ 
ActionDisposable
¤¤ -
(
¤¤- .
(
¤¤. /
)
¤¤/ 0
=>
¤¤1 3
OnRemove
¤¤4 <
-=
¤¤= ?
callback
¤¤@ H
)
¤¤H I
;
¤¤I J
observer
¥¥ 
.
¥¥ 
Disposables
¥¥ 
.
¥¥ 
Add
¥¥  
(
¥¥  !

disposable
¥¥! +
)
¥¥+ ,
;
¥¥, -
return
¦¦ 

disposable
¦¦ 
;
¦¦ 
}
§§ 
public
©© 

IDisposable
©© !
ObserveBeforeRemove
©© *
(
©©* +

LeafDomain
©©+ 5
observer
©©6 >
,
©©> ?
Action
©©@ F
<
©©F G!
ListRemoveEventArgs
©©G Z
<
©©Z [
TValue
©©[ a
>
©©a b
>
©©b c
callback
©©d l
)
©©l m
{
ªª 
OnBeforeRemove
«« 
+=
«« 
callback
«« "
;
««" #
var
¬¬ 

disposable
¬¬ 
=
¬¬ 
new
¬¬ 
ActionDisposable
¬¬ -
(
¬¬- .
(
¬¬. /
)
¬¬/ 0
=>
¬¬1 3
OnBeforeRemove
¬¬4 B
-=
¬¬C E
callback
¬¬F N
)
¬¬N O
;
¬¬O P
observer
­­ 
.
­­ 
Disposables
­­ 
.
­­ 
Add
­­  
(
­­  !

disposable
­­! +
)
­­+ ,
;
­­, -
return
®® 

disposable
®® 
;
®® 
}
¯¯ 
public
±± 

IDisposable
±± 
ObserveInsert
±± $
(
±±$ %

LeafDomain
±±% /
observer
±±0 8
,
±±8 9
Action
±±: @
<
±±@ A
ListAddEventArgs
±±A Q
<
±±Q R
TValue
±±R X
>
±±X Y
>
±±Y Z
callback
±±[ c
)
±±c d
{
²² 
OnInsert
³³ 
+=
³³ 
callback
³³ 
;
³³ 
var
´´ 

disposable
´´ 
=
´´ 
new
´´ 
ActionDisposable
´´ -
(
´´- .
(
´´. /
)
´´/ 0
=>
´´1 3
OnInsert
´´4 <
-=
´´= ?
callback
´´@ H
)
´´H I
;
´´I J
observer
µµ 
.
µµ 
Disposables
µµ 
.
µµ 
Add
µµ  
(
µµ  !

disposable
µµ! +
)
µµ+ ,
;
µµ, -
return
¶¶ 

disposable
¶¶ 
;
¶¶ 
}
·· 
public
¹¹ 

IDisposable
¹¹ 

ObserveSet
¹¹ !
(
¹¹! "

LeafDomain
¹¹" ,
observer
¹¹- 5
,
¹¹5 6
Action
¹¹7 =
<
¹¹= >
ListSetEventArgs
¹¹> N
<
¹¹N O
TValue
¹¹O U
>
¹¹U V
>
¹¹V W
callback
¹¹X `
)
¹¹` a
{
ºº 
OnSet
»» 
+=
»» 
callback
»» 
;
»» 
var
¼¼ 

disposable
¼¼ 
=
¼¼ 
new
¼¼ 
ActionDisposable
¼¼ -
(
¼¼- .
(
¼¼. /
)
¼¼/ 0
=>
¼¼1 3
OnSet
¼¼4 9
-=
¼¼: <
callback
¼¼= E
)
¼¼E F
;
¼¼F G
observer
½½ 
.
½½ 
Disposables
½½ 
.
½½ 
Add
½½  
(
½½  !

disposable
½½! +
)
½½+ ,
;
½½, -
return
¾¾ 

disposable
¾¾ 
;
¾¾ 
}
¿¿ 
public
ÁÁ 

IDisposable
ÁÁ 
ObserveClear
ÁÁ #
(
ÁÁ# $

LeafDomain
ÁÁ$ .
observer
ÁÁ/ 7
,
ÁÁ7 8
Action
ÁÁ9 ?
callback
ÁÁ@ H
)
ÁÁH I
{
ÂÂ 
OnClear
ÃÃ 
+=
ÃÃ 
callback
ÃÃ 
;
ÃÃ 
var
ÄÄ 

disposable
ÄÄ 
=
ÄÄ 
new
ÄÄ 
ActionDisposable
ÄÄ -
(
ÄÄ- .
(
ÄÄ. /
)
ÄÄ/ 0
=>
ÄÄ1 3
OnClear
ÄÄ4 ;
-=
ÄÄ< >
callback
ÄÄ? G
)
ÄÄG H
;
ÄÄH I
observer
ÅÅ 
.
ÅÅ 
Disposables
ÅÅ 
.
ÅÅ 
Add
ÅÅ  
(
ÅÅ  !

disposable
ÅÅ! +
)
ÅÅ+ ,
;
ÅÅ, -
return
ÆÆ 

disposable
ÆÆ 
;
ÆÆ 
}
ÇÇ 
public
ÉÉ 

IDisposable
ÉÉ  
ObserveBeforeClear
ÉÉ )
(
ÉÉ) *

LeafDomain
ÉÉ* 4
observer
ÉÉ5 =
,
ÉÉ= >
Action
ÉÉ? E
callback
ÉÉF N
)
ÉÉN O
{
ÊÊ 
OnBeforeClear
ËË 
+=
ËË 
callback
ËË !
;
ËË! "
var
ÌÌ 

disposable
ÌÌ 
=
ÌÌ 
new
ÌÌ 
ActionDisposable
ÌÌ -
(
ÌÌ- .
(
ÌÌ. /
)
ÌÌ/ 0
=>
ÌÌ1 3
OnBeforeClear
ÌÌ4 A
-=
ÌÌB D
callback
ÌÌE M
)
ÌÌM N
;
ÌÌN O
observer
ÍÍ 
.
ÍÍ 
Disposables
ÍÍ 
.
ÍÍ 
Add
ÍÍ  
(
ÍÍ  !

disposable
ÍÍ! +
)
ÍÍ+ ,
;
ÍÍ, -
return
ÎÎ 

disposable
ÎÎ 
;
ÎÎ 
}
ÏÏ 
public
ÑÑ 

IDisposable
ÑÑ 
ObserveSort
ÑÑ "
(
ÑÑ" #

LeafDomain
ÑÑ# -
observer
ÑÑ. 6
,
ÑÑ6 7
Action
ÑÑ8 >
callback
ÑÑ? G
)
ÑÑG H
{
ÒÒ 
OnSort
ÓÓ 
+=
ÓÓ 
callback
ÓÓ 
;
ÓÓ 
var
ÔÔ 

disposable
ÔÔ 
=
ÔÔ 
new
ÔÔ 
ActionDisposable
ÔÔ -
(
ÔÔ- .
(
ÔÔ. /
)
ÔÔ/ 0
=>
ÔÔ1 3
OnSort
ÔÔ4 :
-=
ÔÔ; =
callback
ÔÔ> F
)
ÔÔF G
;
ÔÔG H
observer
ÕÕ 
.
ÕÕ 
Disposables
ÕÕ 
.
ÕÕ 
Add
ÕÕ  
(
ÕÕ  !

disposable
ÕÕ! +
)
ÕÕ+ ,
;
ÕÕ, -
return
ÖÖ 

disposable
ÖÖ 
;
ÖÖ 
}
×× 
public
ÜÜ 

IDisposable
ÜÜ !
ObserveItemPresence
ÜÜ *
(
ÜÜ* +

LeafDomain
ÜÜ+ 5
observer
ÜÜ6 >
,
ÜÜ> ?
TValue
ÜÜ@ F
item
ÜÜG K
,
ÜÜK L
Action
ÜÜM S
?
ÜÜS T
onAdded
ÜÜU \
=
ÜÜ] ^
null
ÜÜ_ c
,
ÜÜc d
Action
ÜÜe k
?
ÜÜk l
	onRemoved
ÜÜm v
=
ÜÜw x
null
ÜÜy }
)
ÜÜ} ~
{
ÝÝ 
var
ÞÞ 
disposables
ÞÞ 
=
ÞÞ 
new
ÞÞ !
CompositeDisposable
ÞÞ 1
(
ÞÞ1 2
)
ÞÞ2 3
;
ÞÞ3 4
if
àà 

(
àà 
onAdded
àà 
!=
àà 
null
àà 
)
àà 
{
áá 	
Action
ââ 
<
ââ 
ListAddEventArgs
ââ #
<
ââ# $
TValue
ââ$ *
>
ââ* +
>
ââ+ ,
addCallback
ââ- 8
=
ââ9 :
e
ââ; <
=>
ââ= ?
{
ãã 
if
ää 
(
ää 
EqualityComparer
ää $
<
ää$ %
TValue
ää% +
>
ää+ ,
.
ää, -
Default
ää- 4
.
ää4 5
Equals
ää5 ;
(
ää; <
e
ää< =
.
ää= >
Item
ää> B
,
ääB C
item
ääD H
)
ääH I
)
ääI J
onAdded
åå 
(
åå 
)
åå 
;
åå 
}
ææ 
;
ææ 
OnAdd
çç 
+=
çç 
addCallback
çç  
;
çç  !
disposables
èè 
.
èè 
Add
èè 
(
èè 
new
èè 
ActionDisposable
èè  0
(
èè0 1
(
èè1 2
)
èè2 3
=>
èè4 6
OnAdd
èè7 <
-=
èè= ?
addCallback
èè@ K
)
èèK L
)
èèL M
;
èèM N
}
éé 	
if
ëë 

(
ëë 
	onRemoved
ëë 
!=
ëë 
null
ëë 
)
ëë 
{
ìì 	
Action
íí 
<
íí !
ListRemoveEventArgs
íí &
<
íí& '
TValue
íí' -
>
íí- .
>
íí. /
removeCallback
íí0 >
=
íí? @
e
ííA B
=>
ííC E
{
îî 
if
ïï 
(
ïï 
EqualityComparer
ïï $
<
ïï$ %
TValue
ïï% +
>
ïï+ ,
.
ïï, -
Default
ïï- 4
.
ïï4 5
Equals
ïï5 ;
(
ïï; <
e
ïï< =
.
ïï= >
Item
ïï> B
,
ïïB C
item
ïïD H
)
ïïH I
)
ïïI J
	onRemoved
ðð 
(
ðð 
)
ðð 
;
ðð  
}
ññ 
;
ññ 
OnRemove
òò 
+=
òò 
removeCallback
òò &
;
òò& '
disposables
óó 
.
óó 
Add
óó 
(
óó 
new
óó 
ActionDisposable
óó  0
(
óó0 1
(
óó1 2
)
óó2 3
=>
óó4 6
OnRemove
óó7 ?
-=
óó@ B
removeCallback
óóC Q
)
óóQ R
)
óóR S
;
óóS T
}
ôô 	
observer
öö 
.
öö 
Disposables
öö 
.
öö 
Add
öö  
(
öö  !
disposables
öö! ,
)
öö, -
;
öö- .
return
÷÷ 
disposables
÷÷ 
;
÷÷ 
}
øø 
}ùù ý
w/Users/a1/Documents/GitHub/turn-based-prototype/Server/Framework/Deterministic.GameFramework.Core/GlobalSuppressions.cs
[ 
assembly 	
:	 

SuppressMessage 
( 
$str (
,( )
$str* T
,T U
Justification 
= 
$str L
,L M
Scope 	
=
 
$str %
,% &
Target		 

=		 
$str		 =
)		= >
]		> ?
[ 
assembly 	
:	 

SuppressMessage 
( 
$str (
,( )
$str* V
,V W
Justification 
= 
$str L
,L M
Scope 	
=
 
$str %
,% &
Target 

= 
$str =
)= >
]> ?
[ 
assembly 	
:	 

SuppressMessage 
( 
$str (
,( )
$str* b
,b c
Justification 
= 
$str L
,L M
Scope 	
=
 
$str %
,% &
Target 

= 
$str =
)= >
]> ?
[ 
assembly 	
:	 

SuppressMessage 
( 
$str (
,( )
$str* e
,e f
Justification 
= 
$str L
,L M
Scope 	
=
 
$str %
,% &
Target 

= 
$str =
)= >
]> ?¨#
|/Users/a1/Documents/GitHub/turn-based-prototype/Server/Framework/Deterministic.GameFramework.Core/Core/Reactions/Reaction.cs
	namespace 	
Deterministic
 
. 
GameFramework %
.% &
Core& *
;* +
[ 
MustDisposeResource 
] 
public 
abstract 
class 
Reaction 
:  
	IReaction! *
{ 
public 


LeafDomain 
Target 
{ 
get "
;" #
private$ +
set, /
;/ 0
}1 2
private 
IHasPrepareReaction 
?  
_prepare! )
;) *
private 
IHasAbortReaction 
? 
_abort %
;% &
private 
IHasBeforeReaction 
? 
_before  '
;' (
private 
IHasAfterReaction 
? 
_after %
;% &
	protected 
Reaction 
( 

LeafDomain !
target" (
)( )
{ 
Target 
= 
target 
; 
_prepare 
= 
this 
as 
IHasPrepareReaction .
;. /
_abort 
= 
this 
as 
IHasAbortReaction *
;* +
_before 
= 
this 
as 
IHasBeforeReaction ,
;, -
_after 
= 
this 
as 
IHasAfterReaction *
;* +
if   

(   
_prepare   
!=   
null   
)   
Target!! 
?!! 
.!! 
PrepareReactions!! $
.!!$ %
Add!!% (
(!!( )
_prepare!!) 1
)!!1 2
;!!2 3
if"" 

("" 
_abort"" 
!="" 
null"" 
)"" 
Target## 
?## 
.## 
AbortReactions## "
.##" #
Add### &
(##& '
_abort##' -
)##- .
;##. /
if$$ 

($$ 
_before$$ 
!=$$ 
null$$ 
)$$ 
Target%% 
?%% 
.%% 
BeforeReactions%% #
.%%# $
Add%%$ '
(%%' (
_before%%( /
)%%/ 0
;%%0 1
if&& 

(&& 
_after&& 
!=&& 
null&& 
)&& 
Target'' 
?'' 
.'' 
AfterReactions'' "
.''" #
Add''# &
(''& '
_after''' -
)''- .
;''. /
}(( 
public** 

void** 
Dispose** 
(** 
)** 
{++ 
if,, 

(,, 
Target,, 
==,, 
null,, 
),, 
return,, "
;,," #
RemoveFromTarget.. 
(.. 
).. 
;.. 
Target// 
=// 
null// 
;// 
}00 
private22 
void22 
RemoveFromTarget22 !
(22! "
)22" #
{33 
Target44 
?44 
.44 
PrepareReactions44  
.44  !
Remove44! '
(44' (
_prepare44( 0
)440 1
;441 2
Target55 
?55 
.55 
AbortReactions55 
.55 
Remove55 %
(55% &
_abort55& ,
)55, -
;55- .
Target66 
?66 
.66 
BeforeReactions66 
.66  
Remove66  &
(66& '
_before66' .
)66. /
;66/ 0
Target77 
?77 
.77 
AfterReactions77 
.77 
Remove77 %
(77% &
_after77& ,
)77, -
;77- .
}88 
[:: #
HandlesResourceDisposal:: 
]:: 
public;; 

Reaction;; 
AddTo;; 
(;; 
CompositeDisposable;; -
disposables;;. 9
);;9 :
{<< 
disposables== 
.== 
Add== 
(== 
this== 
)== 
;== 
return>> 
this>> 
;>> 
}?? 
}@@ õ
}/Users/a1/Documents/GitHub/turn-based-prototype/Server/Framework/Deterministic.GameFramework.Core/Core/Reactions/IReaction.cs
	namespace 	
Deterministic
 
. 
GameFramework %
.% &
Core& *
;* +
public 
	interface 
	IReaction 
: 
IDisposable (
{		 

LeafDomain

 
Target

 
{

 
get

 
;

 
}

 
} •
„/Users/a1/Documents/GitHub/turn-based-prototype/Server/Framework/Deterministic.GameFramework.Core/Core/Reactions/IPrepareReaction.cs
	namespace 	
Deterministic
 
. 
GameFramework %
.% &
Core& *
;* +
public 
	interface 
IHasPrepareReaction $
:% &
	IReaction' 0
{ 
void 
InvokePrepare	 
( 
IDomain 
domain %
,% &

IDARAction' 1
action2 8
)8 9
;9 :
}		 
public 
	interface 
IPrepareReaction !
<! "
TDomain" )
,) *
TAction+ 2
>2 3
:4 5
IHasPrepareReaction6 I
where 	
TDomain
 
: 
IDomain 
where 	
TAction
 
: 

IDARAction 
{ 
void 
	OnPrepare	 
( 
TDomain 
domain !
,! "
TAction# *
action+ 1
)1 2
;2 3
void 
IHasPrepareReaction	 
. 
InvokePrepare *
(* +
IDomain+ 2
domain3 9
,9 :

IDARAction; E
actionF L
)L M
{ 
if 

( 
action 
is 
TAction 
typedAction )
&&* ,
domain- 3
is4 6
TDomain7 >
typedDomain? J
)J K
{ 	
	OnPrepare 
( 
typedDomain !
,! "
typedAction# .
). /
;/ 0
} 	
} 
} Œ
ƒ/Users/a1/Documents/GitHub/turn-based-prototype/Server/Framework/Deterministic.GameFramework.Core/Core/Reactions/IBeforeReaction.cs
	namespace 	
Deterministic
 
. 
GameFramework %
.% &
Core& *
;* +
public 
	interface 
IHasBeforeReaction #
:$ %
	IReaction& /
{ 
void 
InvokeBefore	 
( 
IDomain 
domain $
,$ %

IDARAction& 0
action1 7
)7 8
;8 9
}		 
public 
	interface 
IBeforeReaction  
<  !
TDomain! (
,( )
TAction* 1
>1 2
:3 4
IHasBeforeReaction5 G
where 	
TDomain
 
: 
IDomain 
where 	
TAction
 
: 

IDARAction 
{ 
void 
OnBefore	 
( 
TDomain 
domain  
,  !
TAction" )
action* 0
)0 1
;1 2
void 
IHasBeforeReaction	 
. 
InvokeBefore (
(( )
IDomain) 0
domain1 7
,7 8

IDARAction9 C
actionD J
)J K
{ 
if 

( 
action 
is 
TAction 
typedAction )
&&* ,
domain- 3
is4 6
TDomain7 >
typedDomain? J
)J K
{ 	
OnBefore 
( 
typedDomain  
,  !
typedAction" -
)- .
;. /
} 	
} 
} ƒ
‚/Users/a1/Documents/GitHub/turn-based-prototype/Server/Framework/Deterministic.GameFramework.Core/Core/Reactions/IAfterReaction.cs
	namespace 	
Deterministic
 
. 
GameFramework %
.% &
Core& *
;* +
public 
	interface 
IHasAfterReaction "
:# $
	IReaction% .
{ 
void 
InvokeAfter	 
( 
IDomain 
domain #
,# $

IDARAction% /
action0 6
)6 7
;7 8
}		 
public 
	interface 
IAfterReaction 
<  
TDomain  '
,' (
TAction) 0
>0 1
:2 3
IHasAfterReaction4 E
where 	
TDomain
 
: 
IDomain 
where 	
TAction
 
: 

IDARAction 
{ 
void 
OnAfter	 
( 
TDomain 
domain 
,  
TAction! (
action) /
)/ 0
;0 1
void 
IHasAfterReaction	 
. 
InvokeAfter &
(& '
IDomain' .
domain/ 5
,5 6

IDARAction7 A
actionB H
)H I
{ 
if 

( 
action 
is 
TAction 
typedAction )
&&* ,
domain- 3
is4 6
TDomain7 >
typedDomain? J
)J K
{ 	
OnAfter 
( 
typedDomain 
,  
typedAction! ,
), -
;- .
} 	
} 
} Í
‚/Users/a1/Documents/GitHub/turn-based-prototype/Server/Framework/Deterministic.GameFramework.Core/Core/Reactions/IAbortReaction.cs
	namespace 	
Deterministic
 
. 
GameFramework %
.% &
Core& *
;* +
public 
	interface 
IHasAbortReaction "
:# $
	IReaction% .
{ 
bool 
InvokeAbort	 
( 
IDomain 
domain #
,# $

IDARAction% /
action0 6
)6 7
;7 8
} 
public 
	interface 
IAbortReaction 
<  
TDomain  '
,' (
TAction) 0
>0 1
:2 3
IHasAbortReaction4 E
where 	
TDomain
 
: 
IDomain 
where 	
TAction
 
: 

IDARAction 
{ 
bool 
OnAbort	 
( 
TDomain 
domain 
,  
TAction! (
action) /
)/ 0
;0 1
bool 
IHasAbortReaction	 
. 
InvokeAbort &
(& '
IDomain' .
domain/ 5
,5 6

IDARAction7 A
actionB H
)H I
{ 
if 

( 
action 
is 
TAction 
typedAction )
&&* ,
domain- 3
is4 6
TDomain7 >
typedDomain? J
)J K
{ 	
return   
OnAbort   
(   
typedDomain   &
,  & '
typedAction  ( 3
)  3 4
;  4 5
}!! 	
return"" 
false"" 
;"" 
}## 
}$$ €F
„/Users/a1/Documents/GitHub/turn-based-prototype/Server/Framework/Deterministic.GameFramework.Core/Core/Reactions/DelegateReaction.cs
	namespace 	
Deterministic
 
. 
GameFramework %
.% &
Core& *
;* +
[ 
MustDisposeResource 
] 
public 
sealed 
class 
Reaction 
< 
TDomain $
,$ %
TAction& -
>- .
:/ 0
	IReaction1 :
,: ;
IPrepareReaction 
< 
TDomain 
, 
TAction %
>% &
,& '
IAbortReaction 
< 
TDomain 
, 
TAction #
># $
,$ %
IBeforeReaction 
< 
TDomain 
, 
TAction $
>$ %
,% &
IAfterReaction 
< 
TDomain 
, 
TAction #
># $
where 	
TDomain
 
: 

LeafDomain 
where 	
TAction
 
: 

IDARAction 
{ 
private 
Action 
< 
TDomain 
, 
TAction #
># $
?$ %
_prepareCallback& 6
;6 7
private 
Func 
< 
TDomain 
, 
TAction !
,! "
bool# '
>' (
?( )
_abortCallback* 8
;8 9
private 
Action 
< 
TDomain 
, 
TAction #
># $
?$ %
_beforeCallback& 5
;5 6
private 
Action 
< 
TDomain 
, 
TAction #
># $
?$ %
_afterCallback& 4
;4 5
public 


LeafDomain 
Target 
{ 
get "
;" #
private$ +
set, /
;/ 0
}1 2
public 

Reaction 
( 

LeafDomain 
target %
)% &
{ 
Target 
= 
target 
; 
}   
public%% 

Reaction%% 
<%% 
TDomain%% 
,%% 
TAction%% $
>%%$ %
Prepare%%& -
(%%- .
Action%%. 4
<%%4 5
TDomain%%5 <
,%%< =
TAction%%> E
>%%E F
callback%%G O
)%%O P
{&& 
_prepareCallback'' 
='' 
callback'' #
;''# $
Target(( 
.(( 
PrepareReactions(( 
.((  
Add((  #
(((# $
this(($ (
)((( )
;(() *
return)) 
this)) 
;)) 
}** 
public00 

Reaction00 
<00 
TDomain00 
,00 
TAction00 $
>00$ %
Abort00& +
(00+ ,
Func00, 0
<000 1
TDomain001 8
,008 9
TAction00: A
,00A B
bool00C G
>00G H
callback00I Q
)00Q R
{11 
_abortCallback22 
=22 
callback22 !
;22! "
Target33 
.33 
AbortReactions33 
.33 
Add33 !
(33! "
this33" &
)33& '
;33' (
return44 
this44 
;44 
}55 
public:: 

Reaction:: 
<:: 
TDomain:: 
,:: 
TAction:: $
>::$ %
Before::& ,
(::, -
Action::- 3
<::3 4
TDomain::4 ;
,::; <
TAction::= D
>::D E
callback::F N
)::N O
{;; 
_beforeCallback<< 
=<< 
callback<< "
;<<" #
Target== 
.== 
BeforeReactions== 
.== 
Add== "
(==" #
this==# '
)==' (
;==( )
return>> 
this>> 
;>> 
}?? 
publicDD 

ReactionDD 
<DD 
TDomainDD 
,DD 
TActionDD $
>DD$ %
AfterDD& +
(DD+ ,
ActionDD, 2
<DD2 3
TDomainDD3 :
,DD: ;
TActionDD< C
>DDC D
callbackDDE M
)DDM N
{EE 
_afterCallbackFF 
=FF 
callbackFF !
;FF! "
TargetGG 
.GG 
AfterReactionsGG 
.GG 
AddGG !
(GG! "
thisGG" &
)GG& '
;GG' (
returnHH 
thisHH 
;HH 
}II 
voidKK 
IPrepareReactionKK	 
<KK 
TDomainKK !
,KK! "
TActionKK# *
>KK* +
.KK+ ,
	OnPrepareKK, 5
(KK5 6
TDomainKK6 =
domainKK> D
,KKD E
TActionKKF M
actionKKN T
)KKT U
{LL 
_prepareCallbackMM 
?MM 
.MM 
InvokeMM  
(MM  !
domainMM! '
,MM' (
actionMM) /
)MM/ 0
;MM0 1
}NN 
boolPP 
IAbortReactionPP	 
<PP 
TDomainPP 
,PP  
TActionPP! (
>PP( )
.PP) *
OnAbortPP* 1
(PP1 2
TDomainPP2 9
domainPP: @
,PP@ A
TActionPPB I
actionPPJ P
)PPP Q
{QQ 
returnRR 
_abortCallbackRR 
?RR 
.RR 
InvokeRR %
(RR% &
domainRR& ,
,RR, -
actionRR. 4
)RR4 5
??RR6 8
falseRR9 >
;RR> ?
}SS 
voidUU 
IBeforeReactionUU	 
<UU 
TDomainUU  
,UU  !
TActionUU" )
>UU) *
.UU* +
OnBeforeUU+ 3
(UU3 4
TDomainUU4 ;
domainUU< B
,UUB C
TActionUUD K
actionUUL R
)UUR S
{VV 
_beforeCallbackWW 
?WW 
.WW 
InvokeWW 
(WW  
domainWW  &
,WW& '
actionWW( .
)WW. /
;WW/ 0
}XX 
voidZZ 
IAfterReactionZZ	 
<ZZ 
TDomainZZ 
,ZZ  
TActionZZ! (
>ZZ( )
.ZZ) *
OnAfterZZ* 1
(ZZ1 2
TDomainZZ2 9
domainZZ: @
,ZZ@ A
TActionZZB I
actionZZJ P
)ZZP Q
{[[ 
_afterCallback\\ 
?\\ 
.\\ 
Invoke\\ 
(\\ 
domain\\ %
,\\% &
action\\' -
)\\- .
;\\. /
}]] 
public__ 

void__ 
Dispose__ 
(__ 
)__ 
{`` 
ifaa 

(aa 
Targetaa 
==aa 
nullaa 
)aa 
returnaa "
;aa" #
ifcc 

(cc 
_prepareCallbackcc 
!=cc 
nullcc  $
)cc$ %
Targetdd 
.dd 
PrepareReactionsdd #
.dd# $
Removedd$ *
(dd* +
thisdd+ /
)dd/ 0
;dd0 1
ifee 

(ee 
_abortCallbackee 
!=ee 
nullee "
)ee" #
Targetff 
.ff 
AbortReactionsff !
.ff! "
Removeff" (
(ff( )
thisff) -
)ff- .
;ff. /
ifgg 

(gg 
_beforeCallbackgg 
!=gg 
nullgg #
)gg# $
Targethh 
.hh 
BeforeReactionshh "
.hh" #
Removehh# )
(hh) *
thishh* .
)hh. /
;hh/ 0
ifii 

(ii 
_afterCallbackii 
!=ii 
nullii "
)ii" #
Targetjj 
.jj 
AfterReactionsjj !
.jj! "
Removejj" (
(jj( )
thisjj) -
)jj- .
;jj. /
Targetll 
=ll 
nullll 
;ll 
}mm 
[oo #
HandlesResourceDisposaloo 
]oo 
publicpp 

Reactionpp 
<pp 
TDomainpp 
,pp 
TActionpp $
>pp$ %
AddTopp& +
(pp+ ,
CompositeDisposablepp, ?
disposablespp@ K
)ppK L
{qq 
disposablesrr 
.rr 
Addrr 
(rr 
thisrr 
)rr 
;rr 
returnss 
thisss 
;ss 
}tt 
}uu Ž
t/Users/a1/Documents/GitHub/turn-based-prototype/Server/Framework/Deterministic.GameFramework.Core/Core/IProcessor.cs
	namespace 	
Deterministic
 
. 
GameFramework %
.% &
Core& *
;* +
public 
	interface 

IProcessor 
{ 
void		 
Process		 
(		 
float		 
delta		 
)		 
;		 
int 
ProcessOrder 
=> 
$num 
; 
void 
OnProcessorEnabled 
( 
) 
{ 
} 
void 
OnProcessorDisabled 
( 
) 
{ 
} 
} ç3
z/Users/a1/Documents/GitHub/turn-based-prototype/Server/Framework/Deterministic.GameFramework.Core/Core/IdProviderDomain.cs
	namespace 	
Deterministic
 
. 
GameFramework %
.% &
Core& *
;* +
public

 
class

 
IdProviderDomain

 
:

 
BranchDomain

  ,
{ 
private 
readonly 
HashSet 
< 
int  
>  !
_assignedIds" .
=/ 0
new1 4
(4 5
)5 6
;6 7
private 
readonly 
BranchDomain !
_targetDomain" /
;/ 0
private 
int 
_counter 
= 
$num 
; 
public 

Action 
< 
int 
> 
OnIdAssigned #
{$ %
get& )
;) *
set+ .
;. /
}0 1
=2 3
_4 5
=>6 8
{9 :
}; <
;< =
public 

int 
CurrentCounter 
=>  
_counter! )
;) *
public 

IdProviderDomain 
( 
BranchDomain (
targetDomain) 5
)5 6
:7 8
base9 =
(= >
targetDomain> J
)J K
{ 
_targetDomain 
= 
targetDomain $
;$ %
new 
Reaction 
< 

LeafDomain 
,  
AddSubdomainAction! 3
>3 4
(4 5
_targetDomain5 B
)B C
. 
After 
( 
( 
domain 
, 
action "
)" #
=>$ &
{' (+
AssignCounterBasedIdToNewDomain /
(/ 0
action0 6
.6 7
Child7 <
)< =
;= >%
ProcessExistingSubdomains   )
(  ) *
action  * 0
.  0 1
Child  1 6
)  6 7
;  7 8
}!! 
)!! 
."" 
AddTo"" 
("" 
Disposables"" 
)"" 
;""  
}## 
private%% 
void%% +
AssignCounterBasedIdToNewDomain%% 0
(%%0 1

LeafDomain%%1 ;
domain%%< B
)%%B C
{&& 
if(( 

((( 
!(( 
_assignedIds(( 
.(( 
Contains(( "
(((" #
domain((# )
.(() *
Id((* ,
)((, -
)((- .
{)) 	
var** 
oldId** 
=** 
domain** 
.** 
Id** !
;**! "
var++ 
counterBasedId++ 
=++  "
GenerateCounterBasedId++! 7
(++7 8
)++8 9
;++9 :
domain,, 
.,, 
Id,, 
=,, 
counterBasedId,, &
;,,& '
_assignedIds-- 
.-- 
Add-- 
(-- 
counterBasedId-- +
)--+ ,
;--, -
OnIdAssigned.. 
?.. 
... 
Invoke..  
(..  !
counterBasedId..! /
)../ 0
;..0 1
}// 	
}00 
private22 
void22 %
ProcessExistingSubdomains22 *
(22* +

LeafDomain22+ 5
domain226 <
)22< =
{33 
if55 

(55 
domain55 
is55 
BranchDomain55 " 
domainWithSubdomains55# 7
)557 8
{66 	
foreach77 
(77 
var77 
	subdomain77 "
in77# % 
domainWithSubdomains77& :
.77: ;

Subdomains77; E
.77E F
ToList77F L
(77L M
)77M N
)77N O
{88 +
AssignCounterBasedIdToNewDomain99 /
(99/ 0
	subdomain990 9
)999 :
;99: ;%
ProcessExistingSubdomains:: )
(::) *
	subdomain::* 3
)::3 4
;::4 5
};; 
}<< 	
}== 
private?? 
int?? "
GenerateCounterBasedId?? &
(??& '
)??' (
{@@ 
returnAA 
_counterAA 
++AA 
;AA 
}BB 
publicGG 

voidGG &
AssignIdsToExistingDomainsGG *
(GG* +
)GG+ ,
{HH 
varII 
existingDomainsII 
=II 
newII !
ListII" &
<II& '

LeafDomainII' 1
>II1 2
(II2 3
)II3 4
;II4 5%
CollectDomainsRecursivelyJJ !
(JJ! "
_targetDomainJJ" /
,JJ/ 0
existingDomainsJJ1 @
)JJ@ A
;JJA B
existingDomainsMM 
.MM 
SortMM 
(MM 
(MM 
aMM 
,MM  
bMM! "
)MM" #
=>MM$ &
stringMM' -
.MM- .
CompareMM. 5
(MM5 6
aMM6 7
.MM7 8
GetTypeMM8 ?
(MM? @
)MM@ A
.MMA B
NameMMB F
,MMF G
bMMH I
.MMI J
GetTypeMMJ Q
(MMQ R
)MMR S
.MMS T
NameMMT X
,MMX Y
StringComparisonMMZ j
.MMj k
OrdinalMMk r
)MMr s
)MMs t
;MMt u
foreachOO 
(OO 
varOO 
domainOO 
inOO 
existingDomainsOO .
)OO. /
{PP 	+
AssignCounterBasedIdToNewDomainQQ +
(QQ+ ,
domainQQ, 2
)QQ2 3
;QQ3 4
}RR 	
}SS 
privateUU 
voidUU %
CollectDomainsRecursivelyUU *
(UU* +

LeafDomainUU+ 5
domainUU6 <
,UU< =
ListUU> B
<UUB C

LeafDomainUUC M
>UUM N

collectionUUO Y
)UUY Z
{VV 

collectionWW 
.WW 
AddWW 
(WW 
domainWW 
)WW 
;WW 
foreachYY 
(YY 
varYY 
childYY 
inYY 
domainYY $
.YY$ %
GetChildrenYY% 0
(YY0 1
)YY1 2
)YY2 3
{ZZ 	%
CollectDomainsRecursively[[ %
([[% &
child[[& +
,[[+ ,

collection[[- 7
)[[7 8
;[[8 9
}\\ 	
}]] 
}^^ í`
r/Users/a1/Documents/GitHub/turn-based-prototype/Server/Framework/Deterministic.GameFramework.Core/Core/GameLoop.cs
	namespace 	
Deterministic
 
. 
GameFramework %
.% &
Core& *
;* +
public		 
class		 
GameLoop		 
(		 
BranchDomain		 "

rootDomain		# -
)		- .
{

 
private 
readonly	 
ConcurrentQueue !
<! "
Action" (
>( )
_scheduledActions* ;
=< =
new> A
(A B
)B C
;C D
private 
readonly	 
HashSet 
< 

IProcessor $
>$ %
_enabledProcessors& 8
=9 :
new; >
(> ?
)? @
;@ A
private 
bool	 

_isRunning 
; 
private 
readonly	 
	Stopwatch 

_stopwatch &
=' (
new) ,
(, -
)- .
;. /
private 
long	 
_lastFrameTicks 
; 
private 
int	 

_targetFps 
= 
$num 
; 
private 
int	 
_targetFrameTimeMs 
;  
public 
event 
Action 
? 
OnUpdate 
; 
public 
void 
SetTargetFps 
( 
int 
fps !
)! "
{ 

_targetFps 
= 
fps 
; 
_targetFrameTimeMs 
= 
$num 
/ 
fps !
;! "
} 
public   
Task   
Start   
(   
)   
{!! 
return"" 
Task""	 
."" 
Run"" 
("" 
("" 
)"" 
=>"" 
{## 
try$$ 
{%% 

_isRunning&& 
=&& 
true&& 
;&& 
_targetFrameTimeMs'' 
='' 
$num'' 
/'' 

_targetFps''  *
;''* +

_stopwatch)) 
.)) 
Start)) 
()) 
))) 
;)) 
_lastFrameTicks** 
=** 

_stopwatch**  
.**  !
ElapsedTicks**! -
;**- .
Console,, 
.,, 
	WriteLine,, 
(,, 
$",, 
$str,, .
{,,. /

_targetFps,,/ 9
},,9 :
$str,,: >
",,> ?
),,? @
;,,@ A
while.. 	
(..
 

_isRunning.. 
).. 
{// 
try00 
{11 
long33 

currentTicks33 
=33 

_stopwatch33 $
.33$ %
ElapsedTicks33% 1
;331 2
long44 


deltaTicks44 
=44 
currentTicks44 $
-44% &
_lastFrameTicks44' 6
;446 7
float55 
	deltaTime55 
=55 
(55 
float55 
)55 

deltaTicks55 )
/55* +
	Stopwatch55, 5
.555 6
	Frequency556 ?
;55? @
_lastFrameTicks66 
=66 
currentTicks66 $
;66$ %
Update99 
(99 
	deltaTime99 
)99 
;99 
long== 

frameEndTicks== 
=== 

_stopwatch== %
.==% &
ElapsedTicks==& 2
;==2 3
long>> 

frameDurationTicks>> 
=>> 
frameEndTicks>>  -
->>. /
currentTicks>>0 <
;>>< =
int?? 	
frameDurationMs??
 
=?? 
(?? 
int??  
)??  !
(??! "
frameDurationTicks??" 4
*??5 6
$num??7 ;
/??< =
	Stopwatch??> G
.??G H
	Frequency??H Q
)??Q R
;??R S
intBB 	
	sleepTimeBB
 
=BB 
MathBB 
.BB 
MaxBB 
(BB 
$numBB  
,BB  !
_targetFrameTimeMsBB" 4
-BB5 6
frameDurationMsBB7 F
)BBF G
;BBG H
ifCC 
(CC	 

	sleepTimeCC
 
>CC 
$numCC 
)CC 
{DD 
SystemFF 
.FF 
	ThreadingFF 
.FF 
ThreadFF 
.FF 
SleepFF $
(FF$ %
	sleepTimeFF% .
)FF. /
;FF/ 0
}GG 
}HH 
catchII 

(II 
	ExceptionII 
exII 
)II 
{JJ 
ConsoleLL 
.LL 
	WriteLineLL 
(LL 
$"LL 
$strLL E
{LLE F
exLLF H
.LLH I
MessageLLI P
}LLP Q
"LLQ R
)LLR S
;LLS T
ConsoleMM 
.MM 
	WriteLineMM 
(MM 
$"MM 
$strMM 2
{MM2 3
exMM3 5
.MM5 6

StackTraceMM6 @
}MM@ A
"MMA B
)MMB C
;MMC D
}OO 
}PP 
ConsoleRR 
.RR 
	WriteLineRR 
(RR 
$strRR 5
)RR5 6
;RR6 7
}SS 
catchTT 
(TT	 

	ExceptionTT
 
exTT 
)TT 
{UU 
ConsoleWW 
.WW 
	WriteLineWW 
(WW 
$"WW 
$strWW ?
{WW? @
exWW@ B
.WWB C
MessageWWC J
}WWJ K
"WWK L
)WWL M
;WWM N
ConsoleXX 
.XX 
	WriteLineXX 
(XX 
$"XX 
$strXX 0
{XX0 1
exXX1 3
.XX3 4

StackTraceXX4 >
}XX> ?
"XX? @
)XX@ A
;XXA B

_isRunningYY 
=YY 
falseYY 
;YY 
throwZZ 	
;ZZ	 

}[[ 
}\\ 
)\\ 
;\\ 
}]] 
public__ 
void__ 
Stop__ 
(__ 
)__ 
=>__ 

_isRunning__ !
=__" #
false__$ )
;__) *
publicaa 
voidaa 
Scheduleaa 
(aa 
Actionaa 
actionaa #
)aa# $
{bb 
ifcc 
(cc 
!cc 

_isRunningcc 
)cc 
returncc 
;cc 
_scheduledActionsdd 
.dd 
Enqueuedd 
(dd 
actiondd "
)dd" #
;dd# $
}ee 
privategg 
voidgg	 
Updategg 
(gg 
floatgg 
deltagg  
)gg  !
{hh 
whilejj 
(jj 	
_scheduledActionsjj	 
.jj 

TryDequeuejj %
(jj% &
outjj& )
varjj* -
actionjj. 4
)jj4 5
)jj5 6
{kk 
tryll 
{mm 
actionnn 

.nn
 
Invokenn 
(nn 
)nn 
;nn 
}oo 
catchpp 
(pp	 

	Exceptionpp
 
expp 
)pp 
{qq 
Consoless 
.ss 
	WriteLiness 
(ss 
$"ss 
$strss >
{ss> ?
exss? A
.ssA B
MessagessB I
}ssI J
"ssJ K
)ssK L
;ssL M
Consolett 
.tt 
	WriteLinett 
(tt 
$"tt 
$strtt 0
{tt0 1
extt1 3
.tt3 4

StackTracett4 >
}tt> ?
"tt? @
)tt@ A
;ttA B
}uu 
}vv 
tryyy 
{zz 
OnUpdate{{ 
?{{ 
.{{ 
Invoke{{ 
({{ 
){{ 
;{{ 
}|| 
catch}} 
(}} 	
	Exception}}	 
ex}} 
)}} 
{~~ 
Console 

.
 
	WriteLine 
( 
$" 
$str >
{> ?
ex? A
.A B
MessageB I
}I J
"J K
)K L
;L M
Console
€€ 

.
€€
 
	WriteLine
€€ 
(
€€ 
$"
€€ 
$str
€€ /
{
€€/ 0
ex
€€0 2
.
€€2 3

StackTrace
€€3 =
}
€€= >
"
€€> ?
)
€€? @
;
€€@ A
}
 
try
„„ 
{
…… "
ProcessAllProcessors
†† 
(
†† 
delta
†† 
)
†† 
;
†† 
}
‡‡ 
catch
ˆˆ 
(
ˆˆ 	
	Exception
ˆˆ	 
ex
ˆˆ 
)
ˆˆ 
{
‰‰ 
Console
ŠŠ 

.
ŠŠ
 
	WriteLine
ŠŠ 
(
ŠŠ 
$"
ŠŠ 
$str
ŠŠ A
{
ŠŠA B
ex
ŠŠB D
.
ŠŠD E
Message
ŠŠE L
}
ŠŠL M
"
ŠŠM N
)
ŠŠN O
;
ŠŠO P
Console
‹‹ 

.
‹‹
 
	WriteLine
‹‹ 
(
‹‹ 
$"
‹‹ 
$str
‹‹ /
{
‹‹/ 0
ex
‹‹0 2
.
‹‹2 3

StackTrace
‹‹3 =
}
‹‹= >
"
‹‹> ?
)
‹‹? @
;
‹‹@ A
}
ŒŒ 
}
 
private
 
void
	 "
ProcessAllProcessors
 "
(
" #
float
# (
delta
) .
)
. /
{
 
var
““ 
currentList
““ 
=
““ 

rootDomain
““ 
.
““ 
GetAll
““ %
<
““% &

IProcessor
““& 0
>
““0 1
(
““1 2
includeSelf
““2 =
:
““= >
true
““? C
)
““C D
;
““D E
var
”” 
currentProcessors
”” 
=
”” 
new
”” 
HashSet
”” %
<
””% &

IProcessor
””& 0
>
””0 1
(
””1 2
currentList
””2 =
)
””= >
;
””> ?
var
—— 
	toDisable
—— 
=
—— 
new
—— 
List
—— 
<
—— 

IProcessor
—— %
>
——% &
(
——& '
)
——' (
;
——( )
foreach
˜˜ 	
(
˜˜
 
var
˜˜ 
	processor
˜˜ 
in
˜˜  
_enabledProcessors
˜˜ .
)
˜˜. /
{
™™ 
if
šš 
(
šš 
!
šš 
currentProcessors
šš 
.
šš 
Contains
šš "
(
šš" #
	processor
šš# ,
)
šš, -
)
šš- .
{
›› 
	toDisable
œœ 
.
œœ 
Add
œœ 
(
œœ 
	processor
œœ 
)
œœ 
;
œœ 
}
 
}
žž 
foreach
   	
(
  
 
var
   
	processor
   
in
   
	toDisable
   %
)
  % &
{
¡¡  
_enabledProcessors
¢¢ 
.
¢¢ 
Remove
¢¢ 
(
¢¢ 
	processor
¢¢ &
)
¢¢& '
;
¢¢' (
	processor
££ 
.
££ !
OnProcessorDisabled
££  
(
££  !
)
££! "
;
££" #
}
¤¤ 
foreach
§§ 	
(
§§
 
var
§§ 
	processor
§§ 
in
§§ 
currentProcessors
§§ -
)
§§- .
{
¨¨ 
if
©© 
(
©©  
_enabledProcessors
©© 
.
©© 
Add
©© 
(
©© 
	processor
©© '
)
©©' (
)
©©( )
{
ªª 
	processor
«« 
.
««  
OnProcessorEnabled
««  
(
««  !
)
««! "
;
««" #
}
¬¬ 
}
­­ 
foreach
°° 	
(
°°
 
var
°° 
	processor
°° 
in
°° 
currentProcessors
°° -
)
°°- .
{
±± 
	processor
²² 
.
²² 
Process
²² 
(
²² 
delta
²² 
)
²² 
;
²² 
}
³³ 
}
´´ 
}µµ ÁD
y/Users/a1/Documents/GitHub/turn-based-prototype/Server/Framework/Deterministic.GameFramework.Core/Core/ExecutionLogger.cs
	namespace 	
Deterministic
 
. 
GameFramework %
.% &
Core& *
;* +
public 
class 
ExecutionLogger 
{ 
[		 
ThreadStatic		 
]		 
private

 
static

 
ExecutionLogger

 "
?

" #
_current

$ ,
;

, -
public 

static 
ExecutionLogger !
?! "
Current# *
=>+ -
_current. 6
;6 7
private 
readonly 
List 
< 
ExecutionLog &
>& '
_logs( -
=. /
new0 3
(3 4
)4 5
;5 6
private 
int 
_sequenceId 
= 
$num 
;  
public 

IReadOnlyList 
< 
ExecutionLog %
>% &
Logs' +
=>, .
_logs/ 4
;4 5
public 

static 
ExecutionLogger !
BeginLogging" .
(. /
)/ 0
{ 
_current 
= 
new 
ExecutionLogger &
(& '
)' (
;( )
return 
_current 
; 
} 
public 

static 
void 

EndLogging !
(! "
)" #
{ 
_current 
= 
null 
; 
} 
public 

void 
LogActionStart 
( 
string %

actionType& 0
,0 1

LeafDomain2 <
domain= C
)C D
{ 
_logs   
.   
Add   
(   
new   
ExecutionLog   "
{!! 	

SequenceId"" 
="" 
_sequenceId"" $
++""$ &
,""& '
	EventType## 
=## 
ExecutionEventType## *
.##* +
ActionStart##+ 6
,##6 7

ActionType$$ 
=$$ 

actionType$$ #
,$$# $
DomainId%% 
=%% 
domain%% 
.%% 
Id%%  
,%%  !

DomainType&& 
=&& 
domain&& 
.&&  
GetType&&  '
(&&' (
)&&( )
.&&) *
Name&&* .
}'' 	
)''	 

;''
 
}(( 
public** 

void** 
LogPrepareReaction** "
(**" #
string**# )
reactionType*** 6
,**6 7

LeafDomain**8 B
domain**C I
)**I J
{++ 
_logs,, 
.,, 
Add,, 
(,, 
new,, 
ExecutionLog,, "
{-- 	

SequenceId.. 
=.. 
_sequenceId.. $
++..$ &
,..& '
	EventType// 
=// 
ExecutionEventType// *
.//* +
PrepareReaction//+ :
,//: ;
ReactionType00 
=00 
reactionType00 '
,00' (
DomainId11 
=11 
domain11 
.11 
Id11  
,11  !

DomainType22 
=22 
domain22 
.22  
GetType22  '
(22' (
)22( )
.22) *
Name22* .
}33 	
)33	 

;33
 
}44 
public66 

void66 
LogAbortReaction66  
(66  !
string66! '
reactionType66( 4
,664 5

LeafDomain666 @
domain66A G
)66G H
{77 
_logs88 
.88 
Add88 
(88 
new88 
ExecutionLog88 "
{99 	

SequenceId:: 
=:: 
_sequenceId:: $
++::$ &
,::& '
	EventType;; 
=;; 
ExecutionEventType;; *
.;;* +
AbortReaction;;+ 8
,;;8 9
ReactionType<< 
=<< 
reactionType<< '
,<<' (
DomainId== 
=== 
domain== 
.== 
Id==  
,==  !

DomainType>> 
=>> 
domain>> 
.>>  
GetType>>  '
(>>' (
)>>( )
.>>) *
Name>>* .
}?? 	
)??	 

;??
 
}@@ 
publicBB 

voidBB 
LogBeforeReactionBB !
(BB! "
stringBB" (
reactionTypeBB) 5
,BB5 6

LeafDomainBB7 A
domainBBB H
)BBH I
{CC 
_logsDD 
.DD 
AddDD 
(DD 
newDD 
ExecutionLogDD "
{EE 	

SequenceIdFF 
=FF 
_sequenceIdFF $
++FF$ &
,FF& '
	EventTypeGG 
=GG 
ExecutionEventTypeGG *
.GG* +
BeforeReactionGG+ 9
,GG9 :
ReactionTypeHH 
=HH 
reactionTypeHH '
,HH' (
DomainIdII 
=II 
domainII 
.II 
IdII  
,II  !

DomainTypeJJ 
=JJ 
domainJJ 
.JJ  
GetTypeJJ  '
(JJ' (
)JJ( )
.JJ) *
NameJJ* .
}KK 	
)KK	 

;KK
 
}LL 
publicNN 

voidNN 
LogActionExecuteNN  
(NN  !
stringNN! '

actionTypeNN( 2
,NN2 3

LeafDomainNN4 >
domainNN? E
)NNE F
{OO 
_logsPP 
.PP 
AddPP 
(PP 
newPP 
ExecutionLogPP "
{QQ 	

SequenceIdRR 
=RR 
_sequenceIdRR $
++RR$ &
,RR& '
	EventTypeSS 
=SS 
ExecutionEventTypeSS *
.SS* +
ActionExecuteSS+ 8
,SS8 9

ActionTypeTT 
=TT 

actionTypeTT #
,TT# $
DomainIdUU 
=UU 
domainUU 
.UU 
IdUU  
,UU  !

DomainTypeVV 
=VV 
domainVV 
.VV  
GetTypeVV  '
(VV' (
)VV( )
.VV) *
NameVV* .
}WW 	
)WW	 

;WW
 
}XX 
publicZZ 

voidZZ 
LogAfterReactionZZ  
(ZZ  !
stringZZ! '
reactionTypeZZ( 4
,ZZ4 5

LeafDomainZZ6 @
domainZZA G
)ZZG H
{[[ 
_logs\\ 
.\\ 
Add\\ 
(\\ 
new\\ 
ExecutionLog\\ "
{]] 	

SequenceId^^ 
=^^ 
_sequenceId^^ $
++^^$ &
,^^& '
	EventType__ 
=__ 
ExecutionEventType__ *
.__* +
AfterReaction__+ 8
,__8 9
ReactionType`` 
=`` 
reactionType`` '
,``' (
DomainIdaa 
=aa 
domainaa 
.aa 
Idaa  
,aa  !

DomainTypebb 
=bb 
domainbb 
.bb  
GetTypebb  '
(bb' (
)bb( )
.bb) *
Namebb* .
}cc 	
)cc	 

;cc
 
}dd 
publicff 

voidff 
LogActionEndff 
(ff 
stringff #

actionTypeff$ .
,ff. /

LeafDomainff0 :
domainff; A
)ffA B
{gg 
_logshh 
.hh 
Addhh 
(hh 
newhh 
ExecutionLoghh "
{ii 	

SequenceIdjj 
=jj 
_sequenceIdjj $
++jj$ &
,jj& '
	EventTypekk 
=kk 
ExecutionEventTypekk *
.kk* +
	ActionEndkk+ 4
,kk4 5

ActionTypell 
=ll 

actionTypell #
,ll# $
DomainIdmm 
=mm 
domainmm 
.mm 
Idmm  
,mm  !

DomainTypenn 
=nn 
domainnn 
.nn  
GetTypenn  '
(nn' (
)nn( )
.nn) *
Namenn* .
}oo 	
)oo	 

;oo
 
}pp 
publicrr 

voidrr 
Clearrr 
(rr 
)rr 
{ss 
_logstt 
.tt 
Cleartt 
(tt 
)tt 
;tt 
_sequenceIduu 
=uu 
$numuu 
;uu 
}vv 
}ww ¦/
v/Users/a1/Documents/GitHub/turn-based-prototype/Server/Framework/Deterministic.GameFramework.Core/Core/ExecutionLog.cs
	namespace 	
Deterministic
 
. 
GameFramework %
.% &
Core& *
;* +
public 
class 
ExecutionLog 
{ 
public 

int 

SequenceId 
{ 
get 
;  
set! $
;$ %
}& '
public		 

ExecutionEventType		 
	EventType		 '
{		( )
get		* -
;		- .
set		/ 2
;		2 3
}		4 5
public

 

string

 

ActionType

 
{

 
get

 "
;

" #
set

$ '
;

' (
}

) *
=

+ ,
$str

- /
;

/ 0
public 

string 
ReactionType 
{  
get! $
;$ %
set& )
;) *
}+ ,
=- .
$str/ 1
;1 2
public 

int 
DomainId 
{ 
get 
; 
set "
;" #
}$ %
public 

string 

DomainType 
{ 
get "
;" #
set$ '
;' (
}) *
=+ ,
$str- /
;/ 0
public 

override 
string 
ToString #
(# $
)$ %
{ 
return 
	EventType 
switch 
{ 	
ExecutionEventType 
. 
ActionStart *
=>+ -
$". 0
$str0 1
{1 2

SequenceId2 <
}< =
$str= M
{M N

ActionTypeN X
}X Y
$strY ]
{] ^

DomainType^ h
}h i
$stri j
{j k
DomainIdk s
}s t
$strt u
"u v
,v w
ExecutionEventType 
. 
PrepareReaction .
=>/ 1
$"2 4
$str4 5
{5 6

SequenceId6 @
}@ A
$strA L
{L M
ReactionTypeM Y
}Y Z
$strZ ^
{^ _

DomainType_ i
}i j
$strj k
{k l
DomainIdl t
}t u
$stru v
"v w
,w x
ExecutionEventType 
. 
AbortReaction ,
=>- /
$"0 2
$str2 3
{3 4

SequenceId4 >
}> ?
$str? H
{H I
ReactionTypeI U
}U V
$strV Z
{Z [

DomainType[ e
}e f
$strf g
{g h
DomainIdh p
}p q
$strq r
"r s
,s t
ExecutionEventType 
. 
BeforeReaction -
=>. 0
$"1 3
$str3 4
{4 5

SequenceId5 ?
}? @
$str@ J
{J K
ReactionTypeK W
}W X
$strX \
{\ ]

DomainType] g
}g h
$strh i
{i j
DomainIdj r
}r s
$strs t
"t u
,u v
ExecutionEventType 
. 
ActionExecute ,
=>- /
$"0 2
$str2 3
{3 4

SequenceId4 >
}> ?
$str? Q
{Q R

ActionTypeR \
}\ ]
$str] a
{a b

DomainTypeb l
}l m
$strm n
{n o
DomainIdo w
}w x
$strx y
"y z
,z {
ExecutionEventType 
. 
AfterReaction ,
=>- /
$"0 2
$str2 3
{3 4

SequenceId4 >
}> ?
$str? H
{H I
ReactionTypeI U
}U V
$strV Z
{Z [

DomainType[ e
}e f
$strf g
{g h
DomainIdh p
}p q
$strq r
"r s
,s t
ExecutionEventType 
. 
	ActionEnd (
=>) +
$", .
$str. /
{/ 0

SequenceId0 :
}: ;
$str; I
{I J

ActionTypeJ T
}T U
$strU Y
{Y Z

DomainTypeZ d
}d e
$stre f
{f g
DomainIdg o
}o p
$strp q
"q r
,r s
_ 
=> 
$" 
$str 
{ 

SequenceId 
}  
$str  )
") *
} 	
;	 

} 
public 

bool 
Matches 
( 
ExecutionLog $
other% *
)* +
{ 
return   
	EventType   
==   
other   !
.  ! "
	EventType  " +
&&!! 

ActionType!! 
==!! 
other!! "
.!!" #

ActionType!!# -
&&"" 
ReactionType"" 
=="" 
other"" $
.""$ %
ReactionType""% 1
&&## 
DomainId## 
==## 
other##  
.##  !
DomainId##! )
&&$$ 

DomainType$$ 
==$$ 
other$$ "
.$$" #

DomainType$$# -
;$$- .
}%% 
}&& 
public(( 
enum(( 
ExecutionEventType(( 
{)) 
ActionStart** 
,** 
PrepareReaction++ 
,++ 
AbortReaction,, 
,,, 
BeforeReaction-- 
,-- 
ActionExecute.. 
,.. 
AfterReaction// 
,// 
	ActionEnd00 
}11 ã
{/Users/a1/Documents/GitHub/turn-based-prototype/Server/Framework/Deterministic.GameFramework.Core/Core/Domain/RootDomain.cs
	namespace 	
Deterministic
 
. 
GameFramework %
.% &
Core& *
.* +
Domain+ 1
;1 2
public 
class 

RootDomain 
: 
BranchDomain &
{ 
public 


RootDomain 
( 
) 
: 
base 
( 
null #
)# $
{ 
} 
} ˆl
{/Users/a1/Documents/GitHub/turn-based-prototype/Server/Framework/Deterministic.GameFramework.Core/Core/Domain/LeafDomain.cs
public		 
class		 

LeafDomain		 
:		 
IDomain		 !
,		! "
IDisposable		# .
,		. /
INode		0 5
<		5 6

LeafDomain		6 @
>		@ A
,		A B
ICacheInvalidatable		C V
{

 
public 
int 
Id 
{ 
get 
; 
set 
; 
} 
	protected 

internal 

LeafDomain 
? 
_parentDomain  -
;- .
public 
readonly 
CompositeDisposable $
Disposables% 0
=1 2
new3 6
(6 7
)7 8
;8 9
private 
bool	 
	_disposed 
= 
false 
;  
	protected 

internal 
readonly 
TreeCacheManager -
<- .

LeafDomain. 8
>8 9
CacheManager: F
;F G
public 
readonly 

CachedList 
< 

LeafDomain &
,& '
IHasPrepareReaction( ;
>; <
PrepareReactions= M
;M N
public 
readonly 

CachedList 
< 

LeafDomain &
,& '
IHasAbortReaction( 9
>9 :
AbortReactions; I
;I J
public 
readonly 

CachedList 
< 

LeafDomain &
,& '
IHasBeforeReaction( :
>: ;
BeforeReactions< K
;K L
public 
readonly 

CachedList 
< 

LeafDomain &
,& '
IHasAfterReaction( 9
>9 :
AfterReactions; I
;I J
public 

LeafDomain 
( 
BranchDomain 
?  
parent! '
)' (
{ 
CacheManager 
= 
new 
TreeCacheManager %
<% &

LeafDomain& 0
>0 1
(1 2
this2 6
)6 7
;7 8
PrepareReactions"" 
="" 
new"" 

CachedList"" #
<""# $

LeafDomain""$ .
,"". /
IHasPrepareReaction""0 C
>""C D
(""D E
this## 
,## 
node$$ 
=>$$ 

node$$ 
.$$ 
PrepareReactions$$  
.$$  !
GetLocalItems$$! .
($$. /
)$$/ 0
,$$0 1
(%% 
)%% 
=>%% 
CacheManager%%	 
.%% "
InvalidateAllRecursive%% ,
(%%, -
)%%- .
)&& 
;&& 
AbortReactions'' 
='' 
new'' 

CachedList'' !
<''! "

LeafDomain''" ,
,'', -
IHasAbortReaction''. ?
>''? @
(''@ A
this(( 
,(( 
node)) 
=>)) 

node)) 
.)) 
AbortReactions)) 
.)) 
GetLocalItems)) ,
()), -
)))- .
,)). /
(** 
)** 
=>** 
CacheManager**	 
.** "
InvalidateAllRecursive** ,
(**, -
)**- .
)++ 
;++ 
BeforeReactions,, 
=,, 
new,, 

CachedList,, "
<,," #

LeafDomain,,# -
,,,- .
IHasBeforeReaction,,/ A
>,,A B
(,,B C
this-- 
,-- 
node.. 
=>.. 

node.. 
... 
BeforeReactions.. 
...  
GetLocalItems..  -
(..- .
)... /
,../ 0
(// 
)// 
=>// 
CacheManager//	 
.// "
InvalidateAllRecursive// ,
(//, -
)//- .
)00 
;00 
AfterReactions11 
=11 
new11 

CachedList11 !
<11! "

LeafDomain11" ,
,11, -
IHasAfterReaction11. ?
>11? @
(11@ A
this22 
,22 
node33 
=>33 

node33 
.33 
AfterReactions33 
.33 
GetLocalItems33 ,
(33, -
)33- .
,33. /
(44 
)44 
=>44 
CacheManager44	 
.44 "
InvalidateAllRecursive44 ,
(44, -
)44- .
)55 
;55 
CacheManager88 
.88 !
RegisterInvalidatable88 $
(88$ %
PrepareReactions88% 5
.885 6

Invalidate886 @
)88@ A
;88A B
CacheManager99 
.99 !
RegisterInvalidatable99 $
(99$ %
AbortReactions99% 3
.993 4

Invalidate994 >
)99> ?
;99? @
CacheManager:: 
.:: !
RegisterInvalidatable:: $
(::$ %
BeforeReactions::% 4
.::4 5

Invalidate::5 ?
)::? @
;::@ A
CacheManager;; 
.;; !
RegisterInvalidatable;; $
(;;$ %
AfterReactions;;% 3
.;;3 4

Invalidate;;4 >
);;> ?
;;;? @
parent== 
?== 	
.==	 


Subdomains==
 
.== 
Add== 
(== 
this== 
)== 
;== 
}>> 
publicCC 

LeafDomainCC 
?CC 
NodeGetParentCC !
(CC! "
)CC" #
{DD 
returnEE 
_parentDomainEE	 
;EE 
}FF 
publicII 
BranchDomainII 
?II 
	GetParentII 
(II  
)II  !
{JJ 
returnKK 
_parentDomainKK	 
asKK 
BranchDomainKK &
;KK& '
}LL 
publicNN 
virtualNN 
IEnumerableNN 
<NN 

LeafDomainNN &
>NN& '
GetChildrenNN( 3
(NN3 4
)NN4 5
=>NN6 8

EnumerableNN9 C
.NNC D
EmptyNND I
<NNI J

LeafDomainNNJ T
>NNT U
(NNU V
)NNV W
;NNW X
publicRR 
voidRR 
InvalidateAllCachesRR  
(RR  !
)RR! "
{SS 
CacheManagerTT 
?TT 
.TT "
InvalidateAllRecursiveTT &
(TT& '
)TT' (
;TT( )
}UU 
publicWW 

IDARActionWW 
RevertActionWW 
(WW  

IDARActionWW  *
actionWW+ 1
)WW1 2
{XX 
ifYY 
(YY 
actionYY 
.YY 
IsRevertableYY 
(YY 
thisYY 
)YY 
)YY  
actionZZ 	
.ZZ	 

RevertProcessZZ
 
(ZZ 
thisZZ 
)ZZ 
;ZZ 
return[[ 
action[[	 
;[[ 
}\\ 
public^^ 
void^^ 
CollectPrepareAll^^ 
(^^ 

IDARAction^^ )
action^^* 0
)^^0 1
{__ 
actionaa 
.aa 	
PrepareReactionsaa	 
.aa 
AddRangeaa "
(aa" #
PrepareReactionsaa# 3
)aa3 4
;aa4 5
}bb 
publicdd 
voiddd 
CollectAbortAlldd 
(dd 

IDARActiondd '
actiondd( .
)dd. /
{ee 
actiongg 
.gg 	
AbortReactionsgg	 
.gg 
AddRangegg  
(gg  !
AbortReactionsgg! /
)gg/ 0
;gg0 1
}hh 
publicjj 
voidjj 
CollectBeforeAlljj 
(jj 

IDARActionjj (
actionjj) /
)jj/ 0
{kk 
actionmm 
.mm 	
BeforeReactionsmm	 
.mm 
AddRangemm !
(mm! "
BeforeReactionsmm" 1
)mm1 2
;mm2 3
}nn 
publicpp 
voidpp 
CollectAfterAllpp 
(pp 

IDARActionpp '
actionpp( .
)pp. /
{qq 
actionss 
.ss 	
AfterReactionsss	 
.ss 
AddRangess  
(ss  !
AfterReactionsss! /
)ss/ 0
;ss0 1
}tt 
publicvv 
intvv !
GetTotalReactionCountvv !
(vv! "
)vv" #
{ww 
returnxx 
PrepareReactionsxx	 
.xx 
Countxx 
+xx  !
AbortReactionsxx" 0
.xx0 1
Countxx1 6
+xx7 8
BeforeReactionsxx9 H
.xxH I
CountxxI N
+xxO P
AfterReactionsxxQ _
.xx_ `
Countxx` e
;xxe f
}yy 
public{{ 
bool{{ 
HasReaction{{ 
({{ 
	IReaction{{ "
reaction{{# +
){{+ ,
{|| 
return}} 
PrepareReactions}}	 
.}} 
Contains}} "
(}}" #
reaction}}# +
)}}+ ,
||}}- /
AbortReactions~~	 
.~~ 
Contains~~  
(~~  !
reaction~~! )
)~~) *
||~~+ -
BeforeReactions	 
. 
Contains !
(! "
reaction" *
)* +
||, .
AfterReactions
€€	 
.
€€ 
Contains
€€  
(
€€  !
reaction
€€! )
)
€€) *
;
€€* +
}
 
public
ƒƒ 
void
ƒƒ 
RemoveFromParent
ƒƒ 
(
ƒƒ 
)
ƒƒ 
{
„„ 
	GetParent
…… 
(
…… 
)
…… 
?
…… 
.
…… 

Subdomains
…… 
.
…… 
Remove
……  
(
……  !
this
……! %
)
……% &
;
……& '
}
†† 
public
ˆˆ 
T
ˆˆ 	
?
ˆˆ	 

GetInParent
ˆˆ 
<
ˆˆ 
T
ˆˆ 
>
ˆˆ 
(
ˆˆ 
bool
ˆˆ 
includeSelf
ˆˆ *
=
ˆˆ+ ,
false
ˆˆ- 2
)
ˆˆ2 3
where
ˆˆ4 9
T
ˆˆ: ;
:
ˆˆ< =
class
ˆˆ> C
{
‰‰ 
var
ŠŠ 
current
ŠŠ 
=
ŠŠ 
includeSelf
ŠŠ 
?
ŠŠ 
this
ŠŠ "
:
ŠŠ# $
_parentDomain
ŠŠ% 2
;
ŠŠ2 3
while
ŒŒ 
(
ŒŒ 	
current
ŒŒ	 
!=
ŒŒ 
null
ŒŒ 
)
ŒŒ 
{
 
if
ŽŽ 
(
ŽŽ 
current
ŽŽ 
is
ŽŽ 
T
ŽŽ 
typedDomain
ŽŽ 
)
ŽŽ  
return
 

typedDomain
 
;
 
current
 

=
 
current
 
.
 
_parentDomain
 "
;
" #
}
‘‘ 
return
““ 
null
““	 
;
““ 
}
”” 
public
–– 
virtual
–– 
T
–– 
?
–– 
GetFirst
–– 
<
–– 
T
–– 
>
–– 
(
–– 
bool
–– #
includeSelf
––$ /
=
––0 1
false
––2 7
)
––7 8
where
––9 >
T
––? @
:
––A B
class
––C H
{
—— 
var
˜˜ 
array
˜˜ 
=
˜˜ 
GetAll
˜˜ 
<
˜˜ 
T
˜˜ 
>
˜˜ 
(
˜˜ 
includeSelf
˜˜ #
)
˜˜# $
;
˜˜$ %
return
™™ 
array
™™	 
.
™™ 
Count
™™ 
>
™™ 
$num
™™ 
?
™™ 
array
™™  
[
™™  !
$num
™™! "
]
™™" #
:
™™$ %
null
™™& *
;
™™* +
}
šš 
public
œœ 
virtual
œœ 
List
œœ 
<
œœ 
T
œœ 
>
œœ 
GetAll
œœ 
<
œœ 
T
œœ  
>
œœ  !
(
œœ! "
bool
œœ" &
includeSelf
œœ' 2
=
œœ3 4
false
œœ5 :
,
œœ: ;
bool
œœ< @
	recursive
œœA J
=
œœK L
true
œœM Q
)
œœQ R
where
œœS X
T
œœY Z
:
œœ[ \
class
œœ] b
{
 
var
žž 
result
žž 
=
žž 
new
žž 
List
žž 
<
žž 
T
žž 
>
žž 
(
žž 
)
žž 
;
žž 
if
ŸŸ 
(
ŸŸ 
includeSelf
ŸŸ 
&&
ŸŸ 
this
ŸŸ 
is
ŸŸ 
T
ŸŸ 
	selfTyped
ŸŸ (
)
ŸŸ( )
result
   	
.
  	 

Add
  
 
(
   
	selfTyped
   
)
   
;
   
return
££ 
result
££	 
;
££ 
}
¤¤ 
public
¦¦ 
virtual
¦¦ 
void
¦¦ 
Dispose
¦¦ 
(
¦¦ 
)
¦¦ 
{
§§ 
if
¨¨ 
(
¨¨ 
	_disposed
¨¨ 
)
¨¨ 
return
¨¨ 
;
¨¨ 
RemoveFromParent
ªª 
(
ªª 
)
ªª 
;
ªª 
Disposables
¬¬ 
.
¬¬ 
Dispose
¬¬ 
(
¬¬ 
)
¬¬ 
;
¬¬ 
	_disposed
­­ 
=
­­ 
true
­­ 
;
­­ 
}
®® 
}¯¯ «
x/Users/a1/Documents/GitHub/turn-based-prototype/Server/Framework/Deterministic.GameFramework.Core/Core/Domain/IDomain.cs
public 
	interface 
IDomain 
{ 
T 
? 
GetFirst 
< 
T 
> 
( 
bool 
includeSelf  
=! "
false# (
)( )
where* /
T0 1
:2 3
class4 9
;9 :
List 
< 
T 
> 
GetAll	 
< 
T 
> 
( 
bool 
includeSelf #
=$ %
false& +
,+ ,
bool- 1
	recursive2 ;
=< =
true> B
)B C
whereD I
TJ K
:L M
classN S
;S T
void 
CollectPrepareAll 
( 

IDARAction "
action# )
)) *
;* +
void 
CollectAbortAll 
( 

IDARAction  
action! '
)' (
;( )
void 
CollectBeforeAll 
( 

IDARAction !
action" (
)( )
;) *
void		 
CollectAfterAll		 
(		 

IDARAction		  
action		! '
)		' (
;		( )
}

 ¬
/Users/a1/Documents/GitHub/turn-based-prototype/Server/Framework/Deterministic.GameFramework.Core/Core/Domain/DomainRegistry.cs
	namespace 	
Deterministic
 
. 
GameFramework %
.% &
Core& *
.* +
Domain+ 1
;1 2
public 
class 
DomainRegistry 
: 
BranchDomain *
{ 
private		 
readonly		 
CachedDictionary		 %
<		% &

LeafDomain		& 0
,		0 1
int		2 5
,		5 6

LeafDomain		7 A
>		A B
	_registry		C L
;		L M
private

 
readonly

 
BranchDomain

 !
_root

" '
;

' (
public 

DomainRegistry 
( 
BranchDomain &
root' +
)+ ,
:- .
base/ 3
(3 4
root4 8
)8 9
{ 
_root 
= 
root 
; 
	_registry 
= 
new 
CachedDictionary (
<( )

LeafDomain) 3
,3 4
int5 8
,8 9

LeafDomain: D
>D E
(E F
root 
, 
node 
=> 
new 
[ 
] 
{ 
new 
KeyValuePair  ,
<, -
int- 0
,0 1

LeafDomain2 <
>< =
(= >
node> B
.B C
IdC E
,E F
nodeG K
)K L
}M N
,N O
null 
, 
CacheDirection 
. 
DownToLeaves '
) 	
;	 

CacheManager 
. !
RegisterInvalidatable *
(* +
(+ ,
), -
=>. 0
	_registry1 :
.: ;

Invalidate; E
(E F
)F G
)G H
;H I
} 
public 


LeafDomain 
? 
	GetDomain  
(  !
int! $
id% '
)' (
{ 
if 

( 
id 
== 
$num 
) 
return 
_root 
; 
return   
	_registry   
.   
TryGetValue   $
(  $ %
id  % '
,  ' (
out  ) ,
var  - 0
domain  1 7
)  7 8
?  9 :
domain  ; A
:  B C
null  D H
;  H I
}!! 
public## 

bool## 
TryGetDomain## 
(## 
int##  
id##! #
,### $
out##% (

LeafDomain##) 3
domain##4 :
)##: ;
{$$ 
if%% 

(%% 
id%% 
==%% 
$num%% 
)%% 
{&& 	
domain'' 
='' 
_root'' 
;'' 
return(( 
true(( 
;(( 
})) 	
return** 
	_registry** 
.** 
TryGetValue** $
(**$ %
id**% '
,**' (
out**) ,
domain**- 3
)**3 4
;**4 5
}++ 
},, …l
}/Users/a1/Documents/GitHub/turn-based-prototype/Server/Framework/Deterministic.GameFramework.Core/Core/Domain/BranchDomain.cs
public 
abstract 
class 
BranchDomain "
:# $

LeafDomain% /
{ 
public 
readonly #
ObservableAttributeList (
<( )

LeafDomain) 3
>3 4

Subdomains5 ?
=@ A
newB E
(E F
)F G
;G H
public 
BranchDomain 
( 
BranchDomain !
?! "
parent# )
)) *
:+ ,
base- 1
(1 2
parent2 8
)8 9
{ 

Subdomains 
. 

ObserveAdd 
( 
this 
, 
e 
=>  "
{ 
e 
. 
Item 	
.	 

_parentDomain
 
= 
this 
; 
CacheManager 
? 
. "
InvalidateAllRecursive '
(' (
)( )
;) *
new 
AddSubdomainAction 
( 
this 
, 
e  !
.! "
Item" &
)& '
.' (
Execute( /
(/ 0
this0 4
)4 5
;5 6
} 
) 
; 

Subdomains 
. 
ObserveRemove 
( 
this 
,  
e! "
=># %
{ 
e   
.   
Item   	
.  	 

_parentDomain  
 
=   
null   
;   
CacheManager!! 
?!! 
.!! "
InvalidateAllRecursive!! '
(!!' (
)!!( )
;!!) *
new"" !
RemoveSubdomainAction"" 
("" 
this"" !
,""! "
e""# $
.""$ %
Item""% )
)"") *
.""* +
Execute""+ 2
(""2 3
this""3 7
)""7 8
;""8 9
}## 
)## 
;## 

Subdomains&& 
.&& 
ObserveBeforeClear&& 
(&&  
this&&  $
,&&$ %
(&&& '
)&&' (
=>&&) +
{'' 
foreach(( 

((( 
var(( 
	subdomain(( 
in(( 

Subdomains(( '
)((' (
	subdomain)) 
.)) 
_parentDomain)) 
=)) 
null)) "
;))" #
}** 
)** 
;** 

Subdomains-- 
.-- 
ObserveClear-- 
(-- 
this-- 
,-- 
(--  !
)--! "
=>--# %
{.. 
CacheManager// 
?// 
.// "
InvalidateAllRecursive// '
(//' (
)//( )
;//) *
}00 
)00 
;00 
}11 
public44 
override44 
IEnumerable44 
<44 

LeafDomain44 '
>44' (
GetChildren44) 4
(444 5
)445 6
=>447 9

Subdomains44: D
;44D E
public99 

LeafDomain99 
GetSubdomain99 
(99  
int99  #
index99$ )
)99) *
{:: 
return;; 

Subdomains;;	 
[;; 
index;; 
];; 
;;; 
}<< 
public>> 
bool>> 
HasSubdomain>> 
(>> 

LeafDomain>> $
domain>>% +
)>>+ ,
{?? 
return@@ 

Subdomains@@	 
.@@ 
Contains@@ 
(@@ 
domain@@ #
)@@# $
;@@$ %
}AA 
publicCC 
overrideCC 
TCC 
?CC 
GetFirstCC 
<CC 
TCC 
>CC 
(CC  
boolCC  $
includeSelfCC% 0
=CC1 2
falseCC3 8
)CC8 9
whereCC: ?
TCC@ A
:CCB C
classCCD I
{DD 
varEE 

subdomainsEE 
=EE 

SubdomainsEE 
;EE 
foreachGG 	
(GG
 
varGG 
	subdomainGG 
inGG 

subdomainsGG &
)GG& '
{HH 
ifII 
(II 
	subdomainII 
isII 
TII 
typedDomainII !
)II! "
returnJJ 

typedDomainJJ 
;JJ 
}KK 
ifMM 
(MM 
includeSelfMM 
&&MM 
thisMM 
isMM 
TMM 
	selfTypedMM (
)MM( )
returnNN 	
	selfTypedNN
 
;NN 
foreachQQ 	
(QQ
 
varQQ 
	subdomainQQ 
inQQ 

subdomainsQQ &
)QQ& '
{RR 
ifSS 
(SS 
	subdomainSS 
isSS 
BranchDomainSS  
domainSubdomainSS! 0
)SS0 1
{TT 
varUU 
resultUU 
=UU 
domainSubdomainUU  
.UU  !
GetFirstUU! )
<UU) *
TUU* +
>UU+ ,
(UU, -
)UU- .
;UU. /
ifVV 
(VV 
resultVV 
!=VV 
nullVV 
)VV 
returnWW 
resultWW 
;WW 
}XX 
}YY 
return[[ 
null[[	 
;[[ 
}\\ 
public^^ 
object^^ 
?^^ 
GetFirst^^ 
(^^ 
Type^^ 
type^^ "
,^^" #
bool^^$ (
includeSelf^^) 4
=^^5 6
false^^7 <
,^^< =
bool^^> B
	recursive^^C L
=^^M N
true^^O S
)^^S T
{__ 
var`` 

subdomains`` 
=`` 

Subdomains`` 
;`` 
foreachbb 	
(bb
 
varbb 
	subdomainbb 
inbb 

subdomainsbb &
)bb& '
{cc 
ifdd 
(dd 
typedd 
.dd 
IsInstanceOfTypedd 
(dd 
	subdomaindd &
)dd& '
)dd' (
returnee 

	subdomainee 
;ee 
}ff 
ifhh 
(hh 
includeSelfhh 
&&hh 
typehh 
.hh 
IsInstanceOfTypehh *
(hh* +
thishh+ /
)hh/ 0
)hh0 1
returnii 	
thisii
 
;ii 
ifkk 
(kk 
!kk 
	recursivekk 
)kk 
returnll 	
nullll
 
;ll 
foreachoo 	
(oo
 
varoo 
	subdomainoo 
inoo 

subdomainsoo &
)oo& '
{pp 
ifqq 
(qq 
	subdomainqq 
isqq 
BranchDomainqq  
domainSubdomainqq! 0
)qq0 1
{rr 
varss 
resultss 
=ss 
domainSubdomainss  
.ss  !
GetFirstss! )
(ss) *
typess* .
,ss. /
falsess0 5
,ss5 6
truess7 ;
)ss; <
;ss< =
iftt 
(tt 
resulttt 
!=tt 
nulltt 
)tt 
returnuu 
resultuu 
;uu 
}vv 
}ww 
returnyy 
nullyy	 
;yy 
}zz 
public|| 
override|| 
List|| 
<|| 
T|| 
>|| 
GetAll|| 
<||  
T||  !
>||! "
(||" #
bool||# '
includeSelf||( 3
=||4 5
false||6 ;
,||; <
bool||= A
	recursive||B K
=||L M
true||N R
)||R S
where||T Y
T||Z [
:||\ ]
class||^ c
{}} 
var~~ 

subdomains~~ 
=~~ 

Subdomains~~ 
.~~ 
ToList~~ $
(~~$ %
)~~% &
;~~& '
var 
result 
= 
new 
List 
< 
T 
> 
( 
) 
; 
foreach
 	
(

 
var
 
	subdomain
 
in
 

subdomains
 &
)
& '
{
‚‚ 
if
ƒƒ 
(
ƒƒ 
	subdomain
ƒƒ 
is
ƒƒ 
T
ƒƒ 
typedDomain
ƒƒ !
)
ƒƒ! "
result
„„ 

.
„„
 
Add
„„ 
(
„„ 
typedDomain
„„ 
)
„„ 
;
„„ 
}
…… 
if
‡‡ 
(
‡‡ 
includeSelf
‡‡ 
&&
‡‡ 
this
‡‡ 
is
‡‡ 
T
‡‡ 
	selfTyped
‡‡ (
)
‡‡( )
result
ˆˆ 	
.
ˆˆ	 

Add
ˆˆ
 
(
ˆˆ 
	selfTyped
ˆˆ 
)
ˆˆ 
;
ˆˆ 
if
ŠŠ 
(
ŠŠ 
!
ŠŠ 
	recursive
ŠŠ 
)
ŠŠ 
return
‹‹ 	
result
‹‹
 
;
‹‹ 
foreach
 	
(

 
var
 
	subdomain
 
in
 

subdomains
 &
)
& '
{
ŽŽ 
if
 
(
 
	subdomain
 
is
 
BranchDomain
  
domainSubdomain
! 0
)
0 1
{
 
var
‘‘ 

subResults
‘‘ 
=
‘‘ 
domainSubdomain
‘‘ $
.
‘‘$ %
GetAll
‘‘% +
<
‘‘+ ,
T
‘‘, -
>
‘‘- .
(
‘‘. /
)
‘‘/ 0
;
‘‘0 1
result
’’ 

.
’’
 
AddRange
’’ 
(
’’ 

subResults
’’ 
)
’’ 
;
’’  
}
““ 
}
”” 
return
–– 
result
––	 
;
–– 
}
—— 
public
™™ 
List
™™ 
<
™™ 
object
™™ 
>
™™ 
GetAll
™™ 
(
™™ 
Type
™™  
type
™™! %
,
™™% &
bool
™™' +
includeSelf
™™, 7
=
™™8 9
false
™™: ?
,
™™? @
bool
™™A E
	recursive
™™F O
=
™™P Q
true
™™R V
)
™™V W
{
šš 
var
›› 

subdomains
›› 
=
›› 

Subdomains
›› 
.
›› 
ToList
›› $
(
››$ %
)
››% &
;
››& '
var
œœ 
result
œœ 
=
œœ 
new
œœ 
List
œœ 
<
œœ 
object
œœ 
>
œœ 
(
œœ  
)
œœ  !
;
œœ! "
foreach
žž 	
(
žž
 
var
žž 
	subdomain
žž 
in
žž 

subdomains
žž &
)
žž& '
{
ŸŸ 
if
   
(
   
type
   
.
   
IsInstanceOfType
   
(
   
	subdomain
   &
)
  & '
)
  ' (
result
¡¡ 

.
¡¡
 
Add
¡¡ 
(
¡¡ 
	subdomain
¡¡ 
)
¡¡ 
;
¡¡ 
}
¢¢ 
if
¤¤ 
(
¤¤ 
includeSelf
¤¤ 
&&
¤¤ 
type
¤¤ 
.
¤¤ 
IsInstanceOfType
¤¤ *
(
¤¤* +
this
¤¤+ /
)
¤¤/ 0
)
¤¤0 1
result
¥¥ 	
.
¥¥	 

Add
¥¥
 
(
¥¥ 
this
¥¥ 
)
¥¥ 
;
¥¥ 
if
§§ 
(
§§ 
!
§§ 
	recursive
§§ 
)
§§ 
return
¨¨ 	
result
¨¨
 
;
¨¨ 
foreach
ªª 	
(
ªª
 
var
ªª 
	subdomain
ªª 
in
ªª 

subdomains
ªª &
)
ªª& '
{
«« 
if
¬¬ 
(
¬¬ 
	subdomain
¬¬ 
is
¬¬ 
BranchDomain
¬¬  
domainSubdomain
¬¬! 0
)
¬¬0 1
{
­­ 
var
®® 

subResults
®® 
=
®® 
domainSubdomain
®® $
.
®®$ %
GetAll
®®% +
(
®®+ ,
type
®®, 0
,
®®0 1
false
®®2 7
,
®®7 8
true
®®9 =
)
®®= >
;
®®> ?
result
¯¯ 

.
¯¯
 
AddRange
¯¯ 
(
¯¯ 

subResults
¯¯ 
)
¯¯ 
;
¯¯  
}
°° 
}
±± 
return
³³ 
result
³³	 
;
³³ 
}
´´ 
public
¶¶ 
bool
¶¶ 
IsEmpty
¶¶ 
(
¶¶ 
)
¶¶ 
{
·· 
return
¸¸ 

Subdomains
¸¸	 
.
¸¸ 
Count
¸¸ 
==
¸¸ 
$num
¸¸ 
;
¸¸ 
}
¹¹ 
public
»» 
override
»» 
void
»» 
Dispose
»» 
(
»» 
)
»» 
{
¼¼ 
var
¾¾ 
snapshot
¾¾ 
=
¾¾ 

Subdomains
¾¾ 
.
¾¾ 
ToList
¾¾ "
(
¾¾" #
)
¾¾# $
;
¾¾$ %
foreach
¿¿ 	
(
¿¿
 
var
¿¿ 
	subdomain
¿¿ 
in
¿¿ 
snapshot
¿¿ $
)
¿¿$ %
{
ÀÀ 
	subdomain
ÁÁ 
.
ÁÁ 
Dispose
ÁÁ 
(
ÁÁ 
)
ÁÁ 
;
ÁÁ 
}
ÂÂ 
base
ÄÄ 
.
ÄÄ 
Dispose
ÄÄ 
(
ÄÄ 
)
ÄÄ 
;
ÄÄ 
}
ÅÅ 
}ÆÆ ×w
s/Users/a1/Documents/GitHub/turn-based-prototype/Server/Framework/Deterministic.GameFramework.Core/Core/DARAction.cs
public 
	interface 

IDARAction 
{		 
List

 
<

 
IHasPrepareReaction

 
>

 
PrepareReactions

 +
{

, -
get

. 1
;

1 2
set

3 6
;

6 7
}

8 9
List 
< 
IHasAbortReaction 
> 
AbortReactions '
{( )
get* -
;- .
set/ 2
;2 3
}4 5
List 
< 
IHasBeforeReaction 
> 
BeforeReactions )
{* +
get, /
;/ 0
set1 4
;4 5
}6 7
List 
< 
IHasAfterReaction 
> 
AfterReactions '
{( )
get* -
;- .
set/ 2
;2 3
}4 5
IDomain 
Source	 
{ 
get 
; 
set 
; 
} 
System 
. 
Type 
GetTargetType 
( 
) 
; 
bool 
IsExecutable 
( 
IDomain 
domain !
)! "
;" #
bool 
IsRevertable 
( 
IDomain 
domain !
)! "
;" #
void 
RevertProcess 
( 
IDomain 
domain "
)" #
;# $

IDARAction 
Execute 
( 
IDomain 
domain "
)" #
;# $
string 
GetActionType 
( 
) 
; 
} 
public## 
abstract## 
class## 
	DARAction## 
<##  
TDomain##  '
,##' (
TAction##) 0
>##0 1
:##2 3

IDARAction##4 >
where##? D
TDomain##E L
:##M N
class##O T
,##T U
IDomain##V ]
where##^ c
TAction##d k
:##l m
class##n s
,##s t

IDARAction##u 
{$$ 
[&& 

JsonIgnore&& 
]&& 
public&& 
List&& 
<&& 
IHasPrepareReaction&& -
>&&- .
PrepareReactions&&/ ?
{&&@ A
get&&B E
;&&E F
set&&G J
;&&J K
}&&L M
=&&N O
new&&P S
(&&S T
)&&T U
;&&U V
['' 

JsonIgnore'' 
]'' 
public'' 
List'' 
<'' 
IHasAbortReaction'' +
>''+ ,
AbortReactions''- ;
{''< =
get''> A
;''A B
set''C F
;''F G
}''H I
=''J K
new''L O
(''O P
)''P Q
;''Q R
[(( 

JsonIgnore(( 
](( 
public(( 
List(( 
<(( 
IHasBeforeReaction(( ,
>((, -
BeforeReactions((. =
{((> ?
get((@ C
;((C D
set((E H
;((H I
}((J K
=((L M
new((N Q
(((Q R
)((R S
;((S T
[)) 

JsonIgnore)) 
])) 
public)) 
List)) 
<)) 
IHasAfterReaction)) +
>))+ ,
AfterReactions))- ;
{))< =
get))> A
;))A B
set))C F
;))F G
}))H I
=))J K
new))L O
())O P
)))P Q
;))Q R
[++ 

JsonIgnore++ 
]++ 
public++ 
IDomain++ 
Source++ #
{++$ %
get++& )
;++) *
set+++ .
;++. /
}++0 1
public-- 
System-- 
.-- 
Type-- 
GetTargetType-- !
(--! "
)--" #
=>--$ &
typeof--' -
(--- .
TDomain--. 5
)--5 6
;--6 7
public// 
bool// 
IsExecutable// 
(// 
IDomain// !

domainRoot//" ,
)//, -
{00 
var11 
domain11 
=11 

domainRoot11 
?11 
.11 
GetFirst11 #
<11# $
TDomain11$ +
>11+ ,
(11, -
true11- 1
)111 2
;112 3
if22 
(22 
domain22 
==22 
null22 
)22 
return22 
false22 "
;22" #
var44 
domainInterface44 
=44 
domain44 
as44 !
IDomain44" )
;44) *
if55 
(55 
domainInterface55 
==55 
null55 
)55 
return55 %
false55& +
;55+ ,
PrepareReactions88 
.88 
Clear88 
(88 
)88 
;88 
domainInterface99 
.99 
CollectPrepareAll99 #
(99# $
this99$ (
)99( )
;99) *
foreach<< 	
(<<
 
var<< 
reaction<< 
in<< 
PrepareReactions<< +
)<<+ ,
{== 
ExecutionLogger>> 
.>> 
Current>> 
?>> 
.>> 
LogPrepareReaction>> .
(>>. /
reaction?? 
.?? 
GetType?? 
(?? 
)?? 
.?? 
Name?? 
,?? 
(?? 
domainInterface?? -
as??. 0

LeafDomain??1 ;
)??; <
!??< =
)??= >
;??> ?
reaction@@ 
.@@ 
InvokePrepare@@ 
(@@ 
domainInterface@@ )
,@@) *
this@@+ /
)@@/ 0
;@@0 1
}AA 
AbortReactionsDD 
.DD 
ClearDD 
(DD 
)DD 
;DD 
domainInterfaceEE 
.EE 
CollectAbortAllEE !
(EE! "
thisEE" &
)EE& '
;EE' (
foreachHH 	
(HH
 
varHH 
reactionHH 
inHH 
AbortReactionsHH )
)HH) *
{II 
ExecutionLoggerJJ 
.JJ 
CurrentJJ 
?JJ 
.JJ 
LogAbortReactionJJ ,
(JJ, -
reactionKK 
.KK 
GetTypeKK 
(KK 
)KK 
.KK 
NameKK 
,KK 
(KK 
domainInterfaceKK -
asKK. 0

LeafDomainKK1 ;
)KK; <
!KK< =
)KK= >
;KK> ?
ifLL 
(LL 
reactionLL 
.LL 
InvokeAbortLL 
(LL 
domainInterfaceLL +
,LL+ ,
thisLL- 1
)LL1 2
)LL2 3
{MM 
returnNN 

falseNN 
;NN 
}OO 
}PP 
returnRR 
_IsExecutableRR	 
(RR 
domainRR 
)RR 
;RR 
}SS 
publicUU 
boolUU 
IsRevertableUU 
(UU 
IDomainUU !
domainUU" (
)UU( )
{VV 
varWW 
typedDomainWW 
=WW 
domainWW 
?WW 
.WW 
GetFirstWW $
<WW$ %
TDomainWW% ,
>WW, -
(WW- .
trueWW. 2
)WW2 3
;WW3 4
ifXX 
(XX 
typedDomainXX 
!=XX 
nullXX 
)XX 
{YY 
returnZZ 	
_IsRevertableZZ
 
(ZZ 
typedDomainZZ #
)ZZ# $
;ZZ$ %
}[[ 
return\\ 
false\\	 
;\\ 
}]] 
public__ 
TAction__ 
From__ 
(__ 
IDomain__ 
source__ #
)__# $
{`` 
Sourceaa 
=aa	 

sourceaa 
;aa 
returnbb 
(bb	 

thisbb
 
asbb 
TActionbb 
)bb 
!bb 
;bb 
}cc 
publicee 
virtualee 
TActionee 
Executeee 
(ee  
IDomainee  '

domainRootee( 2
)ee2 3
{ff 
BeforeReactionshh 
.hh 
Clearhh 
(hh 
)hh 
;hh 
AfterReactionsii 
.ii 
Clearii 
(ii 
)ii 
;ii 
varkk 
domainkk 
=kk 

domainRootkk 
?kk 
.kk 
GetFirstkk #
<kk# $
TDomainkk$ +
>kk+ ,
(kk, -
truekk- 1
)kk1 2
;kk2 3
varll 
domainInterfacell 
=ll 
domainll 
asll !
IDomainll" )
;ll) *
ifnn 
(nn 
!nn 
IsExecutablenn 
(nn 

domainRootnn 
)nn 
)nn  
{oo 
returnqq 	
(qq
 
thisqq 
asqq 
TActionqq 
)qq 
!qq 
;qq 
}rr 
ExecutionLoggeruu 
.uu 
Currentuu 
?uu 
.uu 
LogActionStartuu )
(uu) *
GetTypevv 

(vv
 
)vv 
.vv 
Namevv 
,vv 
domainInterfacevv "
asvv# %

LeafDomainvv& 0
)vv0 1
;vv1 2
domainInterfaceyy 
!yy 
.yy 
CollectBeforeAllyy #
(yy# $
thisyy$ (
)yy( )
;yy) *
domainInterfacezz 
.zz 
CollectAfterAllzz !
(zz! "
thiszz" &
)zz& '
;zz' (
foreach}} 	
(}}
 
var}} 
reaction}} 
in}} 
BeforeReactions}} *
)}}* +
{~~ 
ExecutionLogger 
. 
Current 
? 
. 
LogBeforeReaction -
(- .
reaction
€€ 
.
€€ 
GetType
€€ 
(
€€ 
)
€€ 
.
€€ 
Name
€€ 
,
€€ 
domainInterface
€€ ,
as
€€- /

LeafDomain
€€0 :
)
€€: ;
;
€€; <
reaction
 
.
 
InvokeBefore
 
(
 
domainInterface
 (
,
( )
this
* .
)
. /
;
/ 0
}
‚‚ 
ExecutionLogger
…… 
.
…… 
Current
…… 
?
…… 
.
…… 
LogActionExecute
…… +
(
……+ ,
GetType
†† 

(
††
 
)
†† 
.
†† 
Name
†† 
,
†† 
domainInterface
†† "
as
††# %

LeafDomain
††& 0
)
††0 1
;
††1 2
ExecuteProcess
‡‡ 
(
‡‡ 
domain
‡‡ 
!
‡‡ 
)
‡‡ 
;
‡‡ 
foreach
ŠŠ 	
(
ŠŠ
 
var
ŠŠ 
reaction
ŠŠ 
in
ŠŠ 
AfterReactions
ŠŠ )
)
ŠŠ) *
{
‹‹ 
ExecutionLogger
ŒŒ 
.
ŒŒ 
Current
ŒŒ 
?
ŒŒ 
.
ŒŒ 
LogAfterReaction
ŒŒ ,
(
ŒŒ, -
reaction
 
.
 
GetType
 
(
 
)
 
.
 
Name
 
,
 
domainInterface
 .
as
/ 1

LeafDomain
2 <
)
< =
;
= >
reaction
ŽŽ 
.
ŽŽ 
InvokeAfter
ŽŽ 
(
ŽŽ 
domainInterface
ŽŽ '
,
ŽŽ' (
this
ŽŽ) -
)
ŽŽ- .
;
ŽŽ. /
}
 
ExecutionLogger
’’ 
.
’’ 
Current
’’ 
?
’’ 
.
’’ 
LogActionEnd
’’ '
(
’’' (
GetType
““ 

(
““
 
)
““ 
.
““ 
Name
““ 
,
““ 
domainInterface
““ "
as
““# %

LeafDomain
““& 0
)
““0 1
;
““1 2
return
•• 
(
••	 

this
••
 
as
•• 
TAction
•• 
)
•• 
!
•• 
;
•• 
}
–– 
public
˜˜ 
TAction
˜˜ 
Revert
˜˜ 
(
˜˜ 
BranchDomain
˜˜ #
domain
˜˜$ *
)
˜˜* +
{
™™ 
domain
šš 
.
šš 	
RevertAction
šš	 
(
šš 
this
šš 
)
šš 
;
šš 
return
›› 
(
››	 

this
››
 
as
›› 
TAction
›› 
)
›› 
!
›› 
;
›› 
}
œœ 
	protected
žž 

virtual
žž 
bool
žž 
_IsExecutable
žž %
(
žž% &
TDomain
žž& -
domain
žž. 4
)
žž4 5
=>
žž6 8
true
žž9 =
;
žž= >
	protected
ŸŸ 

virtual
ŸŸ 
bool
ŸŸ 
_IsRevertable
ŸŸ %
(
ŸŸ% &
TDomain
ŸŸ& -
domain
ŸŸ. 4
)
ŸŸ4 5
=>
ŸŸ6 8
false
ŸŸ9 >
;
ŸŸ> ?
	protected
¡¡ 

abstract
¡¡ 
void
¡¡ 
ExecuteProcess
¡¡ '
(
¡¡' (
TDomain
¡¡( /
domain
¡¡0 6
)
¡¡6 7
;
¡¡7 8
	protected
££ 

virtual
££ 
void
££ 
RevertProcess
££ %
(
££% &
TDomain
££& -
domain
££. 4
)
££4 5
{
££6 7
}
££8 9
void
¦¦ 

IDARAction
¦¦ 
.
¦¦ 
RevertProcess
¦¦ 
(
¦¦ 
IDomain
¦¦ &
domain
¦¦' -
)
¦¦- .
{
§§ 
var
¨¨ 
typedDomain
¨¨ 
=
¨¨ 
domain
¨¨ 
?
¨¨ 
.
¨¨ 
GetFirst
¨¨ $
<
¨¨$ %
TDomain
¨¨% ,
>
¨¨, -
(
¨¨- .
true
¨¨. 2
)
¨¨2 3
;
¨¨3 4
if
©© 
(
©© 
typedDomain
©© 
==
©© 
null
©© 
)
©© 
return
©© !
;
©©! "
RevertProcess
«« 
(
«« 
typedDomain
«« 
)
«« 
;
«« 
}
¬¬ 

IDARAction
®® 

IDARAction
®® 
.
®® 
Execute
®® 
(
®® 
IDomain
®® &
domain
®®' -
)
®®- .
{
¯¯ 
return
°° 
Execute
°°	 
(
°° 
domain
°° 
)
°° 
;
°° 
}
±± 
public
³³ 
string
³³ 
GetActionType
³³ 
(
³³ 
)
³³ 
{
´´ 
return
µµ 
GetType
µµ	 
(
µµ 
)
µµ 
.
µµ 
Name
µµ 
;
µµ 
}
¶¶ 
}¸¸ î$
y/Users/a1/Documents/GitHub/turn-based-prototype/Server/Framework/Deterministic.GameFramework.Core/CachedTree/TreeCache.cs
	namespace 	
Deterministic
 
. 
GameFramework %
.% &
Core& *
;* +
[

 

JsonObject

 
(

 
MemberSerialization

 
.

  
OptIn

  %
)

% &
]

& '
public 
class 
TreeCacheManager 
< 
TNode #
># $
($ %
TNode% *
owner+ 0
)0 1
where 
TNode 
: 
class 
, 
INode 
< 
TNode !
>! "
{ 
private 
readonly	 
List 
< 
Action 
> 
_cacheInvalidators 1
=2 3
new4 7
(7 8
)8 9
;9 :
public 
CacheProperty 
< 
TNode 
, 
TValue #
># $
CreateProperty% 3
<3 4
TValue4 :
>: ;
(; <
Func 
< 
TNode 
, 
TValue 
> 
valueExtractor $
,$ %
Func 
< 
TNode 
, 
bool 
> 
isValueNode 
=  !
null" &
)& '
where( -
TValue. 4
:5 6
class7 <
{ 
var 
cache 
= 
new 
CacheProperty 
<  
TNode  %
,% &
TValue' -
>- .
(. /
owner/ 4
,4 5
valueExtractor6 D
,D E
isValueNodeF Q
)Q R
;R S
_cacheInvalidators 
. 
Add 
( 
( 
) 
=> 
cache $
.$ %

Invalidate% /
(/ 0
)0 1
)1 2
;2 3
return 
cache	 
; 
} 
public 
void !
RegisterInvalidatable "
(" #
Action# )
invalidateAction* :
): ;
{ 
_cacheInvalidators 
. 
Add 
( 
invalidateAction )
)) *
;* +
} 
public 
CachedListBuilder 
< 
TNode 
>  
CreateCachedList! 1
(1 2
)2 3
{ 
return   
new  	 
CachedListBuilder   
<   
TNode   $
>  $ %
(  % &
owner  & +
,  + ,
this  - 1
)  1 2
;  2 3
}!! 
public## 
CachedListBuilder## 
<## 
TNode## 
>##  
CreateCachedList##! 1
(##1 2
TNode##2 7
	fromOwner##8 A
)##A B
{$$ 
return%% 
new%%	 
CachedListBuilder%% 
<%% 
TNode%% $
>%%$ %
(%%% &
	fromOwner%%& /
,%%/ 0
this%%1 5
)%%5 6
;%%6 7
}&& 
public(( 
void(( 
InvalidateAll(( 
((( 
)(( 
{)) 
foreach** 	
(**
 
var** 

invalidate** 
in** 
_cacheInvalidators** /
)**/ 0
{++ 

invalidate,, 
(,, 
),, 
;,, 
}-- 
}.. 
public00 
void00 "
InvalidateAllRecursive00 #
(00# $
)00$ %
{11 
InvalidateAll22 
(22 
)22 
;22 
foreach55 	
(55
 
var55 
child55 
in55 
owner55 
.55 
GetChildren55 )
(55) *
)55* +
)55+ ,
{66 
if77 
(77 
child77 
is77 
ICacheInvalidatable77 #
invalidatable77$ 1
)771 2
{88 
invalidatable99 
.99 
InvalidateAllCaches99 %
(99% &
)99& '
;99' (
}:: 
};; 
}<< 
}== 
publicBB 
	interfaceBB 
ICacheInvalidatableBB $
{CC 
voidDD 
InvalidateAllCachesDD 
(DD 
)DD 
;DD 
}EE ø
u/Users/a1/Documents/GitHub/turn-based-prototype/Server/Framework/Deterministic.GameFramework.Core/CachedTree/INode.cs
	namespace 	
Deterministic
 
. 
GameFramework %
.% &
Core& *
;* +
public 
	interface 
INode 
< 
T 
> 
where 
T  !
:" #
class$ )
,) *
INode+ 0
<0 1
T1 2
>2 3
{ 
T 
? 
NodeGetParent 
( 
) 
; 
System		 
.		 
Collections		 
.		 
Generic		 
.		 
IEnumerable		 '
<		' (
T		( )
>		) *
GetChildren		+ 6
(		6 7
)		7 8
;		8 9
}

 Á&
}/Users/a1/Documents/GitHub/turn-based-prototype/Server/Framework/Deterministic.GameFramework.Core/CachedTree/CacheProperty.cs
	namespace 	
Deterministic
 
. 
GameFramework %
.% &
Core& *
;* +
[		 

JsonObject		 
(		 
MemberSerialization		 
.		  
OptIn		  %
)		% &
]		& '
public

 
class

 
CacheProperty

 
<

 
TNode

  
,

  !
TValue

" (
>

( )
where

* /
TNode

0 5
:

6 7
class

8 =
,

= >
INode

? D
<

D E
TNode

E J
>

J K
where

L Q
TValue

R X
:

Y Z
class

[ `
{ 
private 
TValue	 
_cachedValue 
; 
private 
bool	 
_isDirty 
= 
true 
; 
private 
readonly	 
TNode 
_owner 
; 
private 
readonly	 
Func 
< 
TNode 
, 
TValue $
>$ %
_valueExtractor& 5
;5 6
private 
readonly	 
Func 
< 
TNode 
, 
bool "
>" #
_isValueNode$ 0
;0 1
public 
CacheProperty 
( 
TNode 
owner !
,! "
Func# '
<' (
TNode( -
,- .
TValue/ 5
>5 6
valueExtractor7 E
,E F
FuncG K
<K L
TNodeL Q
,Q R
boolS W
>W X
isValueNodeY d
=e f
nullg k
)k l
{ 
_owner 
=	 

owner 
; 
_valueExtractor 
= 
valueExtractor "
;" #
_isValueNode 
= 
isValueNode 
?? 
(  !
node! %
=>& (
valueExtractor) 7
(7 8
node8 <
)< =
!=> @
nullA E
)E F
;F G
} 
public 
TValue 
GetValue 
( 
) 
{ 
EnsureValid 
( 
) 
; 
return 
_cachedValue	 
; 
} 
public 
void 

Invalidate 
( 
) 
{   
_isDirty!! 

=!! 
true!! 
;!! 
}"" 
private$$ 
void$$	 
EnsureValid$$ 
($$ 
)$$ 
{%% 
if&& 
(&& 
!&& 
_isDirty&& 
)&& 
return'' 	
;''	 

if** 
(** 
_isValueNode** 
(** 
_owner** 
)** 
)** 
{++ 
_cachedValue,, 
=,, 
_valueExtractor,, !
(,,! "
_owner,," (
),,( )
;,,) *
}-- 
else.. 
{// 
var11 
parent11 
=11 
_owner11 
.11 
NodeGetParent11 $
(11$ %
)11% &
;11& '
if22 
(22 
parent22 
!=22 
null22 
)22 
{33 
_cachedValue55 
=55 
FindValueInTree55 "
(55" #
parent55# )
)55) *
;55* +
}66 
else77 
{88 
_cachedValue99 
=99 
null99 
;99 
}:: 
};; 
_isDirty== 

=== 
false== 
;== 
}>> 
private@@ 
TValue@@	 
FindValueInTree@@ 
(@@  
TNode@@  %
node@@& *
)@@* +
{AA 
ifBB 
(BB 
nodeBB 

==BB 
nullBB 
)BB 
returnCC 	
nullCC
 
;CC 
ifEE 
(EE 
_isValueNodeEE 
(EE 
nodeEE 
)EE 
)EE 
returnFF 	
_valueExtractorFF
 
(FF 
nodeFF 
)FF 
;FF  
varHH 
parentHH 
=HH 
nodeHH 
.HH 
NodeGetParentHH !
(HH! "
)HH" #
;HH# $
returnII 
parentII	 
!=II 
nullII 
?II 
FindValueInTreeII )
(II) *
parentII* 0
)II0 1
:II2 3
nullII4 8
;II8 9
}JJ 
}KK ­·
z/Users/a1/Documents/GitHub/turn-based-prototype/Server/Framework/Deterministic.GameFramework.Core/CachedTree/CachedList.cs
	namespace 	
Deterministic
 
. 
GameFramework %
.% &
Core& *
;* +
public 
enum 
CacheDirection 
{ 
UpToRoot 	
,	 

DownToLeaves 
} 
[ 

JsonObject 
( 
MemberSerialization 
.  
OptIn  %
)% &
]& '
public 
class 

CachedList 
< 
TNode 
, 
T  
>  !
:" #
IList$ )
<) *
T* +
>+ ,
where- 2
TNode3 8
:9 :
class; @
,@ A
INodeB G
<G H
TNodeH M
>M N
{ 
[ 
JsonProperty 
] 
private 
readonly  
List! %
<% &
T& '
>' (
_localItems) 4
=5 6
new7 :
(: ;
); <
;< =
private 
List	 
< 
T 
> 
_cachedAggregated "
;" #
private 
bool	 
_isDirty 
= 
true 
; 
private 
readonly	 
TNode 
_owner 
; 
private 
readonly	 
Func 
< 
TNode 
, 
IEnumerable )
<) *
T* +
>+ ,
>, -
_itemsExtractor. =
;= >
private 
readonly	 
Action 
_onModified $
;$ %
private   
readonly  	 
CacheDirection    

_direction  ! +
;  + ,
public"" 

CachedList"" 
("" 
TNode"" 
owner"" 
,"" 
Func""  $
<""$ %
TNode""% *
,""* +
IEnumerable"", 7
<""7 8
T""8 9
>""9 :
>"": ;
itemsExtractor""< J
,""J K
Action""L R

onModified""S ]
=""^ _
null""` d
,""d e
CacheDirection""f t
	direction""u ~
=	"" €
CacheDirection
"" 
.
"" 
UpToRoot
"" ˜
)
""˜ ™
{## 
_owner$$ 
=$$	 

owner$$ 
;$$ 
_itemsExtractor%% 
=%% 
itemsExtractor%% "
;%%" #
_onModified&& 
=&& 

onModified&& 
;&& 

_direction'' 
='' 
	direction'' 
;'' 
}(( 
public** 
void** 

Invalidate** 
(** 
)** 
{++ 
_isDirty,, 

=,, 
true,, 
;,, 
}-- 
private// 
void//	 
EnsureValid// 
(// 
)// 
{00 
if11 
(11 
!11 
_isDirty11 
)11 
return22 	
;22	 

_cachedAggregated44 
=44 
new44 
List44 
<44 
T44  
>44  !
(44! "
)44" #
;44# $
_cachedAggregated77 
.77 
AddRange77 
(77 
_itemsExtractor77 ,
(77, -
_owner77- 3
)773 4
)774 5
;775 6
if:: 
(:: 

_direction:: 
==:: 
CacheDirection:: "
.::" #
UpToRoot::# +
)::+ ,
{;; 
var== 
parent== 
=== 
_owner== 
.== 
NodeGetParent== $
(==$ %
)==% &
;==& '
if>> 
(>> 
parent>> 
!=>> 
null>> 
)>> 
{?? 
CollectFromParents@@ 
(@@ 
parent@@ 
,@@ 
_cachedAggregated@@ 0
)@@0 1
;@@1 2
}AA 
}BB 
elseCC 
{DD 
foreachFF 

(FF 
varFF 
childFF 
inFF 
_ownerFF 
.FF  
GetChildrenFF  +
(FF+ ,
)FF, -
)FF- .
{GG 
CollectFromChildrenHH 
(HH 
childHH 
,HH 
_cachedAggregatedHH 0
)HH0 1
;HH1 2
}II 
}JJ 
_isDirtyLL 

=LL 
falseLL 
;LL 
}MM 
privateOO 
voidOO	 
CollectFromParentsOO  
(OO  !
TNodeOO! &
nodeOO' +
,OO+ ,
ListOO- 1
<OO1 2
TOO2 3
>OO3 4
accumulatorOO5 @
)OO@ A
{PP 
ifQQ 
(QQ 
nodeQQ 

==QQ 
nullQQ 
)QQ 
returnRR 	
;RR	 

accumulatorUU 
.UU 
AddRangeUU 
(UU 
_itemsExtractorUU &
(UU& '
nodeUU' +
)UU+ ,
)UU, -
;UU- .
varXX 
parentXX 
=XX 
nodeXX 
.XX 
NodeGetParentXX !
(XX! "
)XX" #
;XX# $
ifYY 
(YY 
parentYY 
!=YY 
nullYY 
)YY 
{ZZ 
CollectFromParents[[ 
([[ 
parent[[ 
,[[ 
accumulator[[ )
)[[) *
;[[* +
}\\ 
}]] 
private__ 
void__	 
CollectFromChildren__ !
(__! "
TNode__" '
node__( ,
,__, -
List__. 2
<__2 3
T__3 4
>__4 5
accumulator__6 A
)__A B
{`` 
ifaa 
(aa 
nodeaa 

==aa 
nullaa 
)aa 
returnbb 	
;bb	 

accumulatoree 
.ee 
AddRangeee 
(ee 
_itemsExtractoree &
(ee& '
nodeee' +
)ee+ ,
)ee, -
;ee- .
foreachhh 	
(hh
 
varhh 
childhh 
inhh 
nodehh 
.hh 
GetChildrenhh (
(hh( )
)hh) *
)hh* +
{ii 
CollectFromChildrenjj 
(jj 
childjj 
,jj 
accumulatorjj )
)jj) *
;jj* +
}kk 
}ll 
publicoo 
voidoo 
Addoo 
(oo 
Too 
itemoo 
)oo 
{pp 
_localItemsqq 
.qq 
Addqq 
(qq 
itemqq 
)qq 
;qq 

Invalidaterr 
(rr 
)rr 
;rr 
_onModifiedss 
?ss 
.ss 
Invokess 
(ss 
)ss 
;ss 
}tt 
publicvv 
voidvv 
Clearvv 
(vv 
)vv 
{ww 
_localItemsxx 
.xx 
Clearxx 
(xx 
)xx 
;xx 

Invalidateyy 
(yy 
)yy 
;yy 
_onModifiedzz 
?zz 
.zz 
Invokezz 
(zz 
)zz 
;zz 
}{{ 
public}} 
bool}} 
Remove}} 
(}} 
T}} 
item}} 
)}} 
{~~ 
var 
result 
= 
_localItems 
. 
Remove !
(! "
item" &
)& '
;' (
if
€€ 
(
€€ 
result
€€ 
)
€€ 
{
 

Invalidate
‚‚ 
(
‚‚ 
)
‚‚ 
;
‚‚ 
_onModified
ƒƒ 
?
ƒƒ 
.
ƒƒ 
Invoke
ƒƒ 
(
ƒƒ 
)
ƒƒ 
;
ƒƒ 
}
„„ 
return
…… 
result
……	 
;
…… 
}
†† 
public
ˆˆ 
void
ˆˆ 
Insert
ˆˆ 
(
ˆˆ 
int
ˆˆ 
index
ˆˆ 
,
ˆˆ 
T
ˆˆ  
item
ˆˆ! %
)
ˆˆ% &
{
‰‰ 
_localItems
ŠŠ 
.
ŠŠ 
Insert
ŠŠ 
(
ŠŠ 
index
ŠŠ 
,
ŠŠ 
item
ŠŠ  
)
ŠŠ  !
;
ŠŠ! "

Invalidate
‹‹ 
(
‹‹ 
)
‹‹ 
;
‹‹ 
_onModified
ŒŒ 
?
ŒŒ 
.
ŒŒ 
Invoke
ŒŒ 
(
ŒŒ 
)
ŒŒ 
;
ŒŒ 
}
 
public
 
void
 
RemoveAt
 
(
 
int
 
index
 
)
  
{
 
_localItems
‘‘ 
.
‘‘ 
RemoveAt
‘‘ 
(
‘‘ 
index
‘‘ 
)
‘‘ 
;
‘‘ 

Invalidate
’’ 
(
’’ 
)
’’ 
;
’’ 
_onModified
““ 
?
““ 
.
““ 
Invoke
““ 
(
““ 
)
““ 
;
““ 
}
”” 
public
–– 
T
–– 	
this
––
 
[
–– 
int
–– 
index
–– 
]
–– 
{
—— 
get
˜˜ 
{
™™ 
EnsureValid
šš 
(
šš 
)
šš 
;
šš 
return
›› 	
_cachedAggregated
››
 
[
›› 
index
›› !
]
››! "
;
››" #
}
œœ 
set
 
{
žž 
_localItems
ŸŸ 
[
ŸŸ 
index
ŸŸ 
]
ŸŸ 
=
ŸŸ 
value
ŸŸ 
;
ŸŸ 

Invalidate
   
(
   
)
   
;
   
_onModified
¡¡ 
?
¡¡ 
.
¡¡ 
Invoke
¡¡ 
(
¡¡ 
)
¡¡ 
;
¡¡ 
}
¢¢ 
}
££ 
public
¦¦ 
bool
¦¦ 
Contains
¦¦ 
(
¦¦ 
T
¦¦ 
item
¦¦ 
)
¦¦ 
{
§§ 
EnsureValid
¨¨ 
(
¨¨ 
)
¨¨ 
;
¨¨ 
return
©© 
_cachedAggregated
©©	 
.
©© 
Contains
©© #
(
©©# $
item
©©$ (
)
©©( )
;
©©) *
}
ªª 
public
¬¬ 
void
¬¬ 
CopyTo
¬¬ 
(
¬¬ 
T
¬¬ 
[
¬¬ 
]
¬¬ 
array
¬¬ 
,
¬¬ 
int
¬¬ "

arrayIndex
¬¬# -
)
¬¬- .
{
­­ 
EnsureValid
®® 
(
®® 
)
®® 
;
®® 
_cachedAggregated
¯¯ 
.
¯¯ 
CopyTo
¯¯ 
(
¯¯ 
array
¯¯  
,
¯¯  !

arrayIndex
¯¯" ,
)
¯¯, -
;
¯¯- .
}
°° 
public
²² 
int
²² 
Count
²² 
{
³³ 
get
´´ 
{
µµ 
EnsureValid
¶¶ 
(
¶¶ 
)
¶¶ 
;
¶¶ 
return
·· 	
_cachedAggregated
··
 
.
·· 
Count
·· !
;
··! "
}
¸¸ 
}
¹¹ 
public
»» 
bool
»» 

IsReadOnly
»» 
=>
»» 
false
»»  
;
»»  !
public
½½ 
int
½½ 
IndexOf
½½ 
(
½½ 
T
½½ 
item
½½ 
)
½½ 
{
¾¾ 
EnsureValid
¿¿ 
(
¿¿ 
)
¿¿ 
;
¿¿ 
return
ÀÀ 
_cachedAggregated
ÀÀ	 
.
ÀÀ 
IndexOf
ÀÀ "
(
ÀÀ" #
item
ÀÀ# '
)
ÀÀ' (
;
ÀÀ( )
}
ÁÁ 
public
ÃÃ 
IEnumerator
ÃÃ 
<
ÃÃ 
T
ÃÃ 
>
ÃÃ 
GetEnumerator
ÃÃ $
(
ÃÃ$ %
)
ÃÃ% &
{
ÄÄ 
EnsureValid
ÅÅ 
(
ÅÅ 
)
ÅÅ 
;
ÅÅ 
return
ÆÆ 
_cachedAggregated
ÆÆ	 
.
ÆÆ 
GetEnumerator
ÆÆ (
(
ÆÆ( )
)
ÆÆ) *
;
ÆÆ* +
}
ÇÇ 
IEnumerator
ÉÉ 
IEnumerable
ÉÉ 
.
ÉÉ 
GetEnumerator
ÉÉ &
(
ÉÉ& '
)
ÉÉ' (
=>
ÉÉ) +
GetEnumerator
ÉÉ, 9
(
ÉÉ9 :
)
ÉÉ: ;
;
ÉÉ; <
public
ÌÌ 
IReadOnlyList
ÌÌ 
<
ÌÌ 
T
ÌÌ 
>
ÌÌ 
GetLocalItems
ÌÌ &
(
ÌÌ& '
)
ÌÌ' (
=>
ÌÌ) +
_localItems
ÌÌ, 7
;
ÌÌ7 8
public
ÏÏ 
static
ÏÏ 
CachedListBuilder
ÏÏ  
<
ÏÏ  !
TNode
ÏÏ! &
,
ÏÏ& '
T
ÏÏ( )
>
ÏÏ) *
From
ÏÏ+ /
<
ÏÏ/ 0
TNode
ÏÏ0 5
,
ÏÏ5 6
T
ÏÏ7 8
>
ÏÏ8 9
(
ÏÏ9 :
TNode
ÏÏ: ?
owner
ÏÏ@ E
)
ÏÏE F
where
ÏÏG L
TNode
ÏÏM R
:
ÏÏS T
class
ÏÏU Z
,
ÏÏZ [
INode
ÏÏ\ a
<
ÏÏa b
TNode
ÏÏb g
>
ÏÏg h
{
ÐÐ 
return
ÑÑ 
new
ÑÑ	 
CachedListBuilder
ÑÑ 
<
ÑÑ 
TNode
ÑÑ $
,
ÑÑ$ %
T
ÑÑ& '
>
ÑÑ' (
(
ÑÑ( )
owner
ÑÑ) .
)
ÑÑ. /
;
ÑÑ/ 0
}
ÒÒ 
}ÓÓ 
publicØØ 
static
ØØ 
class
ØØ 

CachedList
ØØ 
{ÙÙ 
public
ÚÚ 
static
ÚÚ 
CachedListBuilder
ÚÚ  
<
ÚÚ  !

LeafDomain
ÚÚ! +
>
ÚÚ+ ,
From
ÚÚ- 1
(
ÚÚ1 2

LeafDomain
ÚÚ2 <
owner
ÚÚ= B
)
ÚÚB C
{
ÛÛ 
return
ÜÜ 
new
ÜÜ	 
CachedListBuilder
ÜÜ 
<
ÜÜ 

LeafDomain
ÜÜ )
>
ÜÜ) *
(
ÜÜ* +
owner
ÜÜ+ 0
)
ÜÜ0 1
;
ÜÜ1 2
}
ÝÝ 
public
ßß 
static
ßß 
CachedListBuilder
ßß  
<
ßß  !
TNode
ßß! &
>
ßß& '
From
ßß( ,
<
ßß, -
TNode
ßß- 2
>
ßß2 3
(
ßß3 4
TNode
ßß4 9
owner
ßß: ?
)
ßß? @
where
ßßA F
TNode
ßßG L
:
ßßM N
class
ßßO T
,
ßßT U
INode
ßßV [
<
ßß[ \
TNode
ßß\ a
>
ßßa b
{
àà 
return
áá 
new
áá	 
CachedListBuilder
áá 
<
áá 
TNode
áá $
>
áá$ %
(
áá% &
owner
áá& +
)
áá+ ,
;
áá, -
}
ââ 
}ãã 
publicèè 
class
èè 
CachedListBuilder
èè 
<
èè 
TNode
èè $
>
èè$ %
where
èè& +
TNode
èè, 1
:
èè2 3
class
èè4 9
,
èè9 :
INode
èè; @
<
èè@ A
TNode
èèA F
>
èèF G
{éé 
private
êê 
readonly
êê	 
TNode
êê 
_owner
êê 
;
êê 
private
ëë 
readonly
ëë	 
TreeCacheManager
ëë "
<
ëë" #
TNode
ëë# (
>
ëë( )
_cacheManager
ëë* 7
;
ëë7 8
internal
íí 	
CachedListBuilder
íí
 
(
íí 
TNode
íí !
owner
íí" '
)
íí' (
{
îî 
_owner
ïï 
=
ïï	 

owner
ïï 
;
ïï 
}
ðð 
internal
òò 	
CachedListBuilder
òò
 
(
òò 
TNode
òò !
owner
òò" '
,
òò' (
TreeCacheManager
òò) 9
<
òò9 :
TNode
òò: ?
>
òò? @
cacheManager
òòA M
)
òòM N
{
óó 
_owner
ôô 
=
ôô	 

owner
ôô 
;
ôô 
_cacheManager
õõ 
=
õõ 
cacheManager
õõ 
;
õõ 
}
öö 
public
øø 
CachedListBuilder
øø 
<
øø 
TNode
øø 
,
øø  
T
øø! "
>
øø" #
Extract
øø$ +
<
øø+ ,
T
øø, -
>
øø- .
(
øø. /
Func
øø/ 3
<
øø3 4
TNode
øø4 9
,
øø9 :
IEnumerable
øø; F
<
øøF G
T
øøG H
>
øøH I
>
øøI J
	extractor
øøK T
)
øøT U
{
ùù 
return
úú 
new
úú	 
CachedListBuilder
úú 
<
úú 
TNode
úú $
,
úú$ %
T
úú& '
>
úú' (
(
úú( )
_owner
úú) /
,
úú/ 0
_cacheManager
úú1 >
)
úú> ?
.
úú? @
Extract
úú@ G
(
úúG H
	extractor
úúH Q
)
úúQ R
;
úúR S
}
ûû 
}üü 
public 
class
 
CachedListBuilder
 
<
 
TNode
 $
,
$ %
T
& '
>
' (
where
) .
TNode
/ 4
:
5 6
class
7 <
,
< =
INode
> C
<
C D
TNode
D I
>
I J
{‚‚ 
private
ƒƒ 
readonly
ƒƒ	 
TNode
ƒƒ 
_owner
ƒƒ 
;
ƒƒ 
private
„„ 
readonly
„„	 
TreeCacheManager
„„ "
<
„„" #
TNode
„„# (
>
„„( )
_cacheManager
„„* 7
;
„„7 8
private
…… 
Func
……	 
<
…… 
TNode
…… 
,
…… 
IEnumerable
……  
<
……  !
T
……! "
>
……" #
>
……# $

_extractor
……% /
;
……/ 0
private
†† 
Action
††	 
_onModified
†† 
;
†† 
private
‡‡ 
CacheDirection
‡‡	 

_direction
‡‡ "
=
‡‡# $
CacheDirection
‡‡% 3
.
‡‡3 4
UpToRoot
‡‡4 <
;
‡‡< =
internal
‰‰ 	
CachedListBuilder
‰‰
 
(
‰‰ 
TNode
‰‰ !
owner
‰‰" '
)
‰‰' (
{
ŠŠ 
_owner
‹‹ 
=
‹‹	 

owner
‹‹ 
;
‹‹ 
}
ŒŒ 
internal
ŽŽ 	
CachedListBuilder
ŽŽ
 
(
ŽŽ 
TNode
ŽŽ !
owner
ŽŽ" '
,
ŽŽ' (
TreeCacheManager
ŽŽ) 9
<
ŽŽ9 :
TNode
ŽŽ: ?
>
ŽŽ? @
cacheManager
ŽŽA M
)
ŽŽM N
{
 
_owner
 
=
	 

owner
 
;
 
_cacheManager
‘‘ 
=
‘‘ 
cacheManager
‘‘ 
;
‘‘ 
}
’’ 
public
”” 
CachedListBuilder
”” 
<
”” 
TNode
”” 
,
””  
T
””! "
>
””" #
Extract
””$ +
(
””+ ,
Func
””, 0
<
””0 1
TNode
””1 6
,
””6 7
IEnumerable
””8 C
<
””C D
T
””D E
>
””E F
>
””F G
	extractor
””H Q
)
””Q R
{
•• 

_extractor
–– 
=
–– 
	extractor
–– 
;
–– 
return
—— 
this
——	 
;
—— 
}
˜˜ 
public
šš 
CachedListBuilder
šš 
<
šš 
TNode
šš 
,
šš  
T
šš! "
>
šš" #

OnModified
šš$ .
(
šš. /
Action
šš/ 5
callback
šš6 >
)
šš> ?
{
›› 
_onModified
œœ 
=
œœ 
callback
œœ 
;
œœ 
return
 
this
	 
;
 
}
žž 
public
   
CachedListBuilder
   
<
   
TNode
   
,
    
T
  ! "
>
  " #
	Direction
  $ -
(
  - .
CacheDirection
  . <
	direction
  = F
)
  F G
{
¡¡ 

_direction
¢¢ 
=
¢¢ 
	direction
¢¢ 
;
¢¢ 
return
££ 
this
££	 
;
££ 
}
¤¤ 
public
¦¦ 
CachedListBuilder
¦¦ 
<
¦¦ 
TNode
¦¦ 
,
¦¦  
T
¦¦! "
>
¦¦" #
UpToRoot
¦¦$ ,
(
¦¦, -
)
¦¦- .
{
§§ 

_direction
¨¨ 
=
¨¨ 
CacheDirection
¨¨ 
.
¨¨ 
UpToRoot
¨¨ &
;
¨¨& '
return
©© 
this
©©	 
;
©© 
}
ªª 
public
¬¬ 
CachedListBuilder
¬¬ 
<
¬¬ 
TNode
¬¬ 
,
¬¬  
T
¬¬! "
>
¬¬" #
DownToLeaves
¬¬$ 0
(
¬¬0 1
)
¬¬1 2
{
­­ 

_direction
®® 
=
®® 
CacheDirection
®® 
.
®® 
DownToLeaves
®® *
;
®®* +
return
¯¯ 
this
¯¯	 
;
¯¯ 
}
°° 
public
²² 

CachedList
²² 
<
²² 
TNode
²² 
,
²² 
T
²² 
>
²² 
Build
²² "
(
²²" #
)
²²# $
{
³³ 
if
´´ 
(
´´ 

_extractor
´´ 
==
´´ 
null
´´ 
)
´´ 
throw
µµ 
new
µµ	 '
InvalidOperationException
µµ &
(
µµ& '
$str
µµ' M
)
µµM N
;
µµN O
Action
¸¸ 
combinedCallback
¸¸	 
=
¸¸ 
null
¸¸  
;
¸¸  !
if
¹¹ 
(
¹¹ 
_cacheManager
¹¹ 
!=
¹¹ 
null
¹¹ 
)
¹¹ 
{
ºº 
combinedCallback
»» 
=
»» 
(
»» 
)
»» 
=>
»» 
{
¼¼ 
_cacheManager
½½ 
.
½½ $
InvalidateAllRecursive
½½ (
(
½½( )
)
½½) *
;
½½* +
_onModified
¾¾ 
?
¾¾ 
.
¾¾ 
Invoke
¾¾ 
(
¾¾ 
)
¾¾ 
;
¾¾ 
}
¿¿ 
;
¿¿ 
}
ÀÀ 
else
ÁÁ 
{
ÂÂ 
combinedCallback
ÃÃ 
=
ÃÃ 
_onModified
ÃÃ !
;
ÃÃ! "
}
ÄÄ 
var
ÆÆ 

cachedList
ÆÆ 
=
ÆÆ 
new
ÆÆ 

CachedList
ÆÆ !
<
ÆÆ! "
TNode
ÆÆ" '
,
ÆÆ' (
T
ÆÆ) *
>
ÆÆ* +
(
ÆÆ+ ,
_owner
ÆÆ, 2
,
ÆÆ2 3

_extractor
ÆÆ4 >
,
ÆÆ> ?
combinedCallback
ÆÆ@ P
,
ÆÆP Q

_direction
ÆÆR \
)
ÆÆ\ ]
;
ÆÆ] ^
_cacheManager
ÉÉ 
?
ÉÉ 
.
ÉÉ #
RegisterInvalidatable
ÉÉ &
(
ÉÉ& '

cachedList
ÉÉ' 1
.
ÉÉ1 2

Invalidate
ÉÉ2 <
)
ÉÉ< =
;
ÉÉ= >
return
ËË 

cachedList
ËË	 
;
ËË 
}
ÌÌ 
}ÍÍ „„
€/Users/a1/Documents/GitHub/turn-based-prototype/Server/Framework/Deterministic.GameFramework.Core/CachedTree/CachedDictionary.cs
	namespace 	
Deterministic
 
. 
GameFramework %
.% &
Core& *
;* +
[ 

JsonObject 
( 
MemberSerialization 
.  
OptIn  %
)% &
]& '
public 
class 
CachedDictionary 
< 
TNode #
,# $
TKey% )
,) *
TValue+ 1
>1 2
:3 4
IDictionary5 @
<@ A
TKeyA E
,E F
TValueG M
>M N
whereO T
TNodeU Z
:[ \
class] b
,b c
INoded i
<i j
TNodej o
>o p
{ 
[ 
JsonProperty 
] 
private 
readonly  

Dictionary! +
<+ ,
TKey, 0
,0 1
TValue2 8
>8 9
_localItems: E
=F G
newH K
(K L
)L M
;M N
private 

Dictionary	 
< 
TKey 
, 
TValue  
>  !
_cachedAggregated" 3
;3 4
private 
bool	 
_isDirty 
= 
true 
; 
private 
readonly	 
TNode 
_owner 
; 
private 
readonly	 
Func 
< 
TNode 
, 
IEnumerable )
<) *
KeyValuePair* 6
<6 7
TKey7 ;
,; <
TValue= C
>C D
>D E
>E F
_itemsExtractorG V
;V W
private 
readonly	 
Action 
? 
_onModified %
;% &
private 
readonly	 
CacheDirection  

_direction! +
;+ ,
public 
CachedDictionary 
( 
TNode 
owner $
,$ %
Func& *
<* +
TNode+ 0
,0 1
IEnumerable2 =
<= >
KeyValuePair> J
<J K
TKeyK O
,O P
TValueQ W
>W X
>X Y
>Y Z
itemsExtractor[ i
,i j
Actionk q
?q r

onModifieds }
=~ 
null
€ „
,
„ …
CacheDirection
† ”
	direction
• ž
=
Ÿ  
CacheDirection
¡ ¯
.
¯ °
UpToRoot
° ¸
)
¸ ¹
{ 
_owner 
=	 

owner 
; 
_itemsExtractor 
= 
itemsExtractor "
;" #
_onModified 
= 

onModified 
; 

_direction 
= 
	direction 
; 
} 
public   
void   

Invalidate   
(   
)   
{!! 
_isDirty"" 

="" 
true"" 
;"" 
}## 
private%% 
void%%	 
EnsureValid%% 
(%% 
)%% 
{&& 
if'' 
('' 
!'' 
_isDirty'' 
)'' 
return(( 	
;((	 

_cachedAggregated** 
=** 
new** 

Dictionary** $
<**$ %
TKey**% )
,**) *
TValue**+ 1
>**1 2
(**2 3
)**3 4
;**4 5
foreach-- 	
(--
 
var-- 
kvp-- 
in-- 
_itemsExtractor-- %
(--% &
_owner--& ,
)--, -
)--- .
{.. 
_cachedAggregated// 
[// 
kvp// 
.// 
Key// 
]// 
=// 
kvp//  #
.//# $
Value//$ )
;//) *
}00 
if33 
(33 

_direction33 
==33 
CacheDirection33 "
.33" #
UpToRoot33# +
)33+ ,
{44 
var66 
parent66 
=66 
_owner66 
.66 
NodeGetParent66 $
(66$ %
)66% &
;66& '
if77 
(77 
parent77 
!=77 
null77 
)77 
{88 
CollectFromParents99 
(99 
parent99 
,99 
_cachedAggregated99 0
)990 1
;991 2
}:: 
};; 
else<< 
{== 
foreach?? 

(?? 
var?? 
child?? 
in?? 
_owner?? 
.??  
GetChildren??  +
(??+ ,
)??, -
)??- .
{@@ 
CollectFromChildrenAA 
(AA 
childAA 
,AA 
_cachedAggregatedAA 0
)AA0 1
;AA1 2
}BB 
}CC 
_isDirtyEE 

=EE 
falseEE 
;EE 
}FF 
privateHH 
voidHH	 
CollectFromParentsHH  
(HH  !
TNodeHH! &
nodeHH' +
,HH+ ,

DictionaryHH- 7
<HH7 8
TKeyHH8 <
,HH< =
TValueHH> D
>HHD E
accumulatorHHF Q
)HHQ R
{II 
ifJJ 
(JJ 
nodeJJ 

==JJ 
nullJJ 
)JJ 
returnKK 	
;KK	 

foreachNN 	
(NN
 
varNN 
kvpNN 
inNN 
_itemsExtractorNN %
(NN% &
nodeNN& *
)NN* +
)NN+ ,
{OO 
ifPP 
(PP 
!PP 
accumulatorPP 
.PP 
ContainsKeyPP 
(PP  
kvpPP  #
.PP# $
KeyPP$ '
)PP' (
)PP( )
{QQ 
accumulatorRR 
[RR 
kvpRR 
.RR 
KeyRR 
]RR 
=RR 
kvpRR 
.RR 
ValueRR $
;RR$ %
}SS 
}TT 
varWW 
parentWW 
=WW 
nodeWW 
.WW 
NodeGetParentWW !
(WW! "
)WW" #
;WW# $
ifXX 
(XX 
parentXX 
!=XX 
nullXX 
)XX 
{YY 
CollectFromParentsZZ 
(ZZ 
parentZZ 
,ZZ 
accumulatorZZ )
)ZZ) *
;ZZ* +
}[[ 
}\\ 
private^^ 
void^^	 
CollectFromChildren^^ !
(^^! "
TNode^^" '
node^^( ,
,^^, -

Dictionary^^. 8
<^^8 9
TKey^^9 =
,^^= >
TValue^^? E
>^^E F
accumulator^^G R
)^^R S
{__ 
if`` 
(`` 
node`` 

==`` 
null`` 
)`` 
returnaa 	
;aa	 

foreachdd 	
(dd
 
vardd 
kvpdd 
indd 
_itemsExtractordd %
(dd% &
nodedd& *
)dd* +
)dd+ ,
{ee 
accumulatorff 
[ff 
kvpff 
.ff 
Keyff 
]ff 
=ff 
kvpff 
.ff 
Valueff #
;ff# $
}gg 
foreachjj 	
(jj
 
varjj 
childjj 
injj 
nodejj 
.jj 
GetChildrenjj (
(jj( )
)jj) *
)jj* +
{kk 
CollectFromChildrenll 
(ll 
childll 
,ll 
accumulatorll )
)ll) *
;ll* +
}mm 
}nn 
publicqq 
voidqq 
Addqq 
(qq 
TKeyqq 
keyqq 
,qq 
TValueqq !
valueqq" '
)qq' (
{rr 
_localItemsss 
.ss 
Addss 
(ss 
keyss 
,ss 
valuess 
)ss 
;ss 

Invalidatett 
(tt 
)tt 
;tt 
_onModifieduu 
?uu 
.uu 
Invokeuu 
(uu 
)uu 
;uu 
}vv 
publicxx 
voidxx 
Addxx 
(xx 
KeyValuePairxx 
<xx 
TKeyxx "
,xx" #
TValuexx$ *
>xx* +
itemxx, 0
)xx0 1
{yy 
_localItemszz 
.zz 
Addzz 
(zz 
itemzz 
.zz 
Keyzz 
,zz 
itemzz  
.zz  !
Valuezz! &
)zz& '
;zz' (

Invalidate{{ 
({{ 
){{ 
;{{ 
_onModified|| 
?|| 
.|| 
Invoke|| 
(|| 
)|| 
;|| 
}}} 
public 
void 
Clear 
( 
) 
{
€€ 
_localItems
 
.
 
Clear
 
(
 
)
 
;
 

Invalidate
‚‚ 
(
‚‚ 
)
‚‚ 
;
‚‚ 
_onModified
ƒƒ 
?
ƒƒ 
.
ƒƒ 
Invoke
ƒƒ 
(
ƒƒ 
)
ƒƒ 
;
ƒƒ 
}
„„ 
public
†† 
bool
†† 
Remove
†† 
(
†† 
TKey
†† 
key
†† 
)
†† 
{
‡‡ 
var
ˆˆ 
result
ˆˆ 
=
ˆˆ 
_localItems
ˆˆ 
.
ˆˆ 
Remove
ˆˆ !
(
ˆˆ! "
key
ˆˆ" %
)
ˆˆ% &
;
ˆˆ& '
if
‰‰ 
(
‰‰ 
result
‰‰ 
)
‰‰ 
{
ŠŠ 

Invalidate
‹‹ 
(
‹‹ 
)
‹‹ 
;
‹‹ 
_onModified
ŒŒ 
?
ŒŒ 
.
ŒŒ 
Invoke
ŒŒ 
(
ŒŒ 
)
ŒŒ 
;
ŒŒ 
}
 
return
ŽŽ 
result
ŽŽ	 
;
ŽŽ 
}
 
public
‘‘ 
bool
‘‘ 
Remove
‘‘ 
(
‘‘ 
KeyValuePair
‘‘  
<
‘‘  !
TKey
‘‘! %
,
‘‘% &
TValue
‘‘' -
>
‘‘- .
item
‘‘/ 3
)
‘‘3 4
{
’’ 
var
““ 
result
““ 
=
““ 
(
““ 
(
““ 
IDictionary
““ 
<
““ 
TKey
““ !
,
““! "
TValue
““# )
>
““) *
)
““* +
_localItems
““+ 6
)
““6 7
.
““7 8
Remove
““8 >
(
““> ?
item
““? C
)
““C D
;
““D E
if
”” 
(
”” 
result
”” 
)
”” 
{
•• 

Invalidate
–– 
(
–– 
)
–– 
;
–– 
_onModified
—— 
?
—— 
.
—— 
Invoke
—— 
(
—— 
)
—— 
;
—— 
}
˜˜ 
return
™™ 
result
™™	 
;
™™ 
}
šš 
public
œœ 
TValue
œœ 
this
œœ 
[
œœ 
TKey
œœ 
key
œœ 
]
œœ 
{
 
get
žž 
{
ŸŸ 
EnsureValid
   
(
   
)
   
;
   
return
¡¡ 	
_cachedAggregated
¡¡
 
[
¡¡ 
key
¡¡ 
]
¡¡  
;
¡¡  !
}
¢¢ 
set
££ 
{
¤¤ 
_localItems
¥¥ 
[
¥¥ 
key
¥¥ 
]
¥¥ 
=
¥¥ 
value
¥¥ 
;
¥¥ 

Invalidate
¦¦ 
(
¦¦ 
)
¦¦ 
;
¦¦ 
_onModified
§§ 
?
§§ 
.
§§ 
Invoke
§§ 
(
§§ 
)
§§ 
;
§§ 
}
¨¨ 
}
©© 
public
¬¬ 
bool
¬¬ 
ContainsKey
¬¬ 
(
¬¬ 
TKey
¬¬ 
key
¬¬ !
)
¬¬! "
{
­­ 
EnsureValid
®® 
(
®® 
)
®® 
;
®® 
return
¯¯ 
_cachedAggregated
¯¯	 
.
¯¯ 
ContainsKey
¯¯ &
(
¯¯& '
key
¯¯' *
)
¯¯* +
;
¯¯+ ,
}
°° 
public
²² 
bool
²² 
Contains
²² 
(
²² 
KeyValuePair
²² "
<
²²" #
TKey
²²# '
,
²²' (
TValue
²²) /
>
²²/ 0
item
²²1 5
)
²²5 6
{
³³ 
EnsureValid
´´ 
(
´´ 
)
´´ 
;
´´ 
return
µµ 
_cachedAggregated
µµ	 
.
µµ 
Contains
µµ #
(
µµ# $
item
µµ$ (
)
µµ( )
;
µµ) *
}
¶¶ 
public
¸¸ 
bool
¸¸ 
TryGetValue
¸¸ 
(
¸¸ 
TKey
¸¸ 
key
¸¸ !
,
¸¸! "
out
¸¸# &
TValue
¸¸' -
value
¸¸. 3
)
¸¸3 4
{
¹¹ 
EnsureValid
ºº 
(
ºº 
)
ºº 
;
ºº 
return
»» 
_cachedAggregated
»»	 
.
»» 
TryGetValue
»» &
(
»»& '
key
»»' *
,
»»* +
out
»», /
value
»»0 5
)
»»5 6
;
»»6 7
}
¼¼ 
public
¾¾ 
void
¾¾ 
CopyTo
¾¾ 
(
¾¾ 
KeyValuePair
¾¾  
<
¾¾  !
TKey
¾¾! %
,
¾¾% &
TValue
¾¾' -
>
¾¾- .
[
¾¾. /
]
¾¾/ 0
array
¾¾1 6
,
¾¾6 7
int
¾¾8 ;

arrayIndex
¾¾< F
)
¾¾F G
{
¿¿ 
EnsureValid
ÀÀ 
(
ÀÀ 
)
ÀÀ 
;
ÀÀ 
(
ÁÁ 
(
ÁÁ 
IDictionary
ÁÁ 
<
ÁÁ 
TKey
ÁÁ 
,
ÁÁ 
TValue
ÁÁ 
>
ÁÁ 
)
ÁÁ 
_cachedAggregated
ÁÁ /
)
ÁÁ/ 0
.
ÁÁ0 1
CopyTo
ÁÁ1 7
(
ÁÁ7 8
array
ÁÁ8 =
,
ÁÁ= >

arrayIndex
ÁÁ? I
)
ÁÁI J
;
ÁÁJ K
}
ÂÂ 
public
ÄÄ 
int
ÄÄ 
Count
ÄÄ 
{
ÅÅ 
get
ÆÆ 
{
ÇÇ 
EnsureValid
ÈÈ 
(
ÈÈ 
)
ÈÈ 
;
ÈÈ 
return
ÉÉ 	
_cachedAggregated
ÉÉ
 
.
ÉÉ 
Count
ÉÉ !
;
ÉÉ! "
}
ÊÊ 
}
ËË 
public
ÍÍ 
bool
ÍÍ 

IsReadOnly
ÍÍ 
=>
ÍÍ 
false
ÍÍ  
;
ÍÍ  !
public
ÏÏ 
ICollection
ÏÏ 
<
ÏÏ 
TKey
ÏÏ 
>
ÏÏ 
Keys
ÏÏ 
{
ÐÐ 
get
ÑÑ 
{
ÒÒ 
EnsureValid
ÓÓ 
(
ÓÓ 
)
ÓÓ 
;
ÓÓ 
return
ÔÔ 	
_cachedAggregated
ÔÔ
 
.
ÔÔ 
Keys
ÔÔ  
;
ÔÔ  !
}
ÕÕ 
}
ÖÖ 
public
ØØ 
ICollection
ØØ 
<
ØØ 
TValue
ØØ 
>
ØØ 
Values
ØØ "
{
ÙÙ 
get
ÚÚ 
{
ÛÛ 
EnsureValid
ÜÜ 
(
ÜÜ 
)
ÜÜ 
;
ÜÜ 
return
ÝÝ 	
_cachedAggregated
ÝÝ
 
.
ÝÝ 
Values
ÝÝ "
;
ÝÝ" #
}
ÞÞ 
}
ßß 
public
áá 
IEnumerator
áá 
<
áá 
KeyValuePair
áá  
<
áá  !
TKey
áá! %
,
áá% &
TValue
áá' -
>
áá- .
>
áá. /
GetEnumerator
áá0 =
(
áá= >
)
áá> ?
{
ââ 
EnsureValid
ãã 
(
ãã 
)
ãã 
;
ãã 
return
ää 
_cachedAggregated
ää	 
.
ää 
GetEnumerator
ää (
(
ää( )
)
ää) *
;
ää* +
}
åå 
IEnumerator
çç 
IEnumerable
çç 
.
çç 
GetEnumerator
çç &
(
çç& '
)
çç' (
=>
çç) +
GetEnumerator
çç, 9
(
çç9 :
)
çç: ;
;
çç; <
public
êê !
IReadOnlyDictionary
êê 
<
êê 
TKey
êê  
,
êê  !
TValue
êê" (
>
êê( )
GetLocalItems
êê* 7
(
êê7 8
)
êê8 9
=>
êê: <
_localItems
êê= H
;
êêH I
}ëë 
‚/Users/a1/Documents/GitHub/turn-based-prototype/Server/Framework/Deterministic.GameFramework.Core/Actions/RemoveSubdomainAction.cs
	namespace 	
Deterministic
 
. 
GameFramework %
.% &
Core& *
.* +
Actions+ 2
;2 3
public 
class !
RemoveSubdomainAction "
:# $
	DARAction% .
<. /

LeafDomain/ 9
,9 :!
RemoveSubdomainAction; P
>P Q
{ 
public 

Guid 
MatchId 
{ 
get 
; 
set "
;" #
}$ %
public 


LeafDomain 
Parent 
{ 
get "
;" #
set$ '
;' (
}) *
public 


LeafDomain 
Child 
{ 
get !
;! "
set# &
;& '
}( )
public		 
!
RemoveSubdomainAction		  
(		  !

LeafDomain		! +
parent		, 2
,		2 3

LeafDomain		4 >
child		? D
)		D E
{

 
Parent 
= 
parent 
; 
Child 
= 
child 
; 
} 
	protected 
override 
void 
ExecuteProcess *
(* +

LeafDomain+ 5
domain6 <
)< =
{ 
} 
} 
/Users/a1/Documents/GitHub/turn-based-prototype/Server/Framework/Deterministic.GameFramework.Core/Actions/AddSubdomainAction.cs
	namespace 	
Deterministic
 
. 
GameFramework %
.% &
Core& *
.* +
Actions+ 2
;2 3
public 
class 
AddSubdomainAction 
:  !
	DARAction" +
<+ ,

LeafDomain, 6
,6 7
AddSubdomainAction8 J
>J K
{ 
public 

Guid 
MatchId 
{ 
get 
; 
set "
;" #
}$ %
public 


LeafDomain 
Parent 
{ 
get "
;" #
set$ '
;' (
}) *
public 


LeafDomain 
Child 
{ 
get !
;! "
set# &
;& '
}( )
public		 

AddSubdomainAction		 
(		 

LeafDomain		 (
parent		) /
,		/ 0

LeafDomain		1 ;
child		< A
)		A B
{

 
Parent 
= 
parent 
; 
Child 
= 
child 
; 
} 
	protected 
override 
void 
ExecuteProcess *
(* +

LeafDomain+ 5
domain6 <
)< =
{ 
} 
} 